{% extends "myapp/layout.html" %}

{% load static %}


{% block content %}

<!-- 
animated flash delay-2s -->




    <q-breadcrumbs style="cursor: pointer" >
      <q-breadcrumbs-el style="color: red; " label="Evaluate Employee /" icon="insert_chart_outlined" />
      
      
     
    </q-breadcrumbs>

    <div class="row animated fadeInDown" style="width:100%;margin-top: 20px;">
        <q-list   >
            <q-item style=" border-radius: 5px;"
           >
                <q-item-section>
                  <q-item-label style="font-size: 20px; font-weight: 900; color: #34495E ">Performance Evaluation for Employees</q-item-label>
                  <q-item-label caption lines="2">Click one row and click evaluate button</q-item-label>
                  <q-item-label style="color: #34495E ">Status : Ongoing </q-item-label>
                </q-item-section>
            
                <q-item-section side top>
                  <q-item-label caption>

                    
                  </q-item-label>
                  
                </q-item-section>
              </q-item>
        </q-list>

    </div>

    <div class="row animated fadeInDown" style="width:100%;margin-top: 20px;">
        <!-- -row -->    

        <!-- book -->
        <q-tabs
          v-model="tab"
          class="text-orange-10"
        >
       
        <q-tab :name="item.jobstatus" icon="mail" :label="item.jobstatus" v-for="item in EmployeesNeedtoEvaluate" >
          <q-badge color="orange" text-color="white" :label="item.employeeList.data.length" floating ></q-badge>
        </q-tab>
        
         
          <q-tab name="movies" icon="movie" label="Evaluation Result" >

              
              <q-badge color="orange" text-color="white" :label="EvaluationResult.length" floating ></q-badge>
          </q-tab>

        </q-tabs>
        <q-tab-panels v-model="tab" animated style="width: 100%;" >
          <q-tab-panel :name="item.jobstatus" v-for="(item,index) in EmployeesNeedtoEvaluate">
           
            <q-table

            
            style="width: 100%"
            :data="item.employeeList.data"
            :columns="item.employeeList.columns"
            row-key="id"
            selection="single"
            :selected.sync="item.employeeList.employee_list_selected"
    
          >
      
          <template  slot="top-selection" >
      
                  <div style="margin: 5px;">
                    <q-tooltip >
                     Click to Evaluate
                    </q-tooltip>
                      <q-btn class="animated fadeInDown" dense color="red" label="Start Evaluate"  icon="launch" @click="EvaluateNa(item.employeeList.employee_list_selected)" ></q-btn>
                      
                 </div>

                 <div style="margin: 5px;">
                    <q-tooltip >
                    Click to View Scores
                    </q-tooltip>
                      <q-btn class="animated fadeInDown" @click="eventresults(item.employeeList.employee_list_selected)" dense color="green" label="View Results"  icon="visibility" @click="" ></q-btn>
                      
                 </div>
                        </template>
      
                 <template v-slot:top-right>
              
                     
      
            <!--  <div style="width: 200px;padding: 10px;">
                  <q-select  outlined :options="options_terminal"  label="Place of Asignment" ></q-select>
              </div>
              
              <div style="width: 200px;padding: 10px;">
                  <q-select outlined :options="options_department" label="Department" ></q-select>
              </div> -->
             
              
            
              <q-btn-group outline>
                <!-- hala -->
                  <q-btn :outline="filterneed" @click="needtoevaluatelang(index)" color="red" label="Need to Evaluate" >
                    <q-badge color="orange" text-color="white" label="5" floating></q-badge>
                  </q-btn>
                  <q-btn :outline="filteralaready" @click="eventalreadyevaluated(index)" color="orange" label="Already Evaluated"  ></q-btn>
                  <q-btn :outline="filterall" color="green" @click="eventall(index)" label="All" ></q-btn>
              </q-btn-group>

              
              
             
              </template>
      
      
      
            </q-table>
          </q-tab-panel>





          <q-tab-panel name="movies">



            <div class="text-h6"></div>
           
            <div class="row" style="width: 100%">
       
               <q-input
               style="width: 100%"
               :loading="loadingState_search"
               filled
               v-model="search_info"
               label="Search Name"
       
             >
       
             <template v-slot:append>
                 <q-icon name="search" />
               </template>
           </q-input>
       
           <q-linear-progress v-if="load" indeterminate rounded style="color: gray;" class="q-mt-sm" ></q-linear-progress>
            </div>
       
       
       
       
            
            <q-list  style="overflow-x: scroll; height: 400px;">
       
             <!-- //current -->
               <q-item class="animated fadeInLeft" style="border-bottom: gray solid 1px" v-for="item in EvaluationResult">
                   <q-item-section>
                     <q-item-label>${item.employeefullname}</q-item-label>
                     <q-item-label caption lines="2">JobStatus : ${item.jobstatus }</q-item-label>
                     <q-item-label caption lines="2"> EvaluationDate: ${ item.date_created}</q-item-label>
                     <q-item-label caption lines="2"> Place of Assignment : ${item.departmentsection}</q-item-label>
                     <q-item-label caption lines="2"> Place of Assignment : ${item.placeofassignment}</q-item-label>
                     <q-item-label caption lines="2"> First Month : 20</q-item-label>
                     <q-item-label caption lines="2"> Final Result : 100</q-item-label>
                   </q-item-section>
           
                  
                   <q-item-section top side v-if="item.send == false" >
                       <div > 
                         <q-tooltip >
                           Send this file to HR Department
                         </q-tooltip>
                         <q-btn color="red" flat icon="send" style="font-size: 15px;" @click="sentohr(item.id)" ></q-btn>
                       </div>
                      </q-item-section>
       
       
                      <q-item-section top side v-if="item.send == true" >
                         <div > 
                         
                           <label for="">
                             <q-icon name="check" style="color: green ;font-size: 15px;" ></q-icon>
                            Sent Successfully 
                           </label>
                         </div>
                        </q-item-section>
                       
                     
       
       
                 </q-item>
       
       
                 
       
       
              
            </q-list>


          </q-tab-panel>
        </q-tab-panels>



    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" >
      
       
  
      <!-- endcol -->

    </div>

    

    
    


         <!-- -row -->
    </div>
    <!-- ${employee_list_selected} -->

        <div class="row animated fadeInDown">
                <!-- evalutemaximized -->


                <q-dialog
                v-model="dialog_evaluate"
                persistent
                :maximized="maximizedToggle"
                transition-show="slide-up"
                transition-hide="slide-down"
              >
                <q-card class="bg-red-8 text-gray" >
                  <q-bar>
                  
                       
                 <div style="width: 100%;">
                        <q-btn dense  style="float:right;" color="white" flat icon="close" v-close-popup>
                                <q-tooltip content-class="bg-white text-primary">Close</q-tooltip>
                              </q-btn>
                 </div>
                  </q-bar>
          

                  <q-card-section class="" style="background-color:  white;">
                   <div class="row animated fadeInDown" >
                           <img  style="margin-left: auto;margin-right: auto" src="https://www.victoryliner.com/docs/assets/img/home/logo.png"  width="200" alt="" srcset="">
                   </div>
                   <div class="row animated fadeInDown" style="margin-top:20px;">
                           <p style="text-align: center; width: 100%;color: #34495E; font-weight: 800;">${ type_of_evaluation }</p>
                   </div>
                    <q-btn  color="red" text-color="white" icon="visibility" label="Employee 201 File" @click="show_201File" ></q-btn>
                    <q-btn  color="orange-6" text-color="white" icon="visibility" label="Customer Complaints" @click="event_show_complaint"  ></q-btn>
                    <q-btn  color="light-green-7" text-color="white" icon="visibility" label="Commendation" @click="event_show_commendation" ></q-btn>
                   <!-- andi -->
                   <div class="row animated fadeInDown" >
                           
                           <table class="table table-hover mytable" style="">
                                   <thead>
                                           <tr style="background-color: #34495E ; color: whitesmoke">
                                                   <th>Employee name</th>
                                                   <th>Date Hired</th>
                                                   <th>Designation</th>
                                                   <th>Department Section</th>
                                                   <th>Place of Assignment</th>
                                                   <th>Job Status</th>
                                                   <th>Supervisor/Rater</th>
                                                   <!-- <q-btn color="primary" icon="check" label="compute" @click="compute" ></q-btn> -->
                                           </tr>
                                   </thead>
                                   <tbody>
                                           <tr style="color:#5D6D7E;">
                                                   <td>${ displayfirstname } ${ displaymiddldname } ${ displaylastname }</td>
                                                   <td>${ displaydatehired }</td>
                                                   <td>${ displaydesignation }</td>
                                                   <td>${ displaydepartmentsection }</td>
                                                   <td>${ displayplaceofassignment}</td>
                                                   <td>${ displayjobstatus } </td>
                                                   <td>{{ user }}</td>

                                           </tr>
                                   </tbody>
                           </table>
                           
                   </div>

                   <div class="row animated fadeInDown" style="margin-top:20px;">
                                <p style="text-align: center; width: 100%;color: #34495E; font-weight: 800; font-size: 30px;">Period of Evaluation</p>
                        </div>
                  </q-card-section>
          
                  <q-card-section class="" style="background-color:  #EBF5FB;">
                        <div class="row animated fadeInDown" style="width: 100%">
                                       <!-- content criteria -->
                                       <div class="col-xs-12 col-sm-8 col-md-8 col-lg-8">
                                                <table class="table table-hover "  style="margin-left: auto;margin-right: auto; background-color:  white;">
                                                                <thead>
                                                                        <tr  style="color: whitesmoke; font-size: 20px; background-color: #34495E ">
                                                                                <th>Criteria</th>
                                                                                <th v-for="item in evaluation_period_header" :key="item.id" style=" text-align: center;" >
                                                                                        ${ headermonth } 
                                                                                </th>
        
                                                                                
                                                                        </tr>
                                                                </thead>
                                                                <tbody>
                                                                        <tr v-for="item1 in evaluation_content" :key="item1.id">
                                                                                <td style="width: 350px;">
                                                                                        <div class="row animated fadeInDown" style="color: #34495E; font-weight: 800; font-size: 20px;">
                                                                                         ${item1.criteria} ( ${item1.percentage} )%
                                                                                        </div>
                                                                                        <div class="row animated fadeInDown" style="padding: 5px; font-size: 15px; color: #5D6D7E">
                                                                                               ${item1.description}
                                                                                        </div>
                                                                                        <div class="row animated fadeInDown" style="padding: 5px; font-size: 15px; color: #5D6D7E">
                                                                                            <div v-if="item1.criteria.includes('attendance')">
                                                                                               
                                        
                                                                                                <q-date
                                                                                                  style="width: 100%"
                                                                                                      v-model="attendance"
                                                                                                    :options="Attendanceoptions"
                                                                                                    color="red"
                                                                                                  
                                                                                                ></q-date>

                                                                                          
                                                                                            </div>
                                                                                            <div v-if="item1.criteria.includes('Attendance')">
                                                                                              
                                                                                                                                      
                                                                                                <q-date
                                                                                                  style="width: 100%"
                                                                                                      v-model="attendance"
                                                                                                    :options="Attendanceoptions"
                                                                                                    color="red"
                                                                                                  
                                                                                                ></q-date>

                                                                                            </div>
                                                                                            <div v-if="item1.criteria.includes('ATTENDANCE')">
                                                                                              
                                                                                                <q-date
                                                                                                  style="width: 100%"
                                                                                                      v-model="attendance"
                                                                                                    :options="Attendanceoptions"
                                                                                                    color="red"
                                                                                                  
                                                                                                ></q-date>


                                                                                            </div>
                                                                                     </div>
                                                                                        
                                                                                        <div class="row animated fadeInDown" v-for="item in item1.employee_violation">
                                                                                                <q-btn v-if="item.minor || item.grave"  flat style="color: white ; background-color: red; font-weight: bold; margin-left: -10px;" label="Violations">
                                                                                                        <q-badge color="orange" floating> 

                                                                                                            <div v-if="item1.employee_violation">
                                                                                                                ${ item1.employee_violation[0]['final_violation'].length }
                                                                                                            </div>
                                                                                                            <div v-else>
                                                                                                                0
                                                                                                            </div>

                                                                                                           </q-badge>
                                                                                                </q-btn>
                                                                                        </div>
                                                                    
                                                                                       <!-- bry -->
                                                                                      
                                                                                       <div class="row animated fadeInLeft" style="width: 100%;" >
                                                                                               <div style="width: 100%;margin-bottom: 4px; "  v-for="item in item1.employee_violation" :key="item1.id">
                                                                                                        <q-card class="my-card" style="width: 100% ;  background-color: white; color: #5D6D7E;">
                                                                                                                
                                                                                                               <q-card-section style="width: 100% " v-if="item.minor || item.grave">
                                                                                                                        <div class="text-h6"> 
                                                                                                                            <q-btn   flat style="color:#34495E ; font-weight: bold; margin-left: -10px;" label="Minor">
                                                                                                                                <q-badge color="orange" floating> 
                        
                                                                                                                                    ${ item.minor }
                                                                                                                                   
                                                                                                                                   </q-badge>
                                                                                                                        </q-btn>
                                                                                                                        
                                                                                                                        <q-btn   flat style="color:#34495E ; font-weight: bold; margin-left: -10px;" label="Grave">
                                                                                                                            <q-badge color="orange" floating> 
                    
                                                                                                                                ${ item.grave }
                                                                                                                               
                                                                                                                               </q-badge>
                                                                                                                    </q-btn>

                                                                                                                        </div>
                                                                                                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                                                                                                            <q-btn @click="seemore(item)"   push style=" width: 100%;color: red ; font-weight: bold; " label="Get Violation Report">
                                                                                                                                 
                                                                                                                              </q-btn> 
                                                                                                                        </div>

                                                                                                                                         
                                                                                                                      
                                                                                                                       
                                                                                                              </q-card-section>
                                                                                                              <q-card-section v-else>
                                                                                                                There is No Violation Report Commited
                                                                                                              </q-card-section>

                                                                                                                <q-card-section>
                                                                                                                    <div class="row">
                                                                                                                      
                                                                                                                     
                                                                                                                      
                                                                                                                    </div>
                                                                                                                    <div  v-if="item1.criteria.toLowerCase().includes('efficiency') && (displaydesignation.toLowerCase().includes('driver') || displaydesignation.toLowerCase().includes('conductor'))">                            
                                                                                                                        <q-btn color="grey-9" style="width: 100%;" icon="check" style="padding: 10px;" label="Get Dispatch" @click="showDispatch" ></q-btn>
                                                                                                                        </div>
                                                                                                                </q-card-section>
                                                                                                                
                                                                                                               
                                                                                                                
                                                                                                        </q-card>
                                                                                                
                                                                                               </div>
                                                                                        </div> 
        
                                                                                </td>
                                                                                <td v-for="item2 in item1.evaluation_period_scores" :key="item2.id" class="score">
                                                                                     <div class="row animated fadeInRight" style="width: 100%; ">
                                                                                                <div class="row animated fadeInDown"  style="width: 100%; color: #5D6D7E ; margin-left: 20px;" >
                                                                                                                <p>${ item1.criteria }  ${item1.percentage}%. This is a suggested score. You can edit by clicking the textfield</p>
                                                                                                </div>
                                                                                                         
                                                                                                          
                                                                                                   <q-input  standout="bg-#34495E  text-white" standard v-model="item2.score"   style="font-size: 35px;   padding: 10px; font-weight: bolder; width: 100%;" placeholder="Click to enter score" @click="score(item2.score,item1.criteria,item2.header_content,item1.percentage)"></q-input>
                                                                                                   
                                                                                                   <q-input
                                                                                                   style="font-size: 25px;   padding: 10px; font-weight: bolder; width: 100%;"
                                                                                                   v-model="item2.remarks"
                                                                                                   filled
                                                                                                   type="textarea"
                                                                                                   label="Comment"
                                                                                                 ></q-input>
                                                                                                 
                                                                                                  </div>
                                                                                
        
                                                                                </td>

                                                                             
        
                                                                      
        
        
                                                                                
                             
                                                                        </tr>
                                                                      
                                                                </tbody>
                                                                
                                                        </table>
                                                        <tr>
                                                            <!-- <q-input
                                                            style="font-size: 25px; border: solid 1px gray; background-color: white;border-radius: 10px; padding: 10px;   font-weight: bolder; width: 100%;"
                                                           
                                                           v-model="remarks"
                                                            type="textarea"
                                                            label="Enter Remarks"
                                                          ></q-input> -->



                                                          <q-btn style="width: 100%; font-size: 15px;" push  color="red" icon="check" label="Submit" @click="SAVE_EVALUATION" ></q-btn>
                                                        </tr>

                                                       
                                                        <!-- bscol -->
                                                        <!-- jobdescription -->
                                                        
                                                        

                                       </div>
                                       <div v-if="modelTitle" class="col-xs-12 col-sm-4 col-md-4 col-lg-4" style="padding: 20px; background-color: white;border-radius: 10px;" >
                                          <div class="row" style="width: 100%; margin: auto;">
                                            <span style="margin: auto;width: 100% ;text-align: center">
                                              <legend style=" ">JOB DESCRIPTION</legend>
                                              <small style="font-weight: 900 ;color:  #34495E ; font-size: 20px;;">${ modelTitle }</small>
                                             
                                            </span>

                                          </div>

                                          <div class="row" style="width: 100%; margin: auto; margin-top: 10px;;">
                                              <span style="margin: auto;width: 100% ;">
                                                  <small>Job Title</small>
                                                <legend style="font-weight:  900; color:  #34495E ; ">${modelJobTitle}</legend>
                                               
                                               
                                              </span>

                                              <span style="margin: auto;width: 100% ;">
                                                  <small>Reports To</small>
                                                  <legend style="font-weight:  900; color:  #34495E ; ">${modelReportsTo}</legend>
                                                 
                                                 
                                                </span>

                                                <span style="margin: auto;width: 100% ;">
                                                    <small>Department</small>
                                                    <legend style="font-weight:  900; color:  #34495E ; ">${modelDepartment}</legend>
                                                    
                                                   
                                                  </span>

                                                  <span style="margin: auto;width: 100% ;">
                                                      <small>Section</small>
                                                      <legend style="font-weight:  900; color:  #34495E ; ">${modelSection}</legend>
                                                      
                                                     
                                                    </span>


                                                <q-card flat bordered>
                                                        <q-card-section v-html="editor" ></q-card-section>
                                                </q-card>

  
                                            </div>

                                        </div>
                                        
                                       
                                          <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" v-else style="font-size: 20px; text-align: center; ">
                                            No Content For Job Description
                                          </div>
                                        
                                        
                                       
                                     
                                       
                                       
                                      
                                       </div>
                                       

                        </div>
                       
                  </q-card-section>
              

                </q-card>
              </q-dialog>


                <!-- evalutemaximized -->
        </div>
        <div>
                <!-- score dialog -->
                <q-dialog
                  v-model="score_dialog"
                 
                >

                <q-card style="padding: 30px; width: 100%;">
                
                    <div class="row animated fadeInDown">
                            <p>Adjust to enter score</p>
                    </div>
                    <div class="row animated fadeInDown" style="color:  #34495E">
                            <strong>${criteria_to_evaluate } ${percentage_to_evaluate}%</strong>
                 
                            
                    </div>
                    <div class="row animated fadeInDown" style="padding: 20px;" >
                                <q-slider v-model="e_firstmonth" @input="move"  :label-value="e_firstmonth+ '%'"
                                label-always :min="0" :color="e_firstmonth <= 5  ? 'red-8' : 'green' " :max="max"/>
                    </div>
                <!-- <div class="row animated fadeInDown" style="width : 500px; height: 200px; margin-top: -20px ; font-size: 15px; font-weight: 900">
                                <div v-if="e_firstmonth < 5" style="margin-left: auto;margin-right: auto">
                                                <p style="color:red">Please Give Score</p>
                                </div>
                        
                        
                        <div v-if="e_firstmonth < 75 && e_firstmonth > 5" style="margin-left: auto;margin-right: auto">
                                                <p style="color:red">Not Performed (75 below)</p>
                                        </div>
                                <div v-else-if="e_firstmonth > 75 && e_firstmonth <= 80" style="margin-left: auto;margin-right: auto">
                                                        <p style="color: tomato">Good (75 - 80)</p>
                                </div>

                                <div v-else-if="e_firstmonth > 80 && e_firstmonth <= 90" style="margin-left: auto;margin-right: auto">
                                        <p style="color: tomato">Very Good (75 - 80)</p>
                                 </div>
                                 <div v-else-if="e_firstmonth > 90 && e_firstmonth <= 100" style="margin-left: auto;margin-right: auto">
                                        <p style="color: green;">Excellent (90 - 100)</p>
                                 </div>

                </div> -->
                 
                </q-card>
                </q-dialog>
                  <!-- score dialog -->
        </div>


<q-dialog v-model="success" :position="position">
      <q-card style="width: 500px; background-color : #34495E ; color :white">
        

        <q-card-section class="row items-center no-wrap animated fadeInLeft">
          <div>
            <div class="text-weight-bold " style="color:white;">Success</div>
            <div class="text-white">Performance Evaluation ${ global_fullname } for ${ fornotification_month } is successfully saved!</div>
          </div>

          <q-space />

         
        </q-card-section>
      </q-card>
      </q-dialog>
 


 <q-dialog v-model="seemore_modal" persistent>
      <q-card style="max-width: 1020px; width: 600px">
        <div class="row" style="width: 100%; margin-top: 20px;">
          <label for=""  style=" width: 100%; text-align: center ;font-weight : 900; font-size : 18px; color: #34495E ;  ">Violations</label>
        </div>

        
     
        <q-card-section style="width: 100%; padding: 10px;margin-top: 20px; padding: 20px;" >
          <label for="" style="font-weight: 900; color: #34495E " > Filter </label>
          <q-select rounded outlined v-model="filters_offense" @input="selected_type" :value="filters_offense" :options="seemore_select" label="Square outlined" ></q-select>
        </q-card-section>
        <q-card-section style="width: 100%; padding: 10px ; -webkit-box-shadow: -7px -8px 30px -30px rgba(0,0,0,1);
        -moz-box-shadow: -7px -8px 30px -30px rgba(0,0,0,1);
        box-shadow: -7px -8px 30px -30px rgba(0,0,0,1); border-radius : 10px; " v-for="item in global_offense_to_display">
          

                   <q-card-section style="width: 100%; font-size: 20px;">
                                        Incident Date :  ${ item.IncidentDate }
                                                                              </q-card-section>
                                                                                                              <q-card-section>
                                                                                                                
                                                                                                                <div class="row">
                                                                                                                  
                                                                                                                  
                                                                                                                  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="font-size: 20px;">
                                                                                                                      NatureofOffense :
                                                                                                                    ${item.NatureofOffense}
                                                                                                                  </div>
                                                                                                                  
                                                                                                                </div>
                                                                                                                
                                                                                                              </q-card-section>
                                                                                                                <q-card-section style="width: 100% ; font-size: 20px;">
                                                                                                                       Case No. : ${ item.CaseNO }
                                                                                                                </q-card-section>
                                                                                                                <q-card-section style="width: 100% ;font-size: 20px;">
                                                                                                                      Type :  ${ item.Type }
                                                                                                                </q-card-section>
                                                                                                                <q-card-section style="width: 100%;font-size: 20px;">
                                                                                                                    Type :  ${ item.Type }
                                                                                                                    ${item.NatureofOffense}
                                                                                                              </q-card-section>
                                                                                                                <q-card-section style="width: 100%; font-size: 20px;">
                                                                                                                     Decision :   ${ item.Decision }
                                                                                                                </q-card-section>
                                                                                                                <q-card-section style="width: 100%;font-size: 20px;">
                                                                                                                        Date Decision :   ${ item.Decision }
                                                                                                                </q-card-section>
                                                                                                                <q-card-section style="width: 100% ; color: #34495E;font-size: 20px;" >
                                                                                                                  Performance Deduction :   ${ item.deduction }%
                                                                                                                  </q-card-section>
        </q-card-section>

        

        <q-card-actions align="right" class="text-primary">
         
          <q-btn flat color="gray" label="close" v-close-popup />
        </q-card-actions>
      </q-card>
    </q-dialog>





    
    

    <q-dialog v-model="showresult_modal" persistent>
      <q-card style="max-width: 1020px; width: 600px">
        <div class="row" style="width: 100%; margin-top: 20px;">
          <label for=""  style=" width: 100%; text-align: center ;font-weight : 900; font-size : 18px; color: #34495E ;  ">Summary</label>
        </div>
     
          

    <div class="row" style="width: 100%">
      <q-card class="my-card" style="width: 100%">
       
        <q-card-section>
          <!-- <div class="text-h6">Summary</div> -->
          <div class="text-subtitle2"> ${ fornotification_month } </div>
        </q-card-section>
        <q-card-section >
          
          <div class="row" style="width: 100%;color: #5D6D7E " v-for="item in FinalScore">
           
              <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4" style="padding: 5px; font-weight: 900;">
                  

                  <div v-if="item.ScoreFinal" style="font-size: 18px">
                    Total Score
                  </div>
                  <div v-else >

                    ${item.Criteria}
                  </div>


              </div>
              <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="padding: 5px; font-weight: 900;">
                
                <div v-if="item.ScoreFinal"  style="font-size: 18px">
                  ${item.ScoreFinal}
                </div>
                <div v-else >

                  ${item.Score}
                </div>
              </div>
              
              
          </div>
          
        </q-card-section>
      </q-card>

    </div>



        

        <q-card-actions align="right" class="text-primary">
         
          <q-btn flat color="gray" label="close" v-close-popup />
        </q-card-actions>
      </q-card>
    </q-dialog>


   
        
    <q-dialog
    v-model="modalviewresult"
    persistent
    :maximized="maximizedToggle"
    transition-show="slide-up"
    transition-hide="slide-down"
  >
    <q-card class="bg-white text-red">
      <q-bar>
        <q-space ></q-space>

        
        <q-btn dense flat icon="close" v-close-popup>
          <q-tooltip content-class="bg-white text-primary">Close</q-tooltip>
        </q-btn>
      </q-bar>

      <q-card-section>
        <div class="text-h6">Employee Performance</div>
      </q-card-section>
      <q-card-section>
         <q-item>
           <q-item-section top avatar>
             <q-avatar color="grey" text-color="white" icon="face" ></q-avatar>
           </q-item-section>
           <q-item-section>
             <q-item-label style="font-weight: 900; color: #273746;">${pfullname}</q-item-label>
             <q-item-label caption lines="2">${ptitle}</q-item-label>
            
          
           </q-item-section>
           
         </q-item>

      </q-card-section>


      <q-card-section>
        <div class="row">
          
          <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6" style="padding: 10px;; -webkit-box-shadow: 0px 0px 15px 0px rgba(209,198,209,1);
          -moz-box-shadow: 0px 0px 15px 0px rgba(209,198,209,1);
          box-shadow: 0px 0px 15px 0px rgba(209,198,209,1);
          
          ">
              <div class="row">
                <!-- chartjs -->
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style=" background-color: white;">
                    
                    <div class="row">
                        
                        
                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                            <legend style="color: green;"> <q-icon name="check" color="green"></q-icon> Good Performance</legend>
                        </div>
                        
                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                            <q-select v-model="model_peryearevaluation" :options="optionPeryear" label="Filter Year" filled dense debounce="300" ></q-select>
                        </div>
                        
                    </div>
                    
                    <canvas id="myChart" width="400" height="200"></canvas>
                </div>
                
              </div>

          </div>
          <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6" style="padding: 10px;; -webkit-box-shadow: 0px 0px 15px 0px rgba(209,198,209,1);
          -moz-box-shadow: 0px 0px 15px 0px rgba(209,198,209,1);
          box-shadow: 0px 0px 15px 0px rgba(209,198,209,1);">
            <div class="row">
              <!-- chartjs -->
              <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style=" background-color: white;">
                  
                  <div class="row">
                      
                      
                      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                          <!-- <legend style="color: green;"> <q-icon name="check" color="green"></q-icon> Good Performance</legend> -->
                      </div>
                      
                      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                          <!-- <q-select v-model="model_peryearevaluation" :options="optionPeryear" label="Standard" filled dense debounce="300" ></q-select> -->
                      </div>
                      
                  </div>
                  
                  <canvas id="myChartBar" width="400" height="200"></canvas>
              </div>
              
            </div>
            
        </div>







          
        </div>


        <div class="row">

            
            <div class="col-xs-12 col-sm-8 col-md-8 col-lg-8">
                
                        <q-table

                              
                          style="width: 100%"
                          :data="dataperformance"
                          :columns="columnsperformance"
                          row-key="id"
                          selection="single"
                          :selected.sync="selectedperformance"
                          :filter="termsperformance"
                          title="Performance Evaluation Period"
                              
                            

                          >
                          <!-- hai -->

                          <template  slot="top-selection" >
<!-- 
                                      <div>
                                          <q-tooltip >
                                          Click to Evaluate
                                          </q-tooltip>
                                          <q-btn push class="animated fadeInDown" dense color="red-8" label="Start Evaluate"  icon="visibility" ></q-btn>
                                          
                                      </div>  -->
                                    
                                      <div class="row animated fadeInDown">
                                          
                                          <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                              <q-btn flat icon="visibility"  style="color:#34495E " :label="item.month_name"  v-if="DISPLAYPERMONTH" v-for="item in DISPLAYPERMONTH" >
                                            
                                                <q-popup-proxy>
                                                    <q-banner>
                                                      <!-- abi -->
                                                     
                                                      <q-item-section>
                                                          
                                                          <q-item-label caption lines="2" v-for="item2 in item.criteriascore" >
                                                              <q-item-label  v-if="item2.criteria" style="color: red;">${ item2.criteria }  </q-item-label>
                                                             <p  v-if="item2.criteria" style="color: orange;">${ item2.score }%. <br>
                                                              <q-item-label  v-if="item2.remarks" style="color: green;">Rater Remarks <br> ${ item2.remarks }  </q-item-label>
                                                            </p>
                                                            

                                                              <q-item-label v-if="item2.average" style="color: red;"> Total  </q-item-label>
                                                              <p style="color: orange;" v-if="item2.average">${ item2.average }%.</p>
                                                              
                                                              
                                                            

                                                            </q-item-label>
                                                         

                                                        </q-item-section>
                        
                                                    </q-banner>
                                                  </q-popup-proxy>
                                                </q-btn>
                                                <q-item>
                                                  
                                                  <q-item-section>
                                                    <q-item-label >Total Score</q-item-label>
                                                    <q-item-label caption lines="2" :style="DISPLAYPERMONTH.average < 75 ? 'color: red;' : 'color: green;'"> ${DISPLAYPERMONTH.average}% 
                                                      
                                                      <small v-if="DISPLAYPERMONTH.average >= 85 && DISPLAYPERMONTH.average <=100 " style="color: green" > 
                                                        Well Performed <q-icon  style="font-size: 15px;" name="sentiment_very_satisfied" ></q-icon>
                                                      </small>
                                                      <small v-else-if="DISPLAYPERMONTH.average >= 75 && DISPLAYPERMONTH.average <=84" style="color: orange" > 
                                                         Need Improvement  <q-icon  style="font-size: 15px;" name="sentiment_satisfied" ></q-icon>
                                                      </small>
                                                      <small v-else-if="DISPLAYPERMONTH.average > 0 && DISPLAYPERMONTH.average < 75" style="color: red" > 
                                                        Bad Performance  <q-icon style="font-size: 15px;" name="sentiment_dissatisfied" ></q-icon>
                                                      </small>
                                                      
                                                    </q-item-label>
                                                  </q-item-section>
                                                  <q-item-section side top>
                                                   
                                                  </q-item-section>
                                                </q-item>


                                          </div>
                                          
                                      </div>
                

                                        
                          </template>



                              <template v-slot:top-right>
                            
                          <q-input outlined  v-model="termsperformance" style="width: 200px;padding: 10px;"  filled  dense debounce="300"  placeholder="Search">
                                  <template v-slot:append>
                                    <q-icon name="search" ></q-icon>
                                  </template>
                              </q-input>
                            
                            
                            
                            
                          


                                


                          
                            </template>



                          </q-table>




                          



            </div>
            
            
            

            
            <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="padding: 10px; ">
              <div class="row">
                
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                  <legend style="font-size: 18px; font-weight: 900;">Commendation</legend>
                  <q-btn color="red" icon="add_comment" outlined ></q-btn>
                </div>
                
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="-webkit-box-shadow: 0px 0px 15px 0px rgba(209,198,209,1);
                -moz-box-shadow: 0px 0px 15px 0px rgba(209,198,209,1);
                box-shadow: 0px 0px 15px 0px rgba(209,198,209,1);
                
                ">
                  <q-item>
                    <q-item-section top avatar>
                      <q-avatar color="orange" text-color="white" icon="star" ></q-avatar>
                    </q-item-section>
                    <q-item-section>
                      <q-item-label>Single line item</q-item-label>
                      <q-item-label caption lines="2">Secondary line text.</q-item-label>
                    </q-item-section>
                    <q-item-section side top>
                      <q-item-label caption>5 min ago</q-item-label>
                      <q-icon name="star" color="yellow" ></q-icon>
                    </q-item-section>
                  </q-item>
                </div>
                
                
              </div>
            </div>
            
            

        </div>

       
      </q-card-section>
    </q-card>
  </q-dialog>





            <!-- andi -->
            <q-dialog
            v-model="dialog_complaint"
            persistent
            :maximized="maximizedToggle_complaint"
            transition-show="slide-up"
            transition-hide="slide-down"
          >
            <q-card class="bg-orange text-white">
              <q-bar>
                <q-space ></q-space>
      
                <q-btn dense flat icon="minimize" @click="maximizedToggle_complaint = false" :disable="!maximizedToggle_complaint">
                  <q-tooltip v-if="maximizedToggle_complaint" content-class="bg-white text-primary">Minimize</q-tooltip>
                </q-btn>
                <q-btn dense flat icon="crop_square" @click="maximizedToggle_complaint = true" :disable="maximizedToggle_complaint">
                  <q-tooltip v-if="!maximizedToggle_complaint" content-class="bg-white text-primary">Maximize</q-tooltip>
                </q-btn>
                <q-btn dense flat icon="close" v-close-popup>
                  <q-tooltip content-class="bg-white text-primary">Close</q-tooltip>
                </q-btn>
              </q-bar>
      
              <q-card-section>
                <div class="text-h6">Complaint Record of Employee</div>
              </q-card-section>
      
              <q-card-section style="height: 100%; background-color: white;">

                                                                                
                                                                <q-table
                                                                 
                                                                style="width: 100%"
                                                                :data="data_comlaints"
                                                                :columns="columns_complaints"
                                                              
                                                               
                                                                :selected.sync="selected_complaints"
                                                                :filter="terms_complaints"
                                                                    grid
                                                                    title="Evaluation "
                        dark
                                                                >
                                                                <!-- hai -->

                                                                <template  slot="top-selection" >

                                                                            <!-- <div>
                                                                                <q-tooltip >
                                                                                Click to Evaluate
                                                                                </q-tooltip>
                                                                                <q-btn push class="animated fadeInDown" dense color="red-8" label="Start Evaluate"  icon="launch" @click="event_evaluate" ></q-btn>
                                                                                
                                                                            </div> -->
                                                                </template>

                                                                    <template v-slot:top-right>
                                                                     
                                                                      <div style="width: 300px;padding: 10px;">
                                                                        <q-select  outlined  dense debounce="300" v-model="model_filter_complaint" :value="model_filter_complaint" @input="filtermoyungcomplaint" :options="options_filtercustomercomplaint" filled label="Filter" ></q-select>
                                                                        <!-- :options="options_terminal" -->
                                                                    </div>

                                                                <q-input outlined  style="width: 200px;padding: 10px;"  v-model="terms_complaints" filled  dense debounce="300"  placeholder="Search">
                                                                        <template v-slot:append>
                                                                          <q-icon name="search" ></q-icon>
                                                                        </template>
                                                                    </q-input>
                                           
                                                                  </template>

                                                                </q-table> 




              </q-card-section>
            </q-card>
          </q-dialog>
    




          

            <!-- andi -->
            <q-dialog
            v-model="dialog_commendation"
            persistent
            :maximized="maximizedToggle_commendation"
            transition-show="slide-up"
            transition-hide="slide-down"
          >
            <q-card class="bg-green text-white">
              <q-bar>
                <q-space ></q-space>
      
                <q-btn dense flat icon="minimize" @click="maximizedToggle_commendation = false" :disable="!maximizedToggle_commendation">
                  <q-tooltip v-if="maximizedToggle_commendation" content-class="bg-white text-primary">Minimize</q-tooltip>
                </q-btn>
                <q-btn dense flat icon="crop_square" @click="maximizedToggle_commendation = true" :disable="maximizedToggle_commendation">
                  <q-tooltip v-if="!maximizedToggle_commendation" content-class="bg-white text-primary">Maximize</q-tooltip>
                </q-btn>
                <q-btn dense flat icon="close" v-close-popup>
                  <q-tooltip content-class="bg-white text-primary">Close</q-tooltip>
                </q-btn>
              </q-bar>
      
              <q-card-section>
                <div class="text-h6">Commendation Record of Employee</div>
              </q-card-section>
      
              <q-card-section style="height: 100%; background-color: white;">

                                                                                
                                                                <q-table
                                                                 
                                                                style="width: 100%"
                                                                :data="data_commendation"
                                                                :columns="columns_commendation"
                                                                
                                                                
                                                                :selected.sync="selected_commendation"
                                                                :filter="terms_commendation"
                                                                    grid
                                                                    title="Evaluation "
                        dark
                                                                >
                                                                <!-- hai -->

                                                                <template  slot="top-selection" >

                                                                            <!-- <div>
                                                                                <q-tooltip >
                                                                                Click to Evaluate
                                                                                </q-tooltip>
                                                                                <q-btn push class="animated fadeInDown" dense color="red-8" label="Start Evaluate"  icon="launch" @click="event_evaluate" ></q-btn>
                                                                                
                                                                            </div> -->
                                                                </template>

                                                                    <template v-slot:top-right>
                                                                     
                                                                      <div style="width: 300px;padding: 10px;">
                                                                        <q-select  outlined  dense debounce="300" v-model="model_filter_commendation" :value="model_filter_commendation" @input="filtermoyungcommendation" :options="options_filtercustomercommendation" filled label="Filter" ></q-select>
                                                                        <!-- :options="options_terminal" -->
                                                                    </div>

                                                                <q-input outlined  style="width: 200px;padding: 10px;"  v-model="terms_commendation" filled  dense debounce="300"  placeholder="Search">
                                                                        <template v-slot:append>
                                                                          <q-icon name="search" ></q-icon>
                                                                        </template>
                                                                    </q-input>
                                           
                                                                  </template>

                                                                </q-table> 




              </q-card-section>
            </q-card>
          </q-dialog>
    






    







    



    <q-dialog v-model="modal_dispatch">
        <q-card style="width: 1200px; max-width: 1200px;">
        
              <q-card-section  class="row items-center" style="padding: 30px; width: 100%;">
             
                  <div class="row" style="width: 100%;">
                            
                    
                      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                          <label for="" style="font-size: 18px ; color: #273746; font-weight: 900;"> Dispatch Report</label>
                       <br>   <label for="" style="font-size: 15px ; color: #273746; font-weight: 900; "> Filter</label>
                      
                        </div>


                      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                       
                       
                        <q-select v-model="model_filterdate" rounded  :value="model_filterdate" @input="filter_dispatch(DispatchReport_final)" :options="optionyear" label="Select Year"  ></q-select>
                      </div>
                      
                      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                        <q-select v-model="modelfiltermonth" rounded  :value="modelfiltermonth" @input="filter_dispatch(DispatchReport_final)" :options="optionmonth" label="Select Month"  ></q-select>
                      </div>
                      
                    </div>
                     <table class="table table-hover">
                       <thead>
                         <tr>
                           <th>EmpCode</th>
                           <th>FullName</th>
                           <th>EmpPosition</th>
                           <th>Location</th>
                           <th>Active</th>
                           <th>DepartureTime</th>
                           <th>ArrivalTime</th>
                           <th>KMRun</th>
                           <th>Busno</th>
                           <th>Route</th>
                           <th>Date</th>
                           

                         </tr>
                       </thead>
                       <tbody>
                         <tr  v-for="item in DispatchReport_final">
                           <!-- <td v-for="item in DispatchReport_final">

                           </td> -->
                           <td>${item.EmpCode}</td>
                           <td>${item.FullName}</td>
                           <td>${item.EmpPosition}</td>
                           <td>${item.Location}</td>
                           <td>${item.Active}</td>
                           <td>${item.DepartureTime}</td>
                           <td>${item.ArrivalTime}</td>
                           <td>${item.KMRun}</td>
                           <td>${item.Busno}</td>
                           <td>${item.Route}</td>
                           <td>${ item.date_created }</td>
                         </tr>


                        
                       </tbody>
                     </table>
                     
                    
                     
                     
                    </div>
                    
                        </div>
                        


                    
                </q-card-section>
                
          
            <!-- hai -->
          
          
      
        
        
          <q-card-actions align="center">
              <q-btn push  label="Close" color="grey" v-close-popup ></q-btn>
           
          </q-card-actions>
        </q-card>
      </q-dialog>


    




        
     
     


      


 

         
{% endblock %}

{% block script %}


<script>
new Vue({
    el: '#app',
    delimiters: ['${','}'],
    data: function () {
      return {
        drawerState: false,
        pic_user : 'http://res.heraldm.com/phpwas/restmb_jhidxmake.php?idx=5&simg=201701181539234376570_20170118154018_02.jpg',
        dash : {
            backgroundColor : '#273746',
           color : 'white'
           },
           
           Deliberation : {
           backgroundColor : '#273746',
           color : 'white',
       },

       employee : {
            backgroundColor : '#273746',
           color : 'white'
           },
           performance_evaluation : {
           backgroundColor : '#273746',
           color : 'white',
        
       },
       settings : {
            backgroundColor : '#273746',
           color : 'white'
           },
           Deliberation : {
           backgroundColor : '#273746',
           color : 'white',
       },
       report : {
           backgroundColor : '#273746',
           color : 'white',
       },
       concern : {
           backgroundColor : '#273746',
           color : 'white',
       },
       model_filterdate : '',
   
      
        // kinuha ko dito ang table
        

        dialog_evaluate : false,
        maximizedToggle: true,
        type_of_evaluation : 'Performance Evaluation of Temporary/Probationary Employees',
        e_firstmonth : '',
        score_dialog : false,
        evaluation_content : [
                  
                         
        ],
        evaluation_period_header : [
       
         
               
        ],
        global_hostname : '',
        
        evaluation_sheet_criteria : [],
        cr : '',
        mo : '',
        options_terminal : [
        
          'Cubao', 'Caloocan', 'Baguio','--no-filter--'
         
            
          
          
        ],
          options_department : [
        
          'HR', 'Operation', 'Legal','Audit','Maintainance','Purchasing','--no-filter--'
          
          
        ],
        whatmonthtobeevaluate : '',
        max: 20,
        criteria_to_evaluate : '',
        percentage_to_evaluate : 0,
        global_empcode : '',
        employee_violation_final : [],
        //lis of violation per criteria
        violation_criteria_depertment : [
       
                   
               
        ],
         token : '',
         who_used : [],
         minororgrave : [],
         //09212019
         EVALUATION_PERIOD_OF_EMPLOYEE  : [],
          EVALUATION_PERIOD_PER_MONTH : [],
          EVALUATION_PERIOD_PER_CRITERIA : [],
          displayfirstname : 'fir',
          displaylastname : 'jj',
          displaymiddldname : 'fdfd',
          displaydatehired : '09/12/45',
          displaydesignation : 'drvier',
          displaydepartmentsection : 'Operation' ,   
          displayplaceofassignment : 'cubao', 
          displayjobstatus : '',  
          
          lengthofevaluationperiod : 0,
          id_period : '',
          headermonth : '',
          global_fullname : '',
          global_month : '',
          success : false,
          position : 'top',
          remarks : '-',
          fornotification_month : '',
          loadingState_search : false,
          search_info : '',
          EvaluationResult : [],
          load : false,
          seemore_modal : false,
          seemore_select : [
            'Minor','Grave','All'
          ],
          filters_offense : '',

          global_offense : [],
          global_offense_to_display : [],
        empcode : '',
        FinalScore : [],
        showresult_modal : false,
        month_sumarry : '',

        attendance: '',
        optionsss: ['2019/10/01','2019/10/02','2019/10/03','2019/10/04'],
        TimeKeeping : [],
        editor : '',
        modelTitle : '',
        modelDepartment : '',
        modelJobTitle : '',
        modelReportsTo : '',
        modelSection : '',
        Dispatch : [],
        options : [],
        DispatchReport :[],
        DispatchReport_final  : [],
        Dispatch_for_filter : [],
        model_filterdate : '',
        filterdate : ['Oct 2019','All'],
        modal_dispatch : false,
        optionyear : [],
        modelfiltermonth : '',
        optionmonth : [],
        Attendanceoptions : ['2019/02/01', '2019/02/05', '2019/02/06', '2019/02/09', '2019/02/23'],
        tab : 'Mails',
        EmployeesNeedtoEvaluate : [],
        employee_list_selected : [],
        filterneed : 'outline',
        filteralaready : 'outline',
        filterall : 'outline',
        TODAYEVAUATIONPERMONTH : [],

          Employeesinformation : [],
          globalindex : 0,
          modalviewresult : false ,
          optionPeryear : ['2016','2017','2019'],
          model_peryearevaluation : '',
          pjanuary : 0,
          pfebruary : 0,
          pmarch : 0,
          papril :0,
          pmay:0,
          pjune :0,
          pjuly : 0,
          paugust : 0,
          pseptember : 0,
          poctober : 0,
          pnovember : 0,
          pdecember : 0,
          Criterias : ['Efficiency','QualityofWork',],
          CriteriasScore : [45,50,],
          
          columnsperformance: [
                    
          { name: 'evaluation_period', label: 'Evaluation Period No.', field: 'evaluation_period' },
                    {
                    name: 'desc',
                    required: true,
                    label: 'EmpCode',
                    align: 'left',
                    field: row => row.empcode,
                    format: val => `${val}`,
                    sortable: true
                  },
                  { name: 'supervisorrater', label: 'Rater', field: 'supervisorrater' },
                  { name: 'length_period', label: 'Duration', field: 'length_period', sortable: true },
                  { name: 'date_created', label: 'Date', field: 'date_created' },

                  { name: 'FirstName', align: 'center', label: 'Full Name', field: 'employeefullname', sortable: true },
                  { name: 'designation', align: 'center', label: 'Job Title', field: 'designation', sortable: true },
                  { name: 'departmentsection', label: 'Department', field: 'departmentsection', sortable: true },
                  
                 
                ],
               

                dataperformance: [
                        
                ],
          selectedperformance : [],

          termsperformance: '',
          pfullname : '',
          ptitle : '',
          PERMONTHSCORE : [],
          CRITERIASCORE : [],
          DISPLAYPERMONTH : [],
          globalEmpcode : '',
          all_criteria : [],
          CustomerConcern : [],
          data_customer_concern  : [],
          dialog_complaint: false,
maximizedToggle_complaint: false,

columns_complaints: [
          
        
        { name: 'Name', align: 'center', label: 'Customer Name', field: 'Name', sortable: true },
        { name: 'Topic', align: 'center', label: 'Complaint', field: 'Topic', sortable: true },
        { name: 'YourConcern', label: 'Message', field: 'YourConcern', sortable: true },
        { name: 'OtherConcern', label: 'Other', field: 'OtherConcern' },
        { name: 'date_created', label: 'Date', field: 'date_created' },
        { name: 'time', label: 'Time', field: 'time' },
     
      ],
      data_comlaints: [
               
      ],
selected_complaints : [],

terms_complaints: '',
options_filtercustomercomplaint : [],
model_filter_complaint : '',
globalEMployeeCode : '',

dialog_commendation: false,
maximizedToggle_commendation: false,

columns_commendation: [
          
        
        { name: 'Name', align: 'center', label: 'Customer Name', field: 'Name', sortable: true },
        { name: 'Topic', align: 'center', label: 'Complaint', field: 'Topic', sortable: true },
        { name: 'YourConcern', label: 'Message', field: 'YourConcern', sortable: true },
        { name: 'OtherConcern', label: 'Other', field: 'OtherConcern' },
        { name: 'message', label: 'Message', field: 'message' },
        { name: 'date_created', label: 'Date', field: 'date_created' },
        { name: 'time', label: 'Time', field: 'time' },
     
      ],
      data_commendation: [
               
      ],
selected_commendation : [],

terms_commendation: '',
options_filtercustomercommendation : [],
model_filter_commendation : '',





                    
        // state
        
       
      
         
                                                   
       
        
      }
    },
    computed: {
      layout () {
        return this.$q.screen.lt.sm ? 'dense' : (this.$q.screen.lt.md ? 'comfortable' : 'loose')
      }
    },
    watch: {
      model_peryearevaluation : function(){
        // here
        var year = this.model_peryearevaluation
        this.performanceperyer(year)
      },
      selectedperformance(newValue, oldValue) {
        
          var data = newValue
          var month = this.PERMONTHSCORE
        var result = month.filter(
          (element)=>{
            return element.evaluation_period == data[0].id
          }
        )

        
        
        var temp = []
        var monthevaluated = []
         for (let index = 0; index < result.length; index++) {
           const element = result[index];
            

           var obj = {
            "id": element.id,
            "empcode": element.empcode,
            "evaluation_period": element.evaluation_period,
            "month_name": element.month_name,
            "remarks": element.remarks,
            "date_created": new Date(element.date_created).toString().substring(0,15),
            "criteriascore" : this.getSCOREPERMONT(element.id)

         }
         temp.push(obj)
        //  best
                if(index == result.length - 1){
                  console.log('PERMONMFHT')
                  console.log(temp)
                  
                  var average = 0
                      for (let index = 0; index < temp.length; index++) {
                        const element = temp[index];
                        var value = element.criteriascore[element.criteriascore.length - 1].average
                     
                        average = average + value

                        
                        if(index == temp.length - 1 ){
                          temp.average = average / temp.length
                          this.DISPLAYPERMONTH = temp
                          
                        }
                  }
                  
                }  
            }



            
    }
    },

    methods: {
      event_show_complaint(){
        this.dialog_complaint = true
        
        // data_comlaints
      },
      event_show_commendation(){
        this.dialog_commendation = true
        
        // data_comlaints
      },
      averagecoputer(){

      },
      performanceperyer(year){
        
        
          this.pjanuary = 0
          this.pfebruary = 0
          this.pmarch = 0
          this.papril = 0
          this.pmay = 0
          this.pjune = 0
          this.pjuly = 0
          this.paugust = 0
          this.pseptember = 0
          this.poctober = 0
          this.pnovember = 0
          this.pdecember = 0
          
       
        var monthscore = this.DISPLAYPERMONTH
        var emp = this.globalEmpcode
   
       



        var month = this.PERMONTHSCORE
        var result = month.filter(
          (element)=>{
            return new Date(element.date_created).getFullYear() == year && element.empcode == emp
          }
        )
    

        
        
        var temp = []
        var monthevaluated = []
         for (let index = 0; index < result.length; index++) {
           const element = result[index];
            
          var feb = this.getSCOREPERMONT(element.id)
          console.log(feb)
         
           var obj = {
            "id": element.id,
            "empcode": element.empcode,
            "evaluation_period": element.evaluation_period,
            "month_name": element.month_name,
            "remarks": element.remarks,
            "date_created": new Date(element.date_created).toString().substring(0,15),
            "criteriascore" : this.getSCOREPERMONT(element.id)

         }
         temp.push(obj)
         if((new Date(element.date_created).getMonth() + 1) == 1 ){
           this.pjanuary =  obj.criteriascore[obj.criteriascore.length - 1 ].average
         }
         if((new Date(element.date_created).getMonth() + 1) == 2 ){
           this.pfebruary = obj.criteriascore[obj.criteriascore.length - 1 ].average        
         }
         if((new Date(element.date_created).getMonth() + 1) == 3 ){
           this.pmarch =  obj.criteriascore[obj.criteriascore.length - 1 ].average
         }
         if((new Date(element.date_created).getMonth() + 1) == 4 ){
           this.papril = obj.criteriascore[obj.criteriascore.length - 1 ].average        
         }
         if((new Date(element.date_created).getMonth() + 1) == 5 ){
           this.pmay = obj.criteriascore[obj.criteriascore.length - 1 ].average        
         }
         if((new Date(element.date_created).getMonth() + 1) == 6 ){
           this.pjune = obj.criteriascore[obj.criteriascore.length - 1 ].average        
         }
         if((new Date(element.date_created).getMonth() + 1) == 7 ){
           this.pjuly = obj.criteriascore[obj.criteriascore.length - 1 ].average        
         }
         if((new Date(element.date_created).getMonth() + 1) == 8 ){
           this.paugust = obj.criteriascore[obj.criteriascore.length - 1 ].average        
         }
         if((new Date(element.date_created).getMonth() + 1) == 9 ){
           this.pseptember = obj.criteriascore[obj.criteriascore.length - 1 ].average        
         }
         if((new Date(element.date_created).getMonth() + 1) == 10 ){
           this.poctober = obj.criteriascore[obj.criteriascore.length - 1 ].average        
         }
         if((new Date(element.date_created).getMonth() + 1) == 11 ){
           this.pnovember = obj.criteriascore[obj.criteriascore.length - 1 ].average        
         }
         if((new Date(element.date_created).getMonth() + 1) == 12 ){
           this.pdecember = obj.criteriascore[obj.criteriascore.length - 1 ].average        
         }
        
         if(index == result.length - 1){
                  console.log('PERMONMFHT============================================================')
                  console.log(temp)
                  
                  var average = 0
                      for (let index = 0; index < temp.length; index++) {
                        const element = temp[index];
                        var value = element.criteriascore[element.criteriascore.length - 1].average
                     
                        average = average + value


                        
                        if(index == temp.length - 1 ){
                          temp.average = average / temp.length

                     
                          console.log()
                          
                        }
                  }
                  
                }  


        
        
        //  best
                // if(index == result.length - 1){
                //   console.log('PERMONMFHT')
                //   console.log(temp)
                  
                //   var average = 0
                //       for (let index = 0; index < temp.length; index++) {
                //         const element = temp[index];
                //         var value = element.criteriascore[element.criteriascore.length - 1].average
                     
                //         average = average + value

                        
                //         if(index == temp.length - 1 ){
                //           temp.average = average / temp.length
                //           this.DISPLAYPERMONTH = temp
                          
                //         }
                //   }
                  
                // }  
       }



       var criteriaperyear = this.CRITERIASCORE 
       var info = criteriaperyear.filter(
              (element)=>{
                return new Date(element.date_created).getFullYear() == year && element.empcode == emp
              }
       )

              // hai

       console.log('muadhfasdf======================================')
       console.log(info)
       console.log(this.all_criteria)
       var results = []
       var counter = 0
       for (let index = 0; index < this.all_criteria.length; index++) {
         const elements = this.all_criteria[index];
          var  score = info.filter(
            (element)=>{
              return element.criteria.toLowerCase() == elements.toLowerCase()
            }
          )
            console.log(score.length)
            var ave = this.controlscore(elements,score)
            console.log(parseInt(ave))
            // itona
          

            this.CriteriasScore.push(ave)
         
           

          

         
       }
        
        
        this.getchart()
          // pjanuary : 0,
          // pfebruary : 0,
          // pmarch : 0,
          // papril :0,
          // pmay:0,
          // pjune :0,
          // pjuly : 0,
          // paugust : 0,
          // pseptember : 0,
          // poctober : 0,
          // pnovember : 0,
          // pdecember : 0,

      },
       controlscore(element,data){
        
        console.log(data)
        console.log(element)
        var result = 0
        for (let index = 0; index < data.length; index++) {
          const element = data[index];
            result = result + element.score
            if(index == data.length - 1){
              return result 
              
            }
        }
       },
      //predefidned
      
      logout(){
              axios.post(`${this.global_hostname}/logout/`,{
                   headers: {
                               'Content-Type': 'application/json',
                                  'X-CSRFToken': this.token
                   }
              })
              .then(res => {
                  window.location.replace(`${this.global_hostname}/login/`)
              })
              .catch(err => {
              })
        },
        getSCOREPERMONT(idmonth){
          var criteriascore = this.CRITERIASCORE 
          var natira = criteriascore.filter(
            (element)=>{
              return element.evaluation_period_per_month == idmonth
            }
          )
          //kukunin  ko ang average
          var total = 0
          for (let index = 0; index < natira.length; index++) {
            const element = natira[index];
            total = total + parseFloat(element.score)
            if(index == natira.length - 1){
             // var final = total / natira.length
             var final = total
              natira.push({'average' : final })
              return natira
            }
            
          }
        
            // var info = criteriascore.filter(
            //   (element)=>{
            //     r
            //   }
            // )
        },
        // start
        displayEvaluationPeriod(data){
         
          // format date
          var temptable = []
          for (let index = 0; index < data.length; index++) {
            const element = data[index];
                    var obj = {
                  "id": element.id,
                  "empcode": element.empcode,
                  "employeefullname": element.employeefullname,
                  "datehired": new Date(element.datehired).toString().substring(0,15),
                  "designation": element.designation,
                  "departmentsection": element.departmentsection,
                  "placeofassignment": element.placeofassignment,
                  "supervisorrater": element.supervisorrater,
                  "evaluation_period": element.evaluation_period,
                  "length_period": element.length_period,
                  "date_created": new Date(element.date_created).toString().substring(0,15),

                  }
                  temptable.push(obj)
                  if(index == data.length - 1){
                    console.log('Evaluationperiond')
                    this.dataperformance = temptable
                console.log(temptable)
                  }



            
          }
         
        },
        displayinfotion(data){
          this.pfullname = `${data.FirstName} ${data.MiddleName} ${data.LastName}`
          this.ptitle = `${data.Designation} at ${data.PlaceOfAssignment} | ${data.JobStatus} `
          
        },
        // today
        eventresults(data){
          this.dataperformance = []
          this.pjanuary = 0
          this.pfebruary = 0
          this.pmarch = 0
          this.papril = 0
          this.pmay = 0
          this.pjune = 0
          this.pjuly = 0
          this.paugust = 0
          this.pseptember = 0
          this.poctober = 0
          this.pnovember = 0
          this.pdecember = 0
          


          this.modalviewresult = true
          var empDATA  = data[0]
          console.log('empdat')
          console.log(empDATA.EmpCode)
          this.globalEmpcode = empDATA.EmpCode

         
          this.displayinfotion(empDATA)
        
          //employeeinformation
          // getperiod

          axios.get(`${this.global_hostname}/api/POST_EVALUATION_PERIOD/`,{
             headers: {
                   'Content-Type': 'application/json',
                    'X-CSRFToken': this.token
             }  
          })
          .then(res => {
            console.log(res)

            this.getresultmonth(res.data,empDATA)
            //evaluation period
            var data = res.data.filter(
              (element)=>{
                return element.empcode == empDATA.EmpCode
              }
            )
              this.displayEvaluationPeriod(data)
          })
          .catch(err => {
            console.error(err); 
          })
         


        },
        getresultmonth(period,empdata){
         
         
          axios.get(`${this.global_hostname}/api/GET_PER_MONTH/`,{
             headers: {
                   'Content-Type': 'application/json',
                    'X-CSRFToken': this.token
             }
            
          })
          .then(res => {
            var permonth = res.data
            this.PERMONTHSCORE = permonth
            this.getcriteria(permonth,period,empdata)

         

            //get all criterias
            axios.get(`${this.global_hostname}/api/get/Get_EvaluationSheet_Criteria/`,{
              
               headers: {
                     'Content-Type': 'application/json',
                      'X-CSRFToken': this.token
               }
              
            })
            .then(res => {
                var temp = []
                for (let index = 0; index < res.data.length; index++) {
                  const element = res.data[index];
                  temp.push(element.criteria)
                    if(index == res.data.length - 1){
                        this.all_criteria = temp
                    }
                  
                }
            })
            .catch(err => {
              console.error(err); 
            })
           
            
          })
          .catch(err => {
            console.error(err); 
          })

        },
        getcriteria(permonth,period,empdata){

          

            axios.get(`${this.global_hostname}/api/GET_PER_CRITERIA/`,{
               headers: {
                     'Content-Type': 'application/json',
                      'X-CSRFToken': this.token
               }
              
            })
            .then(res => {
              var criteria = res.data
              this.CRITERIASCORE = res.data
              console.log('ayyayayay')
            console.log(empdata)
            console.log(period)
            console.log(permonth)
            console.log('criteria==========================================================================')
            console.table(criteria)
            // last
            
          this.performanceperyer(new Date().getFullYear())
          
            })
            .catch(err => {
              console.error(err); 
            })

        },
        getchart(){
          // chartjs
          var ctx = document.getElementById('myChart').getContext('2d');
var myChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ['January', 'February', 'March', 'April', 'May', 'June','July','August','September','October','November','December'],
        datasets: [{
            label: 'Evaluation Per Year',
            data: [this.pjanuary,this.pfebruary,this.pmarch,this.papril,this.pmay,this.pjune,this.pjuly,this.paugust,this.pseptember,this.poctober,this.pnovember,this.pdecember],
            fill : false,
            backgroundColor: 'green'
                
            ,
             borderColor: 'green',
               
           
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        }
    }
});

// itona

var ctx = document.getElementById('myChartBar').getContext('2d');
      var myChart = new Chart(ctx, {
          type: 'bar',
          data: {
              labels:this.all_criteria,
              datasets: [{
                  label: 'Performance in Criteria',
                  data: this.CriteriasScore,
                  fill : false,
                  backgroundColor: '#5D6D7E'
                      
                  ,
                   borderColor: '#5D6D7E',
                     
                 
                  borderWidth: 1
              }]
          },
          options: {
              scales: {
                  yAxes: [{
                      ticks: {
                          beginAtZero: true
                      }
                  }]
              }
          }
      });


      
        },

        eventall(index){
          this.globalindex = index
          // console.log(this.Employeesinformation)
          // this.EmployeesNeedtoEvaluate = this.Employeesinformation
          // console.log(this.EmployeesNeedtoEvaluate)
          this.get_list_employee()

        },
        eventalreadyevaluated(aarrayndexofn){
       
       

                  
          axios.get(`${this.global_hostname}/api/Employee/`,{
          
          headers: {
                'Content-Type': 'application/json',
                 'X-CSRFToken': this.token
          }

         
       })
       .then(res => {
    
         this.data = res.data
          // jordan

          axios.get(`${this.global_hostname}/api/JOBSTATUS/`,{

             headers: {
                   'Content-Type': 'application/json',
                    'X-CSRFToken': this.token
             }
            
          })
          .then(res => {
            console.log(res)
            var JOBSTATUS = res.data
            var temporary_data = []
            for (let index = 0; index < JOBSTATUS.length; index++) {
              const element = JOBSTATUS[index];
             // jordan kapag admin kita lahat pag supervisor filter per assignment or joblevels
               var info = this.data.filter(
                 (elements)=>{
                   return elements.JobStatus.toLowerCase() == element.for_employee_status.toLowerCase()
                 }
               )
                //  hala

             //   this.EVALUATION_PERIOD_PER_MONTH

               console.log('fsdafsdfsf========================')
              console.log(info)
               var obj ={
                 "jobstatus" : element.for_employee_status,
                 "employeeList" : {
                           employee_list_selected: [],
             
                           columns: [
                           
                           {
                           name: 'desc',
                           required: true,
                           label: 'EmpCode',
                           align: 'left',
                           field: row => row.EmpCode,
                           format: val => `${val}`,
                           sortable: true
                         },
                         { name: 'FirstName', align: 'center', label: 'First Name', field: 'FirstName', sortable: true },
                         { name: 'MiddleName', align: 'center', label: 'Middle Name', field: 'MiddleName', sortable: true },
                         { name: 'LastName', label: 'Last Name', field: 'LastName', sortable: true },
                         { name: 'Suffix', label: 'Suffix', field: 'Suffix' },
                         { name: 'NickName', label: 'NickName', field: 'NickName' },
                         { name: 'JobLevel', label: 'Job Level', field: 'JobLevel' },
                         { name: 'JobStatus', label: 'Job Status', field: 'JobStatus' },
                         { name: 'Department', label: 'Department', field: 'Department', sortable: true },
                         { name: 'Designation', label: 'Designation', field: 'Designation', sortable: true },
                         { name: 'ContactNumber', label: 'ContactNumber', field: 'ContactNumber', sortable: true },
                       ],
                       data: info,
                               
                       
                 }
                 
                   
               }
               temporary_data.push(obj)
               
               if(index == JOBSTATUS.length - 1){

                
                 this.EmployeesNeedtoEvaluate = temporary_data
                 this.Employeesinformation = temporary_data
                console.log('check')
                 console.table(temporary_data[aarrayndexofn].employeeList.data)
                 
                 
               this.tab = this.EmployeesNeedtoEvaluate[aarrayndexofn].jobstatus
              
                  var d = new Date()
                  var todaymonth = `${d.getMonth()}${d.getFullYear()}`
                 
                  //compare patiyer
               var getempcode = this.EVALUATION_PERIOD_PER_MONTH.filter(
                 (element)=>{
                      return `${new Date(element.date_created).getMonth()+1}${new Date(element.date_created).getFullYear()}` == todaymonth
                 }
               )
               console.log(getempcode)
               //itoyung sa table
                 var datahere = []
               for (let index = 0; index < temporary_data[aarrayndexofn].employeeList.data.length; index++) {
                 const element2 = temporary_data[aarrayndexofn].employeeList.data[index];
                  var checklength = getempcode.filter(
                    (element)=>{
                      return element.empcode == element2.EmpCode
                    }
                  )
                   
                  if(checklength.length > 0){
                    
                    // 
                    datahere.push(element2)
                    console.log(datahere)
                  }
                  if(index ==  temporary_data[aarrayndexofn].employeeList.data.length - 1 ){
                    this.EmployeesNeedtoEvaluate[aarrayndexofn].employeeList.data= datahere
                  }
                 
               }
              //  halaka


                
          }
       






              //  }
              
            }
          })
          .catch(err => {
            console.error(err); 
          })
       })
       .catch(err => {
         console.error(err); 
       })




               
              
   



      },
      
        needtoevaluatelang(aarrayndexofn){
       
          axios.get(`${this.global_hostname}/api/Employee/`,{
          
          headers: {
                'Content-Type': 'application/json',
                 'X-CSRFToken': this.token
          }

         
       })
       .then(res => {
    
         this.data = res.data
          // jordan

          axios.get(`${this.global_hostname}/api/JOBSTATUS/`,{

             headers: {
                   'Content-Type': 'application/json',
                    'X-CSRFToken': this.token
             }
            
          })
          .then(res => {
            console.log(res)
            var JOBSTATUS = res.data
            var temporary_data = []
            for (let index = 0; index < JOBSTATUS.length; index++) {
              const element = JOBSTATUS[index];
             // jordan kapag admin kita lahat pag supervisor filter per assignment or joblevels
               var info = this.data.filter(
                 (elements)=>{
                   return elements.JobStatus.toLowerCase() == element.for_employee_status.toLowerCase()
                 }
               )
                //  hala

             //   this.EVALUATION_PERIOD_PER_MONTH

               console.log('fsdafsdfsf========================')
              console.log(info)
               var obj ={
                 "jobstatus" : element.for_employee_status,
                 "employeeList" : {
                           employee_list_selected: [],
             
                           columns: [
                           
                           {
                           name: 'desc',
                           required: true,
                           label: 'EmpCode',
                           align: 'left',
                           field: row => row.EmpCode,
                           format: val => `${val}`,
                           sortable: true
                         },
                         { name: 'FirstName', align: 'center', label: 'First Name', field: 'FirstName', sortable: true },
                         { name: 'MiddleName', align: 'center', label: 'Middle Name', field: 'MiddleName', sortable: true },
                         { name: 'LastName', label: 'Last Name', field: 'LastName', sortable: true },
                         { name: 'Suffix', label: 'Suffix', field: 'Suffix' },
                         { name: 'NickName', label: 'NickName', field: 'NickName' },
                         { name: 'JobLevel', label: 'Job Level', field: 'JobLevel' },
                         { name: 'JobStatus', label: 'Job Status', field: 'JobStatus' },
                         { name: 'Department', label: 'Department', field: 'Department', sortable: true },
                         { name: 'Designation', label: 'Designation', field: 'Designation', sortable: true },
                         { name: 'ContactNumber', label: 'ContactNumber', field: 'ContactNumber', sortable: true },
                       ],
                       data: info,
                               
                       
                 }
                 
                   
               }
               temporary_data.push(obj)
               
               if(index == JOBSTATUS.length - 1){

                
                 this.EmployeesNeedtoEvaluate = temporary_data
                 this.Employeesinformation = temporary_data
                console.log('check')
                 console.table(temporary_data[aarrayndexofn].employeeList.data)
                 
                 
               this.tab = this.EmployeesNeedtoEvaluate[aarrayndexofn].jobstatus
              
                  var d = new Date()
                  var todaymonth = `${d.getMonth()}${d.getFullYear()}`
                 
                  //compare patiyer
               var getempcode = this.EVALUATION_PERIOD_PER_MONTH.filter(
                 (element)=>{
                      return `${new Date(element.date_created).getMonth()+1}${new Date(element.date_created).getFullYear()}` == todaymonth
                 }
               )
               console.log(getempcode)
               //itoyung sa table
                 var datahere = []
               for (let index = 0; index < temporary_data[aarrayndexofn].employeeList.data.length; index++) {
                 const element2 = temporary_data[aarrayndexofn].employeeList.data[index];
                  var checklength = getempcode.filter(
                    (element)=>{
                      return element.empcode == element2.EmpCode
                    }
                  )
                   
                  if(checklength.length <= 0){
                    
                    // 
                    datahere.push(element2)
                    console.log(datahere)
                  }
                  if(index ==  temporary_data[aarrayndexofn].employeeList.data.length - 1 ){
                    this.EmployeesNeedtoEvaluate[aarrayndexofn].employeeList.data= datahere
                  }
                 
               }
              //  halaka


                
          }
       






              //  }
              
            }
          })
          .catch(err => {
            console.error(err); 
          })
       })
       .catch(err => {
         console.error(err); 
       })




        
        },
        
        EvaluateNa(data){
         
          //   console.log(data[0].FirstName)
          this.employee_list_selected = data
          this.event_evaluate()
          // this.CustomerConcern =
         
          this.displayComplaint(data[0].EmpCode)
          this.displayCommendation(data[0].EmpCode)
          this.globalEMployeeCode = data[0].EmpCode

        },
        filtermoyungcomplaint(){
          
          axios.get(`${this.global_hostname}/api/GET_CustomerConcern/`,{
            
            headers: {
                  'Content-Type': 'application/json',
                   'X-CSRFToken': this.token
            }
           
         })
         .then(res => {
           this.CustomerConcern = res.data

                // hai
                    var data = this.CustomerConcern.filter(
                      (element)=>{
                        return element.ConcernType.toLowerCase().includes('complaint') && element.EmpCode == this.globalEMployeeCode && (new Date(element.date_created).toString().substring(4,7)+new Date(element.date_created).getFullYear()) == this.model_filter_complaint
                      }
                    )
                      // andi
                    var temp = []
                    for (let index = 0; index < data.length; index++) {
                      const element = data[index];
                      var obj ={
                        "id": 22,
                        "ConcernType":element.ConcernType,
                        "ConcernCategory": element.ConcernCategory,
                        "EmpCode": element.EmpCode,
                        "ConcernCategoryIDPlace": element.ConcernCategoryIDPlace,
                        "Name": element.Name,
                        "message" : element.YourConcern,
                        "Topic": element.Topic,
                        "OtherConcern": element.OtherConcern,
                        "date_created": new Date(element.date_created).toString().substring(0,15),
                        "time" : this.formatAMPM(new Date(element.date_created))



                      }
                    
                      
                      
                      temp.push(obj)
                      if(index == data.length - 1){
                        this.data_comlaints = temp
                        
                      }
                      
                    }


                    if(this.model_filter_complaint == 'No Filter'){


                      
                        var data = this.CustomerConcern.filter(
                          (element)=>{
                            return element.ConcernType.toLowerCase().includes('complaint') && element.EmpCode == this.globalEMployeeCode
                          }
                        )
                          // andi
                        var temp = []
                        for (let index = 0; index < data.length; index++) {
                          const element = data[index];
                          var obj ={
                            "id": 22,
                            "ConcernType":element.ConcernType,
                            "ConcernCategory": element.ConcernCategory,
                            "EmpCode": element.EmpCode,
                            "ConcernCategoryIDPlace": element.ConcernCategoryIDPlace,
                            "Name": element.Name,
                            "message" : element.YourConcern,
                            "Topic": element.Topic,
                            "OtherConcern": element.OtherConcern,
                            "date_created": new Date(element.date_created).toString().substring(0,15),
                            "time" : this.formatAMPM(new Date(element.date_created))



                          }
                        
                          
                          
                          temp.push(obj)
                          if(index == data.length - 1){
                            this.data_comlaints = temp
                            
                          }
                          
                        }





                    }

          





         })
         .catch(err => {
           console.error(err); 
         })




        },

        filtermoyungcommendation(){
          
          axios.get(`${this.global_hostname}/api/GET_CustomerConcern/`,{
            
            headers: {
                  'Content-Type': 'application/json',
                   'X-CSRFToken': this.token
            }
           
         })
         .then(res => {
           this.CustomerConcern = res.data

                // hai
                    var data = this.CustomerConcern.filter(
                      (element)=>{
                        return element.ConcernType.toLowerCase().includes('complement') && element.EmpCode == this.globalEMployeeCode && (new Date(element.date_created).toString().substring(4,7)+new Date(element.date_created).getFullYear()) == this.model_filter_commendation
                      }
                    )
                      // andi
                    var temp = []
                    for (let index = 0; index < data.length; index++) {
                      const element = data[index];
                      var obj ={
                        "id": 22,
                        "ConcernType":element.ConcernType,
                        "ConcernCategory": element.ConcernCategory,
                        "EmpCode": element.EmpCode,
                        "ConcernCategoryIDPlace": element.ConcernCategoryIDPlace,
                        "Name": element.Name,
                        "message" : element.YourConcern,
                        "Topic": element.Topic,
                        "OtherConcern": element.OtherConcern,
                        "date_created": new Date(element.date_created).toString().substring(0,15),
                        "time" : this.formatAMPM(new Date(element.date_created))



                      }
                    
                      
                      
                      temp.push(obj)
                      if(index == data.length - 1){
                        this.data_commendation = temp
                        
                      }
                      
                    }


                    if(this.model_filter_commendation == 'No Filter'){


                      
                        var data = this.CustomerConcern.filter(
                          (element)=>{
                            return element.ConcernType.toLowerCase().includes('complement') && element.EmpCode == this.globalEMployeeCode
                          }
                        )
                          // andi
                        var temp = []
                        for (let index = 0; index < data.length; index++) {
                          const element = data[index];
                          var obj ={
                            "id": 22,
                            "ConcernType":element.ConcernType,
                            "ConcernCategory": element.ConcernCategory,
                            "EmpCode": element.EmpCode,
                            "ConcernCategoryIDPlace": element.ConcernCategoryIDPlace,
                            "Name": element.Name,
                            "message" : element.YourConcern,
                            "Topic": element.Topic,
                            "OtherConcern": element.OtherConcern,
                            "date_created": new Date(element.date_created).toString().substring(0,15),
                            "time" : this.formatAMPM(new Date(element.date_created))



                          }
                        
                          
                          
                          temp.push(obj)
                          if(index == data.length - 1){
                            this.data_commendation = temp
                            
                          }
                          
                        }





                    }

          





         })
         .catch(err => {
           console.error(err); 
         })




        },


        displayCommendation(empcode){

axios.get(`${this.global_hostname}/api/GET_CustomerConcern/`,{
  
  headers: {
        'Content-Type': 'application/json',
         'X-CSRFToken': this.token
  }
 
})
.then(res => {
 this.CustomerConcern = res.data

          var data = this.CustomerConcern.filter(
            (element)=>{
              return element.ConcernType.toLowerCase().includes('complement') && element.EmpCode == empcode
            }
          )
            // andi
          var temp = []
          for (let index = 0; index < data.length; index++) {
            const element = data[index];
            var obj ={
              "id": 22,
              "ConcernType":element.ConcernType,
              "ConcernCategory": element.ConcernCategory,
              "EmpCode": element.EmpCode,
              "ConcernCategoryIDPlace": element.ConcernCategoryIDPlace,
              "Name": element.Name,
              "message" : element.YourConcern,
              "Topic": element.Topic,
              "OtherConcern": element.OtherConcern,
              "date_created": new Date(element.date_created).toString().substring(0,15),
              "time" : this.formatAMPM(new Date(element.date_created))



            }
            this.options_filtercustomercommendation.push(new Date(element.date_created).toString().substring(4,7)+new Date(element.date_created).getFullYear())
            
            
            temp.push(obj)
            if(index == data.length - 1){
              this.data_commendation = temp

              this.options_filtercustomercommendation.push('No Filter')
             var a =  [...new Set(this.options_filtercustomercommendation)]
             this.options_filtercustomercommendation =a 
            }
            
          }







})
.catch(err => {
 console.error(err); 
})






},

        displayComplaint(empcode){

          axios.get(`${this.global_hostname}/api/GET_CustomerConcern/`,{
            
            headers: {
                  'Content-Type': 'application/json',
                   'X-CSRFToken': this.token
            }
           
         })
         .then(res => {
           this.CustomerConcern = res.data

                    var data = this.CustomerConcern.filter(
                      (element)=>{
                        return element.ConcernType.toLowerCase().includes('complaint') && element.EmpCode == empcode
                      }
                    )
                      // andi
                    var temp = []
                    for (let index = 0; index < data.length; index++) {
                      const element = data[index];
                      var obj ={
                        "id": 22,
                        "ConcernType":element.ConcernType,
                        "ConcernCategory": element.ConcernCategory,
                        "EmpCode": element.EmpCode,
                        "ConcernCategoryIDPlace": element.ConcernCategoryIDPlace,
                        "Name": element.Name,
                        "message" : element.YourConcern,
                        "Topic": element.Topic,
                        "OtherConcern": element.OtherConcern,
                        "date_created": new Date(element.date_created).toString().substring(0,15),
                        "time" : this.formatAMPM(new Date(element.date_created))



                      }
                      this.options_filtercustomercomplaint.push(new Date(element.date_created).toString().substring(4,7)+new Date(element.date_created).getFullYear())
                      
                      
                      temp.push(obj)
                      if(index == data.length - 1){
                        this.data_comlaints = temp
                        this.options_filtercustomercomplaint.push('No Filter')
                        var a = [...new Set(this.options_filtercustomercomplaint)]
                        this.options_filtercustomercomplaint = a
                      }
                      
                    }

          





         })
         .catch(err => {
           console.error(err); 
         })



          


        },
        formatAMPM(date) {
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var ampm = hours >= 12 ? 'pm' : 'am';
            hours = hours % 12;
            hours = hours ? hours : 12; 
            minutes = minutes < 10 ? '0'+minutes : minutes;
            var strTime = hours + ':' + minutes + ' ' + ampm;
           
            return strTime;
           },
       
        showDispatch(){
          this.modal_dispatch = true
           console.log(this.modal_dispatch )
        },
        filter_dispatch(data){

        //   "filtermonth" : months[new Date(element.date_created).getMonth()],
        // "filteryear" : new Date(element.date_created).getFullYear(), 
          var datefilter = this.model_filterdate.substring(0,3)
          var year=  this.model_filterdate.substring(4,10)
          var filteryear = this.model_filterdate
          var filtermonth= this.modelfiltermonth

        
          // alert(year)
          // alert(`element.date_created.includes(datefilter) && (element.date_created.includes(year) )`)
          if(datefilter.toLowerCase().includes('all')){
            this.DispatchReport_final = this.Dispatch_for_filter
            // hai
            // alert(year)
          }else{
            var a = this.Dispatch_for_filter
            var filtered = a.filter(
              (element)=>{
                return element.filtermonth.includes(filtermonth) && (element.filteryear.includes(filteryear) )
              }
            )
           //hai
          }
          console.log()
          this.DispatchReport_final = filtered

          // hai
        },
      
        timekeeping_method(){
          axios.get(`${this.global_hostname}/api/TIMEKEEPING/`,{
               headers: {
                     'Content-Type': 'application/json',
                      'X-CSRFToken': this.token
               }
              
          })
          .then(res => {
              var data = res.data
              var temp = []
              for (let index = data.length -1 ; index > 0; index--) {
                const element = data[index];

                  var datein = element.DateIn.replace(/-/g,'/')
                  var dateout = element.DateOut.replace(/-/g,'/')
                  var obj = {
                    "id": 1,
                    "EmpCode": element.EmpCode,
                    "Name": element.Name,
                    "DateIn":datein ,
                    "TimeIn": element.TimeIn,
                    "DateOut": dateout,
                    "TimeOut": element.TimeOut,
                    "Department": element.Department,
                    "Position": element.Position
                  }
                  temp.push(obj)
                  if(index == data.length - 1){
                      this.TimeKeeping = temp
                  }
                
              }

          })
          .catch(err => {
            console.error(err); 
          })
        },
        compute(){
          //brylle

          this.showresult_modal = true
          var score = this.evaluation_content
        
          var fordisplay = []
          var result = 0;
          for (let index = 0; index < score.length; index++) {
            const element = score[index];
              var obj =  {
                  'Month' : this.headermonth,
                  'Criteria' : element.criteria,
                  'Score' : element.evaluation_period_scores[0].score,
                  'ScoreFinal' : null
              }
              result  = result  + element.evaluation_period_scores[0].score
              fordisplay.push(obj)

              if(index == score.length -1){
                var res = result 

                    var obj =  {
                      'Month' : this.headermonth,
                      'Criteria' : null,
                      'Score' : null,
                      'ScoreFinal' : res
                  }
                  fordisplay.push(obj)
                  
                  this.FinalScore = fordisplay
                  console.log('final ddss dfdfdf                HIKJscore----------------------------------------------------------')
                  console.log(this.FinalScore)
                 


            
              }

          }


        },
        show_201File(){
          window.open(`${this.global_hostname}/Employee/show_201File/${this.empcode}/`, '_blank');
        },
        selected_type(){
          
          var type = this.filters_offense
          var data = this.global_offense
         
          if(type == 'All'){
            this.global_offense_to_display = data
          }else{

                  var filtered = data.filter(
                  function (element){  
                    return element.Type.toLowerCase() == type.toLowerCase()
                  }
                )

                this.global_offense_to_display = filtered
            
          }
          
          

        },
        //seemore violation
        seemore(array){
      


          this.seemore_modal = true
          this.global_offense = array.final_violation
          this.global_offense_to_display = this.global_offense


        },
        sentohr(id){
          var infoid = id

        var info =   this.EvaluationResult.filter(
          function(el){
              return el.id == infoid

          }
        )
          var payload = {
            
            "id": info[0].id,
            "empcode": info[0].empcode,
            "evaluation_sheet":`${this.global_hostname}/api/POST_EVALUATION_PERIOD/${info[0].evaluation_sheet}/`,
            "employeefullname": info[0].employeefullname,
            "datehired": info[0].datehired,
            "jobstatus": info[0].jobstatus,
            "supervisorrater": info[0].supervisorrater,
            "send": true,
            "designation": info[0].designation,
            "departmentsection": info[0].departmentsection,
            "placeofassignment": info[0].placeofassignment,
            "readyfordeliberation": info[0].readyfordeliberation,
            "delibationisdone": info[0].delibationisdone,
          }

        
          axios.put(`${this.global_hostname}/api/HR_COPY_EVALUATION_RESULT/${infoid}/`,payload,{
           
             headers: {
                   'Content-Type': 'application/json',
                    'X-CSRFToken': this.token
             }
            
          })
          .then(res => {

            this.$q.notify({ //put dollor sign(q)
              message: `Sent Successfully!`,
              timeout: 3000, // in milliseconds; 0 means no timeout
             
              color: 'gray',
              textColor: 'white', // if default 'white' doesn't fit
             icon: 'check', //or  avatar: 'statics/boy-avatar.png',
              
             position: 'top', // 'top', 'left', 'bottom-left' etc.
              
              })
              
              setTimeout(() => {
                this.load = true
              }, 1000);
          
               var data_ =  this.EvaluationResult.filter(
                  function(element){
                      return element.id == infoid
                  }
                )
                data_[0].send = true
                this.EvaluationResult = data_

              setTimeout(() => {
                  this.get_EvaluationResult()
                
              }, 1000);


             
              
          })
          .catch(err => {
            console.error(err); 
          })
        },
        get_EvaluationResult(){

              axios.get(`${this.global_hostname}/api/GET_HR_COPY_EVALUATION_RESULT/`,{
                
                 headers: {
                       'Content-Type': 'application/json',
                        'X-CSRFToken': this.token
                 }
                
              })
              .then(res => {
                  var info = res.data
                 
                
                var a = info.filter(

                      function(element){
                          return element.send == false
                      }
                )

                this.EvaluationResult = a
                var b = info.filter(

                function(element){
                          return element.send == true
                      }
                  )

                  for (let index  = b.length - 1 ; index > 0 ; index--) {
                    const element = b[index];

                    this.EvaluationResult.push(element)
                    
                  }
                  setTimeout(() => {
                    this.load = false
                  }, 2000);

              



              })
              .catch(err => {
                console.error(err); 
              })
        },


        // kharene
        get_list_employee(){
          axios.get(`${this.global_hostname}/api/Employee/`,{
          
             headers: {
                   'Content-Type': 'application/json',
                    'X-CSRFToken': this.token
             }

            
          })
          .then(res => {
       
            this.data = res.data
             // jordan

             axios.get(`${this.global_hostname}/api/JOBSTATUS/`,{

                headers: {
                      'Content-Type': 'application/json',
                       'X-CSRFToken': this.token
                }
               
             })
             .then(res => {
               console.log(res)
               var JOBSTATUS = res.data
               var temporary_data = []
               for (let index = 0; index < JOBSTATUS.length; index++) {
                 const element = JOBSTATUS[index];
                // jordan kapag admin kita lahat pag supervisor filter per assignment or joblevels
                  var info = this.data.filter(
                    (elements)=>{
                      return elements.JobStatus.toLowerCase() == element.for_employee_status.toLowerCase()
                    }
                  )
                  var obj ={
                    "jobstatus" : element.for_employee_status,
                    "employeeList" : {
                              employee_list_selected: [],
                
                              columns: [
                              
                              {
                              name: 'desc',
                              required: true,
                              label: 'EmpCode',
                              align: 'left',
                              field: row => row.EmpCode,
                              format: val => `${val}`,
                              sortable: true
                            },
                            { name: 'FirstName', align: 'center', label: 'First Name', field: 'FirstName', sortable: true },
                            { name: 'MiddleName', align: 'center', label: 'Middle Name', field: 'MiddleName', sortable: true },
                            { name: 'LastName', label: 'Last Name', field: 'LastName', sortable: true },
                            { name: 'Suffix', label: 'Suffix', field: 'Suffix' },
                            { name: 'NickName', label: 'NickName', field: 'NickName' },
                            { name: 'JobLevel', label: 'Job Level', field: 'JobLevel' },
                            { name: 'JobStatus', label: 'Job Status', field: 'JobStatus' },
                            { name: 'Department', label: 'Department', field: 'Department', sortable: true },
                            { name: 'Designation', label: 'Designation', field: 'Designation', sortable: true },
                            { name: 'ContactNumber', label: 'ContactNumber', field: 'ContactNumber', sortable: true },
                          ],
                          data: info,
                                  
                          
                    }
                    
                      
                  }
                  temporary_data.push(obj)
                  console.log('carualsanfdfdf---------')
                  console.log({temporary_data})
                  console.log(temporary_data)
                  if(index == JOBSTATUS.length - 1){
                    this.EmployeesNeedtoEvaluate = temporary_data
                    this.Employeesinformation = temporary_data
                    
                    
                    this.tab = this.EmployeesNeedtoEvaluate[this.globalindex].jobstatus
                  }
                 
               }
             })
             .catch(err => {
               console.error(err); 
             })
          })
          .catch(err => {
            console.error(err); 
          })
        },

        get_minor_or_grave(){
          axios.get(`${this.global_hostname}/api/MINOR_OR_GRAVE/`,{
          
             headers: {
                   'Content-Type': 'application/json',
                    'X-CSRFToken': this.token
             }
            
          })
          .then(res => {
         
           
            this.minororgrave = res.data
          })
          .catch(err => {
            console.error(err); 
          })
        },
          filter_violation(raw_criteria){
          
              var empcode = this.employee_list_selected[0]
              // current
              var data =this.employee_violation_final
          
              
              let minor_orgrave = this.minororgrave

             // ma filter agad kung anong department

            
            var datas = []
            var minor = 0
            var grave = 0
              for (let index = 0; index < this.employee_violation_final.length; index++) {
                const element = this.employee_violation_final[index];
               

                  for (let index2 = 0; index2 < this.violation_criteria_depertment.length; index2++) {
                    const element2 = this.violation_criteria_depertment[index2];
                 
                   
                          if( raw_criteria.toLowerCase().trim() == element2.criteria.toLowerCase() && element.NatureofOffense.toLowerCase() == element2.offense.toLowerCase() && element.EmpCode.toLowerCase() == empcode.EmpCode.toLowerCase()){
                            // 
                              var less_percentage = minor_orgrave.filter(
                                (el)=>{
                                  return el.typeofviolation.toLowerCase() == element.Type.toLowerCase()
                                }
                              )
                            // alert(less_percentage[0].percentage)
                                

                            if(element.Type == 'minor' || element.Type == 'Minor'){
                              minor = minor + 1

                            }
                            if(element.Type == 'grave' || element.Type == 'Grave'){
                              grave = grave + 1
                              //bry
                            }

                                var obj = {
                                  "url": element.url,
                                  "id": element.id,
                                  "EmpCode": element.EmpCode,
                                  "CaseNO": element.CaseNO,
                                  "IncidentDate": element.IncidentDate,
                                  "Type": element.Type,
                                  "NatureofOffense": element.NatureofOffense,
                                  "Decision": element.Decision,
                                  "DateofDecision": element.DateofDecision,
                                  "ReportedBy": element.ReportedBy,
                                  "deduction" : less_percentage[0].percentage,
                                  "minor" : minor,
                                  "grave" : grave,

                                  
                              }
                              datas.push(obj)

                          }
                            

                          
                      if(index == this.employee_violation_final.length - 1 && index2 == this.violation_criteria_depertment.length - 1){
                        var res = [{
                          'minor' : minor,
                          'grave' : grave,
                          'final_violation' : datas,
                        }]
                        
                        
                          return res
                          
                      }
                    
                  }
                     
                

              }
            

               
                

                // for (let index = 0; index < offense.length; index++) {
                //   const element2 = offense[index];
                //     if(nature_of_offense.toLowerCase()){

                //       return element

                //     }
                  
                // }

         
            // "url": "http://127.0.0.1:8000/api/TVR/1/",
            // "id": 1,
            // "EmpCode": "Emp02",
            // "CaseNO": "131312",
            // "IncidentDate": "2019-09-06",
            // "Type": "Minor",
            // "NatureofOffense": "fdsafsd",
            // "Decision": "fasdfds",
            // "DateofDecision": "fasdf",
            // "ReportedBy": "13211"
          
          },
          get_violation(){
            //check yung violations by empcode ; criteria
            axios.get(`${this.global_hostname}/api/TVR/?search=${this.global_empcode}`,{
            headers: {
                                        'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                    }
                
                })
            .then(res => {
              var data =  res.data
        
              this.employee_violation_final = data

            })
            .catch(err => {
              console.error(err); 
            })
            
          },
          get_evaluation_input(percentage,raw_criteria){
            //check muna kung anong month ang nag exist 
            var empcode = this.employee_list_selected[0]
              
            var data =this.employee_violation_final
            
              
              let minor_orgrave = this.minororgrave
              let less = 0

             // ma filter agad kung anong department

            
              for (let index = 0; index < this.employee_violation_final.length; index++) {
                const element = this.employee_violation_final[index];
               

                  for (let index2 = 0; index2 < this.violation_criteria_depertment.length; index2++) {
                    const element2 = this.violation_criteria_depertment[index2];
                  
                    
                          if( raw_criteria.trim().toLowerCase() == element2.criteria.trim().toLowerCase() && element.NatureofOffense.trim().toLowerCase() == element2.offense.trim().toLowerCase() && element.EmpCode.trim().toLowerCase() == empcode.EmpCode.trim().toLowerCase()){
                            // 
                              var less_percentage = minor_orgrave.filter(
                                (el)=>{
                                  return el.typeofviolation.toLowerCase() == element.Type.toLowerCase()
                                }
                              )
                              // add this offens minor or grave/ computtion goes here
                               less =  less + less_percentage[0].percentage
                               
                              

                             

                          }
                            

                          
                      
                    
                  }
                     
                

              }
            





            var evaluation_period = ['First Month','Second Month','Third Month','Fourth Month','Fifth Month','Six Month']
            var month_exist = 'First Month' //lastmonth
            var month_to_evaluate = ''

            var probe = 6
            for (let index = 0; index < evaluation_period.length; index++) {
              const element = evaluation_period[index];
                if(element.trim().toLowerCase() == month_exist.trim().toLowerCase()){

                     if(probe == (index + 1)){
                        // new evaluation period
                        
                        month_to_evaluate = evaluation_period[index+1]
                     }else{
                      month_to_evaluate = evaluation_period[index+1]
                     }
                 
                }
              
            }
            var res_percentage = (100-less) * (percentage/100)
            // var res_percentage = parseFloat(percentage) - parseFloat(less)

         
            var data = [ 
              {
                'header_content' : `${month_to_evaluate}`,
                'score' : res_percentage,
                'remarks' : null,
              }
              

            ]
            this.evaluation_period_header = data
            return data
            // axios.get(`${this.global_hostname}/api/get/GET_EvaluationScore/?search=Emp`)
            //   .then(res => {
            //       var info = res.data
            //       for (let index = 0; index < info.length; index++) {
            //         const element = info[index];
                    

            //       }
            //   })
            //   .catch(err => {
            //     console.error(err); 
            //   })
      },
      //step 2
      display_criteria(){

          
     
          var data = this.evaluation_sheet_criteria
          

         


           for(let index = 0; index < data.length; index++) {
            const element = data[index];

                  var obj = {
                      "url": element.url,
                      "id": element.id,
                      "kind_of_evaluation": element.kind_of_evaluation,
                      "criteria": element.criteria,
                      "description": element.description,
                      "percentage": element.percentage,
                      "date_created": element.date_created,
                      "date_updated": element.date_updated,
                      "evaluation_period_scores" : this.get_evaluation_input(element.percentage,element.criteria),
                      "employee_violation" : this.filter_violation(element.criteria)

                  }
            
            this.evaluation_content.push(obj)
         
             if(index == data.length - 1 ){
          

             }
          }

         
          // for Display
          // for(let index = 0; index < data.length; index++) {
          //   const element = data[index];

          //         var obj = {
          //             "url": element.url,
          //             "id": element.id,
          //             "kind_of_evaluation": element.kind_of_evaluation,
          //             "criteria": element.criteria,
          //             "description": element.description,
          //             "percentage": element.percentage,
          //             "date_created": element.date_created,
          //             "date_updated": element.date_updated,
          //             "evaluation_period_scores" : [
          //                     {
          //                       "url": "http://127.0.0.1:8000/api/get/GET_EvaluationScore/1/",
          //                       "id": 1,
          //                       "kind_of_evaluation": "Operation",
          //                       "criteria": "Efficiency",
          //                       "description": "dafdsfsd",
          //                       "percentage": 30,
          //                       "employee": "Emp02",
          //                       "score": 20.0,
          //                       "monthname": "First Month",
          //                       "identifier": "asdf",
          //                       "date_created": "2019-09-07T01:45:27.481637Z",
          //                       "date_updated": "2019-09-07T02:39:03.805469Z"
          //                   },
          //                   {
          //                     "url": "http://127.0.0.1:8000/api/get/GET_EvaluationScore/1/",
          //                     "id": 1,
          //                     "kind_of_evaluation": "Operation",
          //                     "criteria": "Efficiency",
          //                     "description": "dafdsfsd",
          //                     "percentage": 30,
          //                     "employee": "Emp02",
          //                     "score": 25.0,
          //                     "monthname": "First Month",
          //                     "identifier": "asdf",
          //                     "date_created": "2019-09-07T01:45:27.481637Z",
          //                     "date_updated": "2019-09-07T02:39:03.805469Z"
          //                 },
          //             ]

          //         }

          //   this.evaluation_content.push(obj)
          //    console.log(obj)
          // }

            
        
      
      },
      // step 2
      get_evaluation_criteria_content(){
        // http://127.0.0.1:8000/api/get/Get_Evaluation_Sheet_Criteria/?search=operation


        var jobstatus = this.employee_list_selected[0].JobStatus
        var department = this.employee_list_selected[0].Department
     
        
        var kind = this.who_used.filter(
          
          function(el) {
            return el.department.trim().toLowerCase() == department.trim().toLowerCase()
          }
        
        )
          //kind of evaluation sheet
        var kind = kind[0].kind_of_evaluation.trim().toLowerCase()
      
         
        
         
  

        axios.get(`${this.global_hostname}/api/get/Get_EvaluationSheet_Criteria/?search=${kind}`,{
          
           headers: {
                 'Content-Type': 'application/json',
                  'X-CSRFToken': this.token
           }
          
        })
        .then(res => {
     
          this.evaluation_sheet_criteria= res.data

          //combine content & header
          this.display_criteria()
          
        })
        .catch(err => {
          console.error(err); 
        })
      },
        remove_assist() {
               

        },
        getdis(empcode){
          // carulasan
        
var data = this.DispatchReport
var ecode = empcode
      var info = data.filter(
        (element)=>{
            return element.EmpCode == ecode
        }
      )
// hai
var temp = []
var years = []
var month = []
var months = ["January", "February", "March", "April", "May", "June", "July",
         "August", "September", "October", "November", "December"];



for (let index = 0; index < info.length; index++) {
  const element = info[index];
  // hai
  years.push(new Date(element.date_created).getFullYear())
  month.push(months[new Date(element.date_created).getMonth()])

      var obj = {
        "url": element.url,
        "id": element.id,
        "EmpCode": element.EmpCode,
        "FullName": element.FullName,
        "EmpPosition": element.EmpPosition,
        "Location": element.Location,
        "Active": element.Active,
        "DepartureTime": element.DepartureTime,
        "ArrivalTime": element.ArrivalTime,
        "KMRun": element.KMRun,
        "Busno": element.Busno,
        "Route": element.Route,
        "date_created": new Date(element.date_created).toString().substring(0,16),
        "date_updated": element.date_updated,
        "filtermonth" : months[new Date(element.date_created).getMonth()],
        "filteryear" : new Date(element.date_created).getFullYear(), 
      }
      temp.push(obj)
      if(index == info.length - 1 ){
        this.DispatchReport_final = temp
        this.Dispatch_for_filter = temp
        this.optionyear = [...new Set(years)]
        this.optionmonth = [...new Set(month)]//
      }
  
}


// hai
        },
        // step 1

        getAttendance(empcode){


          if(this.displaydesignation.toLowerCase().includes('driver') || this.displaydesignation.toLowerCase().includes('conductor')){
     
  // date_created
  // Attendanceoptions

                var dispatchdata = this.Dispatch
                console.log(this.Dispatch)

          console.log('gfsfdgfg999999999999999999999999999999999999999999999999999999999999999999999999999999999')
            //     console.log(attendance)

                var emp = this.global_empcode
                var busdriverdispatch = dispatchdata.filter(
             
                 function(element){
                       return element.EmpCode == emp
                   }
                 )
                 console.log('filteres dispacth')

                 console.log(busdriverdispatch)
                   var temp_dates = []
                  for (let index = 0; index < busdriverdispatch.length; index++) {
                         const element = busdriverdispatch[index];
                         var a = new Date(element.date_created)
                         
                      
                         var date = a.getFullYear()+'/'+(a.getMonth()+1)+'/'+a.getDate()
                          temp_dates.push(date)
                          if(index == busdriverdispatch.length - 1){
                          this.Attendanceoptions = temp_dates
                        
                          // this.attendance = this.options[empattendance.length-1]
                          // console.log('555555555555%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%55555555555555555555555')
                          // console.log(this.options)



                  }

              
            }


             }else{

              var emp = this.empcode
                axios.get(`${this.global_hostname}/api/TIMEKEEPING/`,{

                   headers: {
                         'Content-Type': 'application/json',
                          'X-CSRFToken': this.token
                   }
                  
                })
                .then(res => {
                    var timekeeping  = res.data
                       var empattendance = timekeeping.filter(
             
                          function(element){
                            return element.EmpCode == emp
                          }
                      )
                      var temp_dates = []

                  for (let index = 0; index < empattendance.length; index++) {
                         const element = empattendance[index];
                         var a = new Date(element.DateIn)
                         
                    
                         var date = a.getFullYear()+'/'+(a.getMonth()+1)+'/'+a.getDate()
                          temp_dates.push(date)
                          if(index == empattendance.length - 1){
                          this.Attendanceoptions = temp_dates
                        
                          // this.attendance = this.options[empattendance.length-1]
                          // console.log('555555555555%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%55555555555555555555555')
                          // console.log(this.options)



                  }
                }

                })
                .catch(err => {
                  console.error(err); 
                })
              // dito
            //        var attendance = this.TimeKeeping
            // var emp =     this.global_empcode
            // var empattendance = attendance.filter(
             
            //   function(element){
            //     return element.EmpCode == emp
            //   }
            // )
            //   var temp_dates = []
            // for (let index = 0; index < empattendance.length; index++) {
            //   const element = empattendance[index];
            //   temp_dates.push(element.DateOut)
            //         if(index ==empattendance.length - 1){
            //             this.options = temp_dates
            //             this.attendance = this.options[empattendance.length-1]
            //           console.log('555555555555%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%55555555555555555555555')
            //             console.log(this.options)
            //         }

              
            // }
            



             }

             

        },
        event_evaluate(){

          //brylle
          this.empcode = this.employee_list_selected[0].EmpCode
          this.global_empcode =  this.employee_list_selected[0].EmpCode
          this.displayjobstatus = this.employee_list_selected[0].JobStatus

          this.displayfirstname = this.employee_list_selected[0].FirstName
          this.displaylastname = this.employee_list_selected[0].LastName
          this.displaymiddldname = this.employee_list_selected[0].MiddleName
          this.displaydatehired = new Date(this.employee_list_selected[0].datehired).toString().substring(0,15)
          this.displaydesignation = this.employee_list_selected[0].Designation
          this.displaydepartmentsection = this.employee_list_selected[0].Department
          this.displayplaceofassignment = this.employee_list_selected[0].PlaceOfAssignment
this.getdis(this.empcode)
this.getAttendance(this.empcode,this.displaydesignation)
        

          
          var a = this.displaydesignation
          var b = this.displaydepartmentsection
          this.GETJobDescription(a,this.employee_list_selected[0].Department)
          console.log(a)
          console.log(b)
          // this.GETJobDescription(this.displaydesignation,this.displaydepartmentsection)
         
       
            this.dialog_evaluate = true
            this.evaluation_content = []
            
            this.get_evaluation_criteria_content()
           
            this.getevaluationperiod(this.employee_list_selected[0].JobStatus,this.displaydepartmentsection);
          // brylle
             this.GET_PREVIOS_MONTH()
             this.whatmonth()
      

     
            this.FORNOTIFICATION()
            
            
          
           
          },
          GETJobDescription(jobtitle,depar){
            var job = jobtitle
            var dep = depar
      
            axios.get(`${this.global_hostname}/api/GET_JobDescription/`,{
          
               headers: {
                     'Content-Type': 'application/json',
                      'X-CSRFToken': this.token
               }
              
            })
            .then(res => {
              
              //=current
              var data = res.data
              
              var info = data.filter(
                (element)=>{
                  return element.JobTitle.toLowerCase().trim().includes(job.toLowerCase().trim())  && element.Department.toLowerCase().trim().includes(dep.toLowerCase().trim())
                }
              )
              
              this.editor = info[0].Content
              this.modelTitle = info[0].JobTitle
              this.modelDepartment = info[0].Department,
              this.modelJobTitle = info[0].JobTitle,
              this.modelReportsTo = info[0].ReportsTo,
              this.modelSection = info[0].Section
              
              

            })
            .catch(err => {
              console.error(err); 
            })
             
          },
          score(this_score,criteria,month,percentage){
            // alert(id + month)
             this.score_dialog = true;
          
            
            this.cr = criteria
            this.mo = month
            this.e_firstmonth = this_score
            this.max = percentage
            this.criteria_to_evaluate = criteria 
            this.percentage_to_evaluate = percentage
            
            
          },
          move(){
            var a =  this.e_firstmonth
              var evaluation_period_number = 0;
            

           for (let index = 0; index < this.evaluation_content.length; index++) {
             const element = this.evaluation_content[index];

             

             if(element.criteria == this.cr){

              element.evaluation_period_scores.forEach(element => {
                  element.score = a
                  
              });
              
              
             
           }
          }

          },

          // getwhichjobstatususedthisevaluationform(){
          //   axios.get(`${this.global_hostname}/api/GET_EVALUATION_SHEET_USED_BY_JOBSTATUS/`,{
            
          //      headers: {
          //            'Content-Type': 'application/json',
          //             'X-CSRFToken': this.token
          //      }
              
          //   })
          //   .then(res => {
          //       this.who_used = res.data
              
          //   })
          //   .catch(err => {
          //     console.error(err); 
          //   })
          // }, version 2
          getwhichjobstatususedthisevaluationform(){
            axios.get(`${this.global_hostname}/api/GET_DEPARTMENT_USE_THE_EVALUATION_SHEET/`,{
            
               headers: {
                     'Content-Type': 'application/json',
                      'X-CSRFToken': this.token
               }
              
            })
            .then(res => {
                this.who_used = res.data
              
            })
            .catch(err => {
              console.error(err); 
            })
          },

          //09212019
          getevaluationperiod(jobstatus,department){
            
            axios.get(`${this.global_hostname}/api/JOBSTATUS/?search=${jobstatus}`,{
            
               headers: {
                     'Content-Type': 'application/json',
                      'X-CSRFToken': this.token
               }
              
            })
            .then(res => {
                  var data  =res.data
                  console.log(data)
                  this.lengthofevaluationperiod = data[0].month_period
                  //ayyyy
                  // alert(this.lengthofevaluationperiod)


            })
            .catch(err => {
              console.error(err); 
            })
          },
          inserttocriteria(id_month){
            var empcode_global = this.global_empcode

       
                 
                          
                           
                              for (let index = 0; index < this.evaluation_content.length; index++) {
                                const element = this.evaluation_content[index];
                                // alert()

                                   var obj = {
                                    "empcode": this.global_empcode,
                                    "evaluation_period_per_month": `${this.global_hostname}/api/POST_PER_MONTH/${id_month}/`,
                                    "criteria": element.criteria,
                                    "score": element.evaluation_period_scores[0].score,
                                    "remarks": element.evaluation_period_scores[0].remarks,
                                    "evaluator": '{{ user }}'
                                    //current


                                   }
                                 
                                   axios.post(`${this.global_hostname}/api/POST_PER_CRITERIA/`,obj,{
                                      headers: {
                                            'Content-Type': 'application/json',
                                             'X-CSRFToken': this.token
                                      }
                                     
                                   })
                                   .then(res => {
                                   
                                        if(index == this.evaluation_content.length -1 ){
                                        

                                             

                                            this.get_violation()
           this.get_list_employee()
          this.getwhichjobstatususedthisevaluationform()
          this.get_minor_or_grave()

          //evaluationperiod http://127.0.0.1:8000/api/POST_EVALUATION_PERIOD/
        this.get_evaluation_period()
      //   // permonth http://127.0.0.1:8000/api/POST_PER_MONTH/
      //   this.get_evaluation_period_per_month()
      // // permonth http://127.0.0.1:8000/api/POST_PER_MONTH/
      //   this.get_evaluation_period_per_criteria()
                                            
                                         //kh   

                                            this.whatmonth()

                                              setTimeout(() => {
                                                  this.compute()
                                                this.FORNOTIFICATION()

                                                this.$q.loading.hide()
                                                  this.success = true
                                                 
                                                    setTimeout(()=>{
                                                        this.success = false
                                                    },5000)
                                                  
                                              }, 1000);

                                            this.dialog_evaluate = false
                                           
                                          
                                        }
                                   })
                                   .catch(err => {
                                     console.error(err); 
                                   })
                                
                              }


          },

          FORNOTIFICATION(){
           
              axios.get(`${this.global_hostname}/api/POST_EVALUATION_PERIOD/`,{
                
                 headers: {
                       'Content-Type': 'application/json',
                        'X-CSRFToken': this.token
                 }
                
              })
              .then(res => {
               
                      var data  = res.data
                      var empcode_global = this.global_empcode 
                     
                     var period_filter=data.filter(
                        function(el){
                            return el.empcode == empcode_global

                      })
                   
                      var employee_evaluation_period = period_filter


                       
                          var array_periods = []
                          for (let index = 0; index < employee_evaluation_period.length; index++) {
                                  const element = employee_evaluation_period[index];
                               
                                  array_periods.push(element.evaluation_period)
                                  if(index == employee_evaluation_period.length - 1){
                                    var max_value = Math.max(...array_periods)
                                      var filtered_evaluation_period = employee_evaluation_period.filter(
                                        function (element){
                                          return element.evaluation_period == max_value
                                        }
                                      )

                                         
                                      var info_month =  this.EVALUATION_PERIOD_PER_MONTH.filter(
                                        function(el){
                                        return el.evaluation_period == filtered_evaluation_period[0].id

                                        }
                                      )
                                  //month nag mactch na
                                  
                                // alert(filtered_evaluation_period[0].id)
                             

                                        if(info_month.length == filtered_evaluation_period[0].length_period){
                                            //insert new evaluatio period

                                            //ayay
                                          
                                                                    // console.log('>>>> OK')
                                                                        this.sendtohr()
                                                           
                                                                                                       
                                            
                                        }
                                  }
                          }
                      //gabi

              })
              .catch(err => {
                console.error(err); 
              })


          },

          sendtohr(){ 
            var payload = {

              "empcode": this.global_empcode,  
        "evaluation_sheet": `${this.global_hostname}/api/POST_EVALUATION_PERIOD/${parseInt(this.id_period)}/`,
        "employeefullname": `${this.displayfirstname} ${this.displaymiddldname} ${ this.displaylastname }`,
        "datehired": `${ this.displaydatehired }`,
        "jobstatus": `${this.displayjobstatus}`,
        "supervisorrater":  '{{ user }}',
        "designation":  `${this.displaydesignation}`,
        "departmentsection":`${ this.displaydepartmentsection }`,
        "placeofassignment": `${this.displayplaceofassignment}`,

        
                

            }


            
            
         
         // displayjobstatus : 'probatioanary',  

          

            axios.post(`${this.global_hostname}/api/HR_COPY_EVALUATION_RESULT/`,payload,{
              
               headers: {
                     'Content-Type': 'application/json',
                      'X-CSRFToken': this.token
               }
              
            })
            .then(res => {
             
           
              // ayay
              
              this.$q.dialog({
                title: 'The Evaluation Period Is Finish',
                message: 'Choose your options',
                options: {
                  type: 'radio',
                  model: 'opt1',
                  // inline: true
                  items: [
                    { label: 'Save and Send to Hr Department', value: 'send', color: 'secondary' },
                    { label: 'Save Only', value: 'no' },
                  
                  ]
                },
                cancel: true,
                persistent: true
              }).onOk(data => {
                
                
                if(data == 'send'){
                  this.sentohr(res.data.id)  
                }
                if(data == 'no'){

                  this.$q.notify({ //put dollor sign(q)
                    message: `Successfully Saved!`,
                    timeout: 3000, // in milliseconds; 0 means no timeout
                   
                    color: 'gray',
                    textColor: 'white', // if default 'white' doesn't fit
                   icon: 'check', //or  avatar: 'statics/boy-avatar.png',
                  
                   position: 'top', // 'top', 'left', 'bottom-left' etc.
                    
                    })
                  
                  this.get_EvaluationResult()
                  
                }

              }).onCancel(() => {
                
              }).onDismiss(() => {
                // console.log('I am triggered on both OK and Cancel')
              })



            

            })
            .catch(err => {
              console.error(err); 
            })
          },

          SAVE_EVALUATION(){

            if(this.remarks == ''){
              alert('Please Enter Remarks!')

              return;
            }

            this.$q.loading.show({
        message: 'Please wait!<br/><span class="text-white">Saving data.....</span>'
      })


      this.fornotification_month = this.headermonth

            var period = this.EVALUATION_PERIOD_OF_EMPLOYEE
           var permonth = this.EVALUATION_PERIOD_PER_MONTH 
          var criteria =  this.EVALUATION_PERIOD_PER_CRITERIA 
         
     
            var empcode_global = this.global_empcode
          var period_filter = period.filter(
            function(info){
                return info.empcode == empcode_global
            }
          )
            if(period_filter.length == 0){

                //first time create period
                var obj = {
                    "empcode": empcode_global,
                    "employeefullname": `${ this.displayfirstname } ${ this.displaymiddldname } ${ this.displaylastname }`,
                    "datehired": `2019-09-02`,//this.displaydatehired
                    "designation": `${ this.displaydesignation }`,
                    "departmentsection": `${ this.displaydepartmentsection }`,
                    "placeofassignment": `${this.displayplaceofassignment}`,
                    "supervisorrater": `{{ user }}`,
                    "evaluation_period": 1,
                    "length_period": parseInt(this.lengthofevaluationperiod),
                }
                
                this.global_fullname = `${ this.displayfirstname } ${ this.displaymiddldname } ${ this.displaylastname }`
  
                //PERIOD
                axios.post(`${this.global_hostname}/api/POST_EVALUATION_PERIOD/`,obj,{
                
                   headers: {
                         'Content-Type': 'application/json',
                          'X-CSRFToken': this.token
                   }
                  
                })
                .then(res => {
                   this.id_period  = res.data.id
               
                        var objmonth = {
                          "empcode": empcode_global,
                          "evaluation_period": `${this.global_hostname}/api/POST_EVALUATION_PERIOD/${this.id_period}/`,
                          "month_name": "First Month",
                          "remarks" : this.remarks
                        }
                        //9272019

                        //MONTHS
                        axios.post(`${this.global_hostname}/api/POST_PER_MONTH/`,objmonth,{
                             
                              headers: {
                                    'Content-Type': 'application/json',
                                      'X-CSRFToken': this.token
                              }
                        
                        })
                        .then(res_month => {
                          
                   
                          var id_month= res_month.data.id
                          console.log(res_month.data)

                          this.inserttocriteria(id_month)
                        


                        })
                        .catch(err_month => {
                          console.error(err_month); 
                        })


                })
                .catch(err => {
                  console.error(err); 
                })

            }
            if(period_filter.length > 0){

              var employee_evaluation_period = period_filter
              
              var array_periods = []
              for (let index = 0; index < employee_evaluation_period.length; index++) {
                      const element = employee_evaluation_period[index];
                 
                      array_periods.push(element.evaluation_period)
                      if(index == employee_evaluation_period.length - 1){
                        var max_value = Math.max(...array_periods)
                          var filtered_evaluation_period = employee_evaluation_period.filter(
                            function (element){
                              return element.evaluation_period == max_value
                            }
                          )

                       
                              
                          var info_month =  this.EVALUATION_PERIOD_PER_MONTH.filter(
                            function(el){
                            return el.evaluation_period == filtered_evaluation_period[0].id

                            }
                          )
                      //month nag mactch na
                      
                   


                            if(info_month.length == filtered_evaluation_period[0].length_period){
                                //insert new evaluatio period
                                
                                  

                                                    //first time create period
                                    var obj = {
                                        "empcode": empcode_global,
                                        "employeefullname": `${ this.displayfirstname } ${ this.displaymiddldname } ${ this.displaylastname }`,
                                        "datehired": `2019-09-02`,//this.displaydatehired
                                        "designation": `${ this.displaydesignation }`,
                                        "departmentsection": `${ this.displaydepartmentsection }`,
                                        "placeofassignment": `${this.displayplaceofassignment}`,
                                        "supervisorrater": `{{ user }}`,
                                        "evaluation_period": parseInt(filtered_evaluation_period[0].evaluation_period) + 1,
                                        "length_period": parseInt(this.lengthofevaluationperiod),
                                    }
                                
                                    //PERIOD
                                    axios.post(`${this.global_hostname}/api/POST_EVALUATION_PERIOD/`,obj,{
                                    
                                      headers: {
                                            'Content-Type': 'application/json',
                                              'X-CSRFToken': this.token
                                      }
                                      
                                    })
                                    .then(res => {
                                      this.id_period  = res.data.id
                                     
                                            var eval_month = "First Month"
                                            var objmonth = {
                                              "empcode": empcode_global,
                                              "evaluation_period": `${this.global_hostname}/api/POST_EVALUATION_PERIOD/${this.id_period}/`,
                                              "month_name":eval_month ,
                                              "remarks" : this.remarks
                                            }
                                            //9272019
                                            
                                            this.global_month = eval_month


                                            //MONTHS
                                            axios.post(`${this.global_hostname}/api/POST_PER_MONTH/`,objmonth,{
                                                
                                                  headers: {
                                                        'Content-Type': 'application/json',
                                                          'X-CSRFToken': this.token
                                                  }
                                            
                                            })
                                            .then(res_month => {
                                              
                                           
                                              var id_month= res_month.data.id
                                       

                                              this.inserttocriteria(id_month)
                                            


                                            })
                                            .catch(err_month => {
                                              console.error(err_month); 
                                            })


                                    })
                                    .catch(err => {
                                      console.error(err); 
                                    })





                            }else{

                              // checking the existing month
                              var month_now = ''
                              var evaluation_period_month_name = ['First Month','Second Month','Third Month','Fourth Month','Fifth Month','Six Month']
                                var counter = 0
                                  for (let index = 0; index < info_month.length; index++) {
                                    const element = info_month[index];

                                            for (let index2 = 0; index2 < evaluation_period_month_name.length; index2++) {
                                              const element2 = evaluation_period_month_name[index2];
                                                if(element.month_name == evaluation_period_month_name[index2]){
                                                        // alert(element.month_name  + ' at index ' + index2 )

                                                       
                                                    
                                                          counter = counter + 1
                                                     


                                                  }

                                                 
                                                

                                              
                                            }
                                  
                                    
                                
                                  }

                                  month_now = evaluation_period_month_name[counter];
                                this.global_month = month_now



                                              
                                      //save months
                                                                                                var idperiod = filtered_evaluation_period[0].id  
                                                                                                this.id_period = idperiod
                                                                                                
                                                                                                var objmonth = {
                                                                                                  "empcode": empcode_global,
                                                                                                  "evaluation_period": `${this.global_hostname}/api/POST_EVALUATION_PERIOD/${idperiod}/`,
                                                                                                  "month_name":month_now ,
                                                                                                  "remarks" : this.remarks
                                                                                                }
                                                                                                //9272019
                                                                                             
                                                                                                //MONTHS
                                                                                                axios.post(`${this.global_hostname}/api/POST_PER_MONTH/`,objmonth,{
                                                                                                    
                                                                                                      headers: {
                                                                                                            'Content-Type': 'application/json',
                                                                                                              'X-CSRFToken': this.token
                                                                                                      }
                                                                                                
                                                                                                })
                                                                                                .then(res_month => {
                                                                                                  
                                                                                               
                                                                                                  var id_month= res_month.data.id
                                                                                                
                            
                                                                                                  this.inserttocriteria(id_month)
                                                                                                
                            
                            
                                                                                                })
                                                                                                .catch(err_month => {
                                                                                                  console.error(err_month); 
                                                                                                })

                            
                            }

                }
                
              }
             
              
                
            }
          

        // //09212019
        //   EVALUATION_PERIOD_OF_EMPLOYEE  : [],
        //   EVALUATION_PERIOD_PER_MONTH : [],
        //   EVALUATION_PERIOD_PER_CRITERIA : [],
        //   displayfirstname : 'fir',
        //   displaylastname : 'jj',
        //   displaymiddldname : 'fdfd',
        //   displaydatehired : '09/12/45',
        //   displaydesignation : 'drvier',
        //   displaydepartmentsection : 'Operation' ,   
        //   displayplaceofassignment : 'cubao', displayjobstatus
        


          },


          //kh
          //evaluationperiod http://127.0.0.1:8000/api/POST_EVALUATION_PERIOD/
        get_evaluation_period(){
            axios.get(`${this.global_hostname}/api/POST_EVALUATION_PERIOD/`,{
          
             headers: {
                   'Content-Type': 'application/json',
                    'X-CSRFToken': this.token
             }
            
            })
            .then(res => {
           
              this.EVALUATION_PERIOD_OF_EMPLOYEE =res.data
                this.get_evaluation_period_per_month()
                
              
            })
            .catch(err => {
              console.error(err); 
            })
        },
        // permonth http://127.0.0.1:8000/api/POST_PER_MONTH/
        get_evaluation_period_per_month(){

          axios.get(`${this.global_hostname}/api/GET_PER_MONTH/`,{
          
             headers: {
                   'Content-Type': 'application/json',
                    'X-CSRFToken': this.token
             }
            
          })
          .then(res => {
          
            this.EVALUATION_PERIOD_PER_MONTH = res.data
            this.get_evaluation_period_per_criteria()
              
              
            
          })
          .catch(err => {
            console.error(err); 
          })
            

        },
      // percriteria http://127.0.0.1:8000/api/POST_PER_MONTH/
        get_evaluation_period_per_criteria(){
            axios.get(`${this.global_hostname}/api/POST_PER_CRITERIA/`,{
            
               headers: {
                     'Content-Type': 'application/json',
                      'X-CSRFToken': this.token
               }
              
            })
            .then(res => {
              
                this.EVALUATION_PERIOD_PER_CRITERIA = res.data
            
                this.whatmonth()
               this.GET_PREVIOS_MONTH()

                
            })
            .catch(err => {
              console.error(err); 
            })

        },
        GET_PREVIOS_MONTH(){
        // alert(this.empcode)
            //khar
var empcode = this.empcode

          var   period = this.EVALUATION_PERIOD_OF_EMPLOYEE
          var filter_evaluationperiod  = period.filter(
            function(element){
              return element.empcode == empcode
            }

          )
          console.log('empcode')
          console.log(period)
          // console.log(filter_evaluationperiod)
       
            var array = []
          for (let index = 0; index < filter_evaluationperiod.length; index++) {
            const element = filter_evaluationperiod[index];
            array.push(element.evaluation_period)
            
          }
          console.log(array)

           var max_period = Math.max(parseInt(array))
            console.log(max_period)

           var ID_EVALUATION_PERIOD = period.filter(
             function(element){
                return parseInt(element.evaluation_period) == parseInt(max_period)
             }
           )
           //id

           var id = ID_EVALUATION_PERIOD[0].id 
          //  console.log(ID_EVALUATION_PERIOD)
           var permonth = this.EVALUATION_PERIOD_PER_MONTH 

             var filtered_months = permonth.filter(
               function(element){
                return element.evaluation_period == id
               }
             )

             console.log(filtered_months)
             var evaluation_period_month_name = ['First Month','Second Month','Third Month','Fourth Month','Fifth Month','Six Month']
               var month = ''
              var index_ko = 0
              var MonthContainer  = []
             for (let index = 0; index < filtered_months.length; index++) {

               const element = filtered_months[index];


               for (let index2 = 0; index2 < evaluation_period_month_name.length; index2++) {
                 const element2 = evaluation_period_month_name[index2];
                 if(element.month_name == element2){
                    index_ko = index2
                    
                 }else{
                  // alert(element2)
                 }

                    if(index2 == evaluation_period_month_name.length - 1){
                    

                     var  natitira =  evaluation_period_month_name.splice(index_ko,1)

                      
                        console.log(natitira)
                        console.log(evaluation_period_month_name)
                        MonthContainer = evaluation_period_month_name
                          this.headermonth = MonthContainer[0]
                         
                        
 
                    }
                 
               }

               
             }

               
           
          var criteria =  this.EVALUATION_PERIOD_PER_CRITERIA 


        },

        whatmonth(){
           
            
            
            
               var period = this.EVALUATION_PERIOD_OF_EMPLOYEE
           var permonth = this.EVALUATION_PERIOD_PER_MONTH 
          var criteria =  this.EVALUATION_PERIOD_PER_CRITERIA 
         
        
            var empcode_global = this.global_empcode
          var period_filter = period.filter(
            function(info){
                return info.empcode == empcode_global
            }
          )
       
            if(period_filter.length == 0){

               var evaluation_period_month_name = ['First Month','Second Month','Third Month','Fourth Month','Fifth Month','Six Month']
               this.headermonth = evaluation_period_month_name[0];
            

            }
            if(period_filter.length > 0){

              var employee_evaluation_period = period_filter
            
              var array_periods = []
              for (let index = 0; index < employee_evaluation_period.length; index++) {
                      const element = employee_evaluation_period[index];
                     //GET ,
                      array_periods.push(element.evaluation_period)
                      if(index == employee_evaluation_period.length - 1){
                        var max_value = Math.max(...array_periods)
                          var filtered_evaluation_period = employee_evaluation_period.filter(
                            function (element){
                              return element.evaluation_period == max_value
                            }
                          )

                       
                              
                          var info_month =  this.EVALUATION_PERIOD_PER_MONTH.filter(
                            function(el){
                            return el.evaluation_period == filtered_evaluation_period[0].id

                            }
                          )
                          console.log(info_month)
                      //month nag mactch na
                      
                    // alert(filtered_evaluation_period[0].id)
                   

                            if(info_month.length == filtered_evaluation_period[0].length_period){
                                //insert new evaluatio period
                                
                                  

                                  
                                this.headermonth = 'First Month'
                                // nov2



                            }else{

                              // checking the existing month
                              var month_now = ''
                              var evaluation_period_month_name = ['First Month','Second Month','Third Month','Fourth Month','Fifth Month','Six Month']
                               
                              var counter = 0
                                  for (let index = 0; index < info_month.length; index++) {
                                    const element = info_month[index];

                                            for (let index2 = 0; index2 < evaluation_period_month_name.length; index2++) {
                                              const element2 = evaluation_period_month_name[index2];
                                                if(element.month_name == evaluation_period_month_name[index2]){
                                                        // alert(element.month_name  + ' at index ' + index2 )

                                                       
                                                          counter = counter + 1
                                                     


                                                  }

                                                 
                                                

                                              
                                            }
                                  
                                    
                                
                                  }

                                  this.headermonth = evaluation_period_month_name[counter];



                                              
                                      //save months
                                                                                                var idperiod = filtered_evaluation_period[0].id  
                                                                                                this.id_period = idperiod
                                                                                                
                                                                                                
                                                                                        
                            }

                }
                
              }
                
            }
             
                
        },
        get_GeneralViolation(){
          axios.get(`${this.global_hostname}/api/GET_Violation_Per_Department_Per_Criteria/`,{
           
             headers: {
                   'Content-Type': 'application/json',
                    'X-CSRFToken': this.token
             }
            
          })
          .then(res => {
            
            this.violation_criteria_depertment = res.data


          })
          .catch(err => {
            console.error(err); 
          })

        },
        // eventkharene
        GETMONTHEVALATIONSHEET(){
          axios.get(`${this.global_hostname}/api/GET_PER_MONTH/`,{
             headers: {
                   'Content-Type': 'application/json',
                    'X-CSRFToken': this.token
             }
            
          })
          .then(res => {

                this.TODAYEVAUATIONPERMONTH = res.data
          })
          .catch(err => {
            console.error(err); 
          })
        },
        dispatchSystem(){


          axios.get(`${this.global_hostname}/api/DISPATCH/`,{
           
           headers: {
                 'Content-Type': 'application/json',
                  'X-CSRFToken': this.token
           }
          
        })
        .then(res => {
          
          this.Dispatch = res.data
          console.log('dispatch -------------------------- ======================---------')
          console.log(this.Dispatch)

          this.DispatchReport = res.data
          //hai

        })
        .catch(err => {
          console.error(err); 
        })



        },
        getConcernTable(){
          axios.get(`${this.global_hostname}/api/GET_CustomerConcern/`,{
            
             headers: {
                   'Content-Type': 'application/json',
                    'X-CSRFToken': this.token
             }
            
          })
          .then(res => {
            this.CustomerConcern = res.data
          })
          .catch(err => {
            console.error(err); 
          })
        },

        



    },
  
    mounted () {



      var hostname = window.location.hostname;
      var port = window.location.port
        if(port != ''){

            hostname = hostname+':8000'
        }
        else{
            hostname = hostname
        }

        this.global_hostname = `${window.location.protocol}//${hostname}`;
        
          var csrftoken = Cookies.get('csrftoken');
          
     

         
           this.token = csrftoken
        this.getConcernTable()
           this.get_violation()
           this.get_list_employee()
          this.getwhichjobstatususedthisevaluationform()
          this.get_minor_or_grave()
          //evaluationperiod http://127.0.0.1:8000/api/POST_EVALUATION_PERIOD/
        this.get_evaluation_period()
        // permonth http://127.0.0.1:8000/api/POST_PER_MONTH/
      //   this.get_evaluation_period_per_month()
      // // permonth http://127.0.0.1:8000/api/POST_PER_MONTH/
      //   this.get_evaluation_period_per_criteria()

        this.get_GeneralViolation()
        this.get_EvaluationResult()

        this.GETMONTHEVALATIONSHEET()
                                             
                    
        this.get_violation()
          
          this.getwhichjobstatususedthisevaluationform()
          this.get_minor_or_grave()

     
                          this.timekeeping_method()         
                          this.dispatchSystem()      

                          
                         


       this.load = true
       setTimeout(() => {
        this.load = false
         
       }, 2000);
       

        

    },beforeMount () {
    
    
      
    },

})



</script>
{% endblock %}


