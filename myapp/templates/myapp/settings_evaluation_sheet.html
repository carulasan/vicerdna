{% extends "myapp/layout.html" %}

<style>




</style>
{% block content %}

{% csrf_token %}
<q-breadcrumbs style="color: red; cursor: pointer">
    <q-breadcrumbs-el label="File Maintenance /" onclick="location.href='{% url 'settings_panel' %}' " icon="settings" />
    <q-breadcrumbs-el label="Evaluation Sheet " icon="all_inbox" />
    <q-breadcrumbs-el label=" /"  />
</q-breadcrumbs>


<div class="row animated fadeInDown" style="padding: 10px;">
           <div style="width: 100% ">
                <legend style="font-size: 25px; color:#34495E;font-weight: 900">Type of Evaluation Sheet</legend>
           </div>
           <div class="row animated fadeInDown">
                <span style="color: #34495E">
                      Evaluation Sheet That is Being use to Evaluate Employees.
                </span>
           </div>
  </div>


  <div class="row animated fadeInDown" style="padding: 20px; width: 100%;">
      <q-btn color="red-8" outlined icon="add" label="Create new"  @click="create" ></q-btn>
    </div>

<div class="row animated fadeInDown" style="padding: 10px; width: 100%;">
    
       
    
    <div class="row" style="width: 100%;  " >
            <div v-for="item,index in data" :key="item.id" class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style=" padding: 20px; ;-webkit-box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12);
            -moz-box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12);
            box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12); border-radius: 10px;; background-color: white;">
                <div>

                    <div class="row" style="padding: 10px; width: 100%;">
                
                        <div style="font-size: 20px; color : #34495E;font-weight: 900" class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                            <span style="width: 100px;">Click to Select department that will be using the evaluation sheet.</span><br>
                 
                        </div>
                        
                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                            <q-btn @click="new_deparment(item.department_use,item.id)"   style="width: 200px;"  icon="add" color="red" label="ADD Department" outline ></q-btn>
          
                        </div>
                    <!-- <legend style="font-size: 20px; color : #34495E;font-weight: 900">${item.title}</legend>
                    <div>
                        <small style="float: right ; margin-top: -25px;">Last Update : 5 mins ago</small>
                    </div>
                    <div>
                      <q-tooltip >
                        Are you sure you want to delete this kind of evaluation ${item.title}
                      </q-tooltip>
                      <q-btn style="float: right; " flat color="grey" @click="delete_kind(item.id)" icon="delete"  ></q-btn>
                    </div>
                    <q-btn style="float: right; " flat color="orange" icon="edit" @click="update_kind(item.id)"  ></q-btn> -->
                   
              </div>
                    <!-- <span style="color: #34495E">
                        ${item.description}
                  </span> -->

                  <div style="width: 100% ">
                  
                    <!-- <legend style="font-size: 15px; color:#5D6D7E;font-weight: 900">Department Use this Kind of Evalation.</legend> -->

                    
                </div>
                <div style="width: 100% " v-for="item5 in item.department_use" :key="item5.id">
                  <li style="font-size: 15px;  margin-left: 20px; color:#34495E;font-weight: bold">  ${ item5.department} Department
                   
                    <q-btn  flat  color="grey" @click="remove_to_kind(item5.id)" icon="delete"  ></q-btn>
                   <!-- //here -->
                  
                  </li>
                          
              </div>

             
                
                
                                  </div>
              


<!-- 

                  <div style="width: 100% ">
                  
                    <legend style="font-size: 15px; color:#5D6D7E;font-weight: 900">This kind of Evaluation Sheet is currently use by the following.</legend>
                    
                </div>

                
                
                <div style="width: 100% " v-for="item3 in item.jobstatus_used" :key="item3.id">
                  <li style="font-size: 15px;  margin-left: 20px; color:#34495E;font-weight: bold">  ${ item3.jobtstatus}
                      <q-btn  flat  color="grey" @click="delete_status_jobstatus(item3.id)" icon="delete"  ></q-btn>
                   
                  
                  </li>
                          
              </div>

              <div class="row" style="padding: 10px;">
                <q-btn  style="width: 200px;" label="add Job Status" @click="add_jobstatus_use_this_evaluation(item.id,item.title)"  icon="add" color="red" outline ></q-btn>
              </div> -->


                  <div style="width: 100% ">
                      <legend style="font-weight: 900;font-size: 20px; color : #34495E;font-weight: 900">Criteria </legend>
                      <p :style="item.totalpercentage == 100 ? 'color: green; padding: 3px;' : 'color: red; padding: 3px;' ">Total Percentage : ${item.totalpercentage}% of 100%</p>
                      
                  </div>
                  <div style="width: 100% " v-for="item2 in item.criteria" :key="item.id">
                      <li style="font-size: 15px;  margin-left: 20px; color:#34495E;font-weight: bold">${item2.criteria} ( ${ item2.percentage}) %
                        <q-btn color="orange" icon="edit" @click="eventupdatecriteria(item2,item.criteria)" flat ></q-btn>
                          <q-btn flat color="grey" @click="delete_criteria(item2.id)" icon="delete"  ></q-btn>
                       
                      
                      </li>
                              <div style="width: 100%; margin-left: 50px; color: gray">
                                  ${ item2.description }
                                  <div style="float: right">
                                      
                                  </div>
                              </div>
                  </div>

                  <div class="row" style="padding: 10px;">
                    <q-btn @click="criteria_new(item.criteria,item.id)"  style="width: 200px;"  icon="add" color="red" label="Add Criteria" outline ></q-btn>
                  </div>



            </div>


    </div>
    
 


      



       

 </div>



 <q-dialog v-model="modalupdatecriteria" persistent>
    <q-card style="width: 900px;">
      <q-card-section class="row items-center" style="padding: 30px;">
          <div class="row animated fadeInDown" style="width: 100%; padding: 5px;">
            <legend style="font-size: 15px; color:#34495E;font-weight: 900">Create New Criteria for <strong style="color: #34495E">${ kindof_evaluation }</strong></legend>
          </div>
          
  
        
          
          <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
            <q-input style="width: 100%;"   v-model="update_criteria_name"  type="text"     ref="update_criteria_name" :rules="[ val => val && val.length > 0 || 'Please type something']" outlined label="Criteria Name" ></q-input>
          </div>
  
         
          <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
              <q-input style="width: 100%;" v-model="update_criteria_des"  type="text" outlined label="Criteria Description" ref="update_criteria_des" :rules="[ val => val && val.length > 0 || 'Please type something']" ></q-input>
        </div>
    
        
        <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
          <q-input style="width: 100%;" v-model="update_percentage"   type="number" outlined label="Percentage"  ></q-input>
    </div>
  
        <div class="row animated fadeInDown" style="padding: 5px; width: 100%;">
          <q-btn color="red-8"  label="update" @click="updatecriteria" ></q-btn>
          <q-btn flat label="close" color="grey" v-close-popup ></q-btn>
            <!-- pamupdate -->
        </div>
          
              
        <div v-if="loading" class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
          <q-linear-progress color="red" indeterminate ></q-linear-progress>
          </div>
         
          
      </q-card-section>
      <q-card-actions align="right">
       
        
      </q-card-actions>
    </q-card>
  </q-dialog>

  

 <q-dialog v-model="newcriteria" persistent>
  <q-card style="width: 900px;">
    <q-card-section class="row items-center" style="padding: 30px;">
        <div class="row animated fadeInDown" style="width: 100%; padding: 5px;">
          <legend style="font-size: 15px; color:#34495E;font-weight: 900">Create New Criteria for <strong style="color: #34495E">${ kindof_evaluation }</strong></legend>
        </div>
        

      
        
        <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
          <q-input style="width: 100%;"   v-model="criteria_name"  type="text"     ref="criteria_name" :rules="[ val => val && val.length > 0 || 'Please type something']" outlined label="Criteria Name" ></q-input>
        </div>

       
        <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
            <q-input style="width: 100%;" v-model="criteria_des"  type="text" outlined label="Criteria Description" ref="criteria_des" :rules="[ val => val && val.length > 0 || 'Please type something']" ></q-input>
      </div>
  
      
      <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
        <q-input style="width: 100%;" v-model="percentage"   type="number" outlined label="Percentage"  ></q-input>
  </div>

      <div class="row animated fadeInDown" style="padding: 5px; width: 100%;">
        <q-btn color="red-8"  label="Create" @click="add_criteria" ></q-btn>
        <q-btn flat label="close" color="grey" v-close-popup ></q-btn>
          <!-- pam -->
      </div>
        
            
      <div v-if="loading" class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
        <q-linear-progress color="red" indeterminate ></q-linear-progress>
        </div>
       
        
    </q-card-section>
    <q-card-actions align="right">
     
      
    </q-card-actions>
  </q-card>
</q-dialog>



 <q-dialog v-model="modal" persistent>
  <q-card style="width: 900px;">
    <q-card-section class="row items-center" style="padding: 30px;">
        <div class="row animated fadeInDown" style="width: 100%; padding: 5px;">
          <legend style="font-size: 15px; color:#34495E;font-weight: 900">Create New Evaluation Sheet</legend>
        </div>
        <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
          <legend style="font-size: 15px; color:#34495E;font-weight: 400">Enter what Kind of Evaluation</legend>
        </div>
        <div class="row animated fadeInDown" style="width: 100%; padding: 5px;">
              <q-input style="width: 100%;" v-model="model_kind" filled   type="text" outlined placeholder="Evaluation Name"></q-input>
        </div>

       

        <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
          <legend style="font-size: 15px; color:#34495E;font-weight: 400">Short Description about this Evaluation Sheet</legend>
        </div>
        <div class="row animated fadeInDown" style="width: 100%; padding: 5px;">
          <q-input style="width: 100%;" filled  v-model="model_kind_des"  type="textarea" outlined placeholder="Evaluation Name"></q-input>
        </div>

       
       
        
    </q-card-section>
    <q-card-actions align="right">
      <q-btn flat label="Cancel" color="grey" v-close-popup ></q-btn>
      <q-btn  label="Create" @click="newkind" color="red-8" v-close-popup  ></q-btn>
    </q-card-actions>
  </q-card>
</q-dialog>







<q-dialog v-model="modal_Department" persistent>
  <q-card style="width: 900px;">
    <q-card-section class="row items-center" style="padding: 30px;">
        
      <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
        <legend style="font-size: 15px; color:#34495E;font-weight: 400">Which Department used this Kind of Evaluation</legend>
      </div>
      <div class="row animated fadeInDown" style="width: 100%; padding: 5px;">
            
            <q-select v-model="model_department_to_use" style="width: 100%" :value="model_department_to_use" :options="options_department" label="Choose Department" filled ></q-select>
      </div>

      <!-- brylle -->
        
    </q-card-section>
    <q-card-actions align="right">
      <q-btn flat label="Cancel" color="grey" v-close-popup ></q-btn>
      <q-btn  push label="save" @click="add_department_to_evaluation" color="red-8" v-close-popup  ></q-btn>
    </q-card-actions>
  </q-card>
</q-dialog>




<q-dialog v-model="modal_use_this_evaluation" persistent>
  <q-card style="width: 900px;">
    <q-card-section class="row items-center" style="padding: 30px;">
        
      <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
        <legend style="font-size: 15px; color:#34495E;font-weight: 400">Which Jobstatus used this kind of evaluation</legend>
      </div>
      <div class="row animated fadeInDown" style="width: 100%; padding: 5px;">
            
            <q-select v-model="model_kind_used" style="width: 100%" :value="model_kind_used" :options="options_jobstatus" label="Choose Job status" filled ></q-select>
      </div>

       
        
    </q-card-section>
    <q-card-actions align="right">
      <q-btn flat label="Cancel" color="grey" v-close-popup ></q-btn>
      <q-btn  push label="save" @click="modal_btn_create" color="red-8" v-close-popup  ></q-btn>
    </q-card-actions>
  </q-card>
</q-dialog>





 <q-dialog v-model="modal_to_update_kind" persistent>
  <q-card style="width: 900px;">
    <q-card-section class="row items-center" style="padding: 30px;">
        <div class="row animated fadeInDown" style="width: 100%; padding: 5px;">
          <legend style="font-size: 25px; color:#34495E;font-weight: 900">Create New Evaluation Sheet</legend>
       
        
        </div>
        <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
          <legend style="font-size: 15px; color:#34495E;font-weight: 400">Enter what Kind of Evaluation</legend>
        </div>
        <div class="row animated fadeInDown" style="width: 100%; padding: 5px;">
              <q-input style="width: 100%;" v-model="model_kind_update"  type="text" outlined placeholder="Evaluation Name"></q-input>
        </div>

       




        <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
          <legend style="font-size: 15px; color:#34495E;font-weight: 400">Short Description about this Evaluation Sheet</legend>
        </div>
        <div class="row animated fadeInDown" style="width: 100%; padding: 5px;">
          <q-input style="width: 100%;" v-model="model_kind_des_update"  type="textarea" outlined placeholder="Evaluation Name"></q-input>
        </div>

        <!-- <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
          <legend style="font-size: 15px; color:#34495E;font-weight: 900">Enter Criteria and Description</legend>
        </div>

        
        <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
          <q-input style="width: 100%;"   type="text" outlined label="Criteria Name" ></q-input>
        </div>

        <div class="row animated fadeInDown" style="width: 100%;  padding: 5px; ">
            <q-input style="width: 100%;"   type="text" outlined label="Criteria Description" ></q-input>
      </div>
       -->
      
       
        
    </q-card-section>
    <q-card-actions align="right">
      <q-btn flat label="Cancel" color="grey" v-close-popup ></q-btn>
      <q-btn  label="update" @click="update_kind_now" color="red-8" v-close-popup  ></q-btn>
    </q-card-actions>
  </q-card>
</q-dialog>



{% endblock %}



{% block script%}

<script>
  
        new Vue({
            el: '#app',
            delimiters: ['${','}'],
            data: function () {
              return {
                drawerState: false,
                pic_user : 'http://res.heraldm.com/phpwas/restmb_jhidxmake.php?idx=5&simg=201701181539234376570_20170118154018_02.jpg',
        
         
                dash : {
            backgroundColor : '#273746',
           color : 'white'
           },
           
           Deliberation : {
           backgroundColor : '#273746',
           color : 'white',
       },

       employee : {
            backgroundColor : '#273746',
           color : 'white'
           },
           performance_evaluation : {
           backgroundColor : '#273746',
           color : 'white',
        
       },
       settings : {
            backgroundColor : '#273746',
           color : 'white'
           },
           Deliberation : {
           backgroundColor : '#273746',
           color : 'white',
       },
       report : {
           backgroundColor : '#273746',
           color : 'white',
       },
       concern : {
           backgroundColor : '#273746',
           color : 'white',
       },


                modal_to_update_kind  : false,
               
                modal : false,
                model_kind : '',
                model_kind_des : '',
                model_kind_update : '',
                model_kind_des_update : '',
                newcriteria : false,
                kindof_evaluation : '',
                global_hostname : '',
                kind_id : 0,
                percentage : 0,
                criteria_des : '',
                criteria_name : '',
                data : [
                 
                ],
                cri : [

                 
                ],
                kind : [
                  {
             
                  }
                ],
                  token : '',
                  loading : false,
                  id_kind_to_update : 0,
                  model_kind_used : '',
                  options_jobstatus : [
                    'probationary',
                  ],
                  options_jobstatus_master : [],
                  who_used : [],
                  modal_use_this_evaluation : false,
                  //current
                  id_kind_for_adding_use : 0,
                  kind_title : '',
                  DEPARTMENT_USE_EVALUATION_SHEET : [],
                  id_foradding_department : 0,
                  modal_Department : false,
                  model_department_to_use : '',
                  options_department : [],
                  department_raw : [],
                  existing : [],
                  Maximuncriteria : 0,
                  // pamdata
                  modalupdatecriteria : false,
                  update_criteria_name: '',
                  update_criteria_des :  '',
                  update_percentage :'', 
                  updateyungkind : '',
                  toupdate : 0,

                  
              }
            },
            methods: {



              logout(){
              axios.post(`${this.global_hostname}/logout/`,{
                  
                   headers: {
                               'Content-Type': 'application/json',
                                  'X-CSRFToken': this.token
                   }
                  
              })
              .then(res => {
                  window.location.replace(`${this.global_hostname}/login/`)
                
              })
              .catch(err => {
                  
              })
            },

            updatecriteria(){
              // pamupdate
              console.log(this.kind)
              // 
              alert(this.update_criteria_name)
              // alert(this.update_criteria_des)

              this.$refs.update_criteria_name.validate()
                this.$refs.update_criteria_des.validate()
                   if (this.$refs.update_criteria_des.hasError || this.$refs.update_criteria_name.hasError ) {
                    this.formHasError = true
                        return
                 }else{
                  
                      var re = /^[A-Za-z]+$/;
                      // if (re.test(this.update_criteria_name) && re.test(this.update_criteria_des)) {
                      

                        
            

                      // }else{
                        
                      //   this.$q.notify({ //put dollor sign(q)
                      //               message: `Numbers Not Allowed`,
                      //               timeout: 3000, // in milliseconds; 0 means no timeout

                      //               color: 'red',
                      //               textColor: 'white', // if default 'white' doesn't fit
                      //             icon: 'error', //or  avatar: 'statics/boy-avatar.png',

                      //             position: 'top', // 'top', 'left', 'bottom-left' etc.

                      //             })

                  
                      //     return

                      // }


                 }

                 if(this.update_percentage.length<=0 || this.update_percentage == 0){
                  this.$q.notify({ //put dollor sign(q)
                                    message: `Error Percentage Please Try Again!`,
                                    timeout: 3000, // in milliseconds; 0 means no timeout

                                    color: 'red',
                                    textColor: 'white', // if default 'white' doesn't fit
                                  icon: 'error', //or  avatar: 'statics/boy-avatar.png',

                                  position: 'top', // 'top', 'left', 'bottom-left' etc.

                                  })

                  return
                 }
                 var remain = 100 - parseInt(this.Maximuncriteria)
                // alert(remai
                //  brylle
 
                
                
                // if(parseInt(this.update_percentage) > remain  ){
                //   this.$q.notify({ //put dollor sign(q)
                //                     message: `Oops! The total percentage of criterias has  ${this.Maximuncriteria}% of 100% , the allowed percentage is only ${remain}%`,
                //                     timeout: 3000, // in milliseconds; 0 means no timeout

                //                     color: 'red',
                //                     textColor: 'white', // if default 'white' doesn't fit
                //                   icon: 'error', //or  avatar: 'statics/boy-avatar.png',

                //                   position: 'top', // 'top', 'left', 'bottom-left' etc.

                //                   })

                  
                //           return

                // }
                





              var id = this.kind.filter(
                (element)=>{
                  return element.kind_of_evaluation == this.updateyungkind
                }
              )
              
              var payload = {
                "kind_of_evaluation": `${this.global_hostname}/api/EvaluationSheet_Kind/${id[0].id}/`,
                "criteria": this.update_criteria_name,
                "description": this.update_criteria_des,
                "percentage": this.update_percentage,
              }
              console.log(payload)
              axios.put(`${this.global_hostname}/api/POST_EvaluationSheet_Criteria/${this.toupdate}/`,payload,{
                
                 headers: {
                       'Content-Type': 'application/json',
                        'X-CSRFToken': this.token
                 }
                
              })
              .then(res => {
                console.log(res)

                this.$q.notify({ //put dollor sign(q)
              message: `Successfuly Updated!`,
              timeout: 3000, // in milliseconds; 0 means no timeout

              color: 'green',
              textColor: 'white', // if default 'white' doesn't fit
            icon: 'check', //or  avatar: 'statics/boy-avatar.png',

            position: 'top', // 'top', 'left', 'bottom-left' etc.

            })

            this.load()
              this.get_options_jobstatus()
              this.get_jobstatus_to_use()
              this.GET_WHICH_DEPARTMENT()
              this.get_options_department()
              })
              .catch(err => {
                console.error(err); 
              })
              
            },


//             <q-select v-model="model_department_to_use" style="width: 100%" :value="model_department_to_use" :options="options_department" label="Choose Department" filled ></q-select>
//       </div>

//       <!-- brylle -->
        
//     </q-card-section>
//     <q-card-actions align="right">
//       <q-btn flat label="Cancel" color="grey" v-close-popup ></q-btn>
//       <q-btn  push label="save" @click="add_department_to_evaluation" color="red-8" v-close-popup  ></q-btn>
//     </q-card-actions>
//   </q-card>
// </q-dialog>
get_options_department(){

  axios.get(`${this.global_hostname}/api/DEPARTMENT/`,{
  
     headers: {
           'Content-Type': 'application/json',
            'X-CSRFToken': this.token
     }
    //brylle
  })
  .then(res => {
    console.log(res)

    var data = res.data
    this.department_raw = res.data

    for (let index = 0; index < data.length; index++) {
      const element = data[index];
      this.options_department.push(element.department)
      
      
    }

    
  })
  .catch(err => {
    console.error(err); 
  })

  
},

// pamupdate
eventupdatecriteria(data,datas){
  console.log(data)
    this.modalupdatecriteria = true
    this.update_criteria_name = data.criteria
    this.update_criteria_des = data.description
    this.update_percentage = data.percentage
    this.updateyungkind = data.kind_of_evaluation
    this.toupdate = data.id

    var total = 0
                for (let index = 0; index < datas.length; index++) {
                  const element = datas[index];
                  total = total + parseInt(element.percentage)
                  if(index == datas.length - 1){
                    this.Maximuncriteria = total
                    console.log(this.Maximuncriteria)
                  }
                  
          }
    // kind_of_evaluation": "http://127.0.0.1:8000/api/EvaluationSheet_Kind/1/
    // kind_of_evaluation
                  
},
add_department_to_evaluation(){
  var department = this.model_department_to_use

  var chcking = this.DEPARTMENT_USE_EVALUATION_SHEET.filter(
    (element)=>{
        return element.department == department
    }

  )
  if(chcking.length > 0){
        
        this.$q.notify({ //put dollor sign(q)
                                            message: `${ department } is already exist!`,
                                            timeout: 10000, // in milliseconds; 0 means no timeout

                                            color: 'red-8',
                                            textColor: 'white', // if default 'white' doesn't fit
                                            icon: 'pan_tool', //or  avatar: 'statics/boy-avatar.png',

                                            position: 'top', // 'top', 'left', 'bottom-left' etc.

              })


        //brylle
        return 
  }
 
  var id = this.department_raw.filter(
    (element)=>{
      return element.department == department
    }
  )



  var payload = {
    "kind_of_evaluation": `${this.global_hostname}/api/EvaluationSheet_Kind/${this.id_foradding_department}/`,
    "department": `${this.global_hostname}/api/DEPARTMENT/${id[0].id}/`,
  }

  axios.post(`${this.global_hostname}/api/POST_DEPARTMENT_USE_THE_EVALUATION_SHEET/`,payload,{

     headers: {
           'Content-Type': 'application/json',
            'X-CSRFToken': this.token
     }
    
  })
  .then(res => {
    this.$q.notify({ //put dollor sign(q)
      message: `Successfully Saved!`,
      timeout: 3000, // in milliseconds; 0 means no timeout
   
      color: 'gray',
      textColor: 'white', // if default 'white' doesn't fit
     icon: 'check', //or  avatar: 'statics/boy-avatar.png',
      
     position: 'top', // 'top', 'left', 'bottom-left' etc.
      
      })
    
    

  this.GET_WHICH_DEPARTMENT()
                  //here

                  this.load()
              this.get_options_jobstatus()
              this.get_jobstatus_to_use()

  })
  .catch(err => {
    console.error(err); 
  })





},
            

new_deparment(data,id){
  // kharene
              this.id_foradding_department = id
              this.modal_Department = true
              console.log('new???')
              console.log(data)
              for (let index = 0; index < data.length; index++) {
                const element = data[index];
                this.existing.push(element.department)
                
              }
              //brylle
            },
         
            remove_to_kind(id){
              axios.delete(`${this.global_hostname}/api/POST_DEPARTMENT_USE_THE_EVALUATION_SHEET/${id}/`,{
                
                 headers: {
                       'Content-Type': 'application/json',
                        'X-CSRFToken': this.token
                 }
                
              })
              .then(res => {

                this.GET_WHICH_DEPARTMENT()
                  //here

                  this.load()
              this.get_options_jobstatus()
              this.get_jobstatus_to_use()
              
            
              })
              .catch(err => {
                console.error(err); 
              })
            },
            modal_btn_create(){

              var id = this.id_kind_for_adding_use 



                                              //current

                        
                                   


                        var modelkinduse = this.model_kind_used
                

                        var info = this.use_jobstatus
                        console.log('ifno')
                        console.log(info)
                        var data = this.kind_title

                        var check = false

                        for (let index = 0; index < info.length; index++) {
                          const element = info[index];

                          console.log(element.jobtstatus)
                          console.log(element.kind_of_evaluation)
                          // alert( element.jobtstatus  + ' ' + this.model_kind_used + '| ' + element.kind_of_evaluation + ' ' + this.kind_title)

                          if(element.jobtstatus == this.model_kind_used &&  element.kind_of_evaluation == this.kind_title){
                              
                              
                              check = true

                          } 


                            if( index == info.length - 1 ){
                              
                                  if(check == true){

                                                this.$q.notify({ //put dollor sign(q)
                                            message: `${ modelkinduse } is already exist in kind of evaluation ${ data } !`,
                                            timeout: 10000, // in milliseconds; 0 means no timeout

                                            color: 'red-8',
                                            textColor: 'white', // if default 'white' doesn't fit
                                            icon: 'pan_tool', //or  avatar: 'statics/boy-avatar.png',

                                            position: 'top', // 'top', 'left', 'bottom-left' etc.

                                      })

                                  }

                                  if(check == false){

                                      
                                                                var id_jobstatus = this.options_jobstatus_master.filter(function(el) { return el.for_employee_status == modelkinduse })

                                                            var payload = {
                                                              "kind_of_evaluation": `${this.global_hostname}/api/EvaluationSheet_Kind/${id}/`,
                                                            "jobtstatus": `${this.global_hostname}/api/JOBSTATUS/${id_jobstatus[0].id}/`,
                                                            }

                                                              axios.post(`${this.global_hostname}/api/POST_EVALUATION_SHEET_USED_BY_JOBSTATUS/`,payload,{
                                                              
                                                                headers: {
                                                                      'Content-Type': 'application/json',
                                                                        'X-CSRFToken': this.token
                                                                }
                                                                
                                                })
                                                .then(res => {
                                                  console.log(res)
                                                  this.$q.notify({ //put dollor sign(q)
                                                      message: `Successfully Saved!`,
                                                      timeout: 10000, // in milliseconds; 0 means no timeout

                                                      color: 'orange',
                                                      textColor: 'white', // if default 'white' doesn't fit
                                                      icon: 'check', //or  avatar: 'statics/boy-avatar.png',

                                                      position: 'top', // 'top', 'left', 'bottom-left' etc.

                                                      })


                                                      this.load()
                                                      this.get_options_jobstatus()
                                                  this.get_jobstatus_to_use()


                                                })
                                                .catch(err => {
                                                  console.error(err); 
                                                })



                                  }
                          
                            }
                          
                        }

                     

                          if(info.length == 0){

                                                                        
                                                                          var id_jobstatus = this.options_jobstatus_master.filter(function(el) { return el.for_employee_status == modelkinduse })

                                              var payload = {
                                                "kind_of_evaluation": `${this.global_hostname}/api/EvaluationSheet_Kind/${id}/`,
                                              "jobtstatus": `${this.global_hostname}/api/JOBSTATUS/${id_jobstatus[0].id}/`,
                                              }

                                                axios.post(`${this.global_hostname}/api/POST_EVALUATION_SHEET_USED_BY_JOBSTATUS/`,payload,{
                                                
                                                  headers: {
                                                        'Content-Type': 'application/json',
                                                          'X-CSRFToken': this.token
                                                  }
                                                  
                                              })
                                              .then(res => {
                                              console.log(res)
                                              this.$q.notify({ //put dollor sign(q)
                                              message: `Successfully Saved!`,
                                              timeout: 10000, // in milliseconds; 0 means no timeout

                                              color: 'orange',
                                              textColor: 'white', // if default 'white' doesn't fit
                                              icon: 'check', //or  avatar: 'statics/boy-avatar.png',

                                              position: 'top', // 'top', 'left', 'bottom-left' etc.

                                              })


                                              this.load()
                                              this.get_options_jobstatus()
                                              this.get_jobstatus_to_use()


                                              })
                                              .catch(err => {
                                              console.error(err); 
                                              })


                          }

                        check = false


                        
              


            },

            add_jobstatus_use_this_evaluation(id,title){
              this.modal_use_this_evaluation = true
              //current
              this.id_kind_for_adding_use = id
              this.kind_title = title






            },


            delete_status_jobstatus(id){

              axios.delete(`${this.global_hostname}/api/GET_EVALUATION_SHEET_USED_BY_JOBSTATUS/${id}/`,{
              
                 headers: {
                       'Content-Type': 'application/json',
                        'X-CSRFToken': this.token
                 }
                
              })
              .then(res => {


                this.$q.notify({ //put dollor sign(q)
                           message: `Successfully Deleted!`,
                           timeout: 10000, // in milliseconds; 0 means no timeout

                           color: 'orange',
                           textColor: 'white', // if default 'white' doesn't fit
                          icon: 'check', //or  avatar: 'statics/boy-avatar.png',

                          position: 'top', // 'top', 'left', 'bottom-left' etc.

                           })
                          

                           
                           this.load()
                           this.get_options_jobstatus()
              this.get_jobstatus_to_use()

                
                
              })
              .catch(err => {
                console.error(err); 
              })
            },

            regular(id){

              
              axios.delete(`${this.global_hostname}/api/get/Get_EvaluationSheet_Criteria/${id}/`,{
                
                headers: {
                      'Content-Type': 'application/json',
                       'X-CSRFToken': this.token
                }
               
             })
             .then(res => {
             
               this.$q.notify({ //put dollor sign(q)
                           message: `Successfully Deleted!`,
                           timeout: 10000, // in milliseconds; 0 means no timeout

                           color: 'orange',
                           textColor: 'white', // if default 'white' doesn't fit
                          icon: 'check', //or  avatar: 'statics/boy-avatar.png',

                          position: 'top', // 'top', 'left', 'bottom-left' etc.

                           })
                           this.load()

             })
             .catch(err => {
               console.error(err); 
             })

            },
            
              delete_criteria(id){

                axios.delete(`${this.global_hostname}/api/get/Get_EvaluationSheet_Criteria/${id}/`,{
                
                   headers: {
                         'Content-Type': 'application/json',
                          'X-CSRFToken': this.token
                   }
                  
                })
                .then(res => {
                
                  this.$q.notify({ //put dollor sign(q)
                              message: `Successfully Deleted!`,
                              timeout: 10000, // in milliseconds; 0 means no timeout

                              color: 'orange',
                              textColor: 'white', // if default 'white' doesn't fit
                             icon: 'check', //or  avatar: 'statics/boy-avatar.png',

                             position: 'top', // 'top', 'left', 'bottom-left' etc.

                              })
                              this.load()

                })
                .catch(err => {
                  console.error(err); 
                })

              },
                update_kind_now(){
                    var id = this.id_kind_to_update
                    var payload = {
                        "kind_of_evaluation": this.model_kind_update,
                        "description":   this.model_kind_des_update,
                    }
                    console.log('upadate')
                    console.log(payload)
                    axios.put(`${this.global_hostname}/api/EvaluationSheet_Kind/${id}/`,payload,{
                      
                        headers: {
                                        'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                                    }
                    }).then(res => {
                        this.$q.notify({ //put dollor sign(q)
                              message: `Successfully Updated!`,
                              timeout: 10000, // in milliseconds; 0 means no timeout

                              color: 'orange',
                              textColor: 'white', // if default 'white' doesn't fit
                             icon: 'check', //or  avatar: 'statics/boy-avatar.png',

                             position: 'top', // 'top', 'left', 'bottom-left' etc.

                              })
                                
                              this.load()
                        
                    }).catch(err => {
                             this.$q.notify({ //put dollor sign(q)
                              message: `Unsuccessfull!`,
                              timeout: 10000, // in milliseconds; 0 means no timeout

                              color: 'red',
                              textColor: 'white', // if default 'white' doesn't fit
                             icon: 'error', //or  avatar: 'statics/boy-avatar.png',

                             position: 'top', // 'top', 'left', 'bottom-left' etc.

                              })
                                
                              this.load()
                    
                    })
                
                },
                update_kind(id){
                    this.modal_to_update_kind = true
                    let jordan = this.data.filter(function(element){ return element.id == id})
                    console.log(jordan)
                     this.model_kind_update = jordan[0].title
                      this.model_kind_des_update = jordan[0].description
                        this.id_kind_to_update = id
                    
                    
                },
                delete_kind(id){
                    
                    axios.delete(`${this.global_hostname}/api/EvaluationSheet_Kind/${id}/`,{
                        headers: {
                                        'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                                    }
                
                }).then(res => {
                         console.log(res)

                          this.$q.notify({ //put dollor sign(q)
                              message: `Successfully Deleted!`,
                              timeout: 10000, // in milliseconds; 0 means no timeout

                              color: 'orange',
                              textColor: 'white', // if default 'white' doesn't fit
                             icon: 'check', //or  avatar: 'statics/boy-avatar.png',

                             position: 'top', // 'top', 'left', 'bottom-left' etc.

                              })
                                
                              this.load()

                    }).catch(err => {
                  console.error(err); 
                })
                    
                },
              add_criteria(){
                //  alert(this.percentage + ' ' + this.Maximuncriteria)
                

                
      
                // pam
                this.$refs.criteria_name.validate()
                this.$refs.criteria_des.validate()
                   if (this.$refs.criteria_des.hasError || this.$refs.criteria_des.hasError ) {
                    this.formHasError = true
                        return
                 }else{
                  
                      var re = /^[A-Za-z]+$/;
                      if (re.test(this.criteria_des) && re.test(this.criteria_des)) {
                      

                        
            

                      }else{
                        
                        this.$q.notify({ //put dollor sign(q)
                                    message: `Numbers Not Allowed`,
                                    timeout: 3000, // in milliseconds; 0 means no timeout

                                    color: 'red',
                                    textColor: 'white', // if default 'white' doesn't fit
                                  icon: 'error', //or  avatar: 'statics/boy-avatar.png',

                                  position: 'top', // 'top', 'left', 'bottom-left' etc.

                                  })

                  
                          return

                      }


                 }
                 if(this.percentage.length<=0 || this.percentage == 0){
                  this.$q.notify({ //put dollor sign(q)
                                    message: `Error Percentage Please Try Again!`,
                                    timeout: 3000, // in milliseconds; 0 means no timeout

                                    color: 'red',
                                    textColor: 'white', // if default 'white' doesn't fit
                                  icon: 'error', //or  avatar: 'statics/boy-avatar.png',

                                  position: 'top', // 'top', 'left', 'bottom-left' etc.

                                  })

                  return
                 }
                 var remain = 100 - parseInt(this.Maximuncriteria)
                // alert(remain)
                //  brylle
 
                
                
                if(parseInt(this.percentage) > remain  ){
                  this.$q.notify({ //put dollor sign(q)
                                    message: `Oops! The total percentage of criterias has  ${this.Maximuncriteria}% of 100% , the allowed percentage is only ${remain}%`,
                                    timeout: 3000, // in milliseconds; 0 means no timeout

                                    color: 'red',
                                    textColor: 'white', // if default 'white' doesn't fit
                                  icon: 'error', //or  avatar: 'statics/boy-avatar.png',

                                  position: 'top', // 'top', 'left', 'bottom-left' etc.

                                  })

                  
                          return

                }
                
                          
this.loading = true
                
                          

                axios.post(`${this.global_hostname}/api/POST_EvaluationSheet_Criteria/`,{

                     
            "kind_of_evaluation": `${this.global_hostname}/api/EvaluationSheet_Kind/${this.kind_id}/`,
            "criteria": this.criteria_name,
            "description": this.criteria_des,
            "percentage": this.percentage,
                },{
                        headers: {
                                        'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                                    }
                
                })
                .then(res => {
                  console.log(res)

                  this.$q.notify({ //put dollor sign(q)
                      message: `Successfull.. New Criteria has been saved successfully`,
                      timeout: 10000, // in milliseconds; 0 means no timeout
                      
                      color: 'orange',
                      textColor: 'white', // if default 'white' doesn't fit
                     icon: 'check', //or  avatar: 'statics/boy-avatar.png',
                    
                     position: 'top', // 'top', 'left', 'bottom-left' etc.
                      
                      })
                        this.loading = false
                      this.load()


                })
                .catch(err => {
                  console.error(err); 
                })
              },
              newkind(){
                  var payload = {
                        "kind_of_evaluation": this.model_kind,
                      "description": this.model_kind_des,
                  }

                  axios.post(`${this.global_hostname}/api/EvaluationSheet_Kind/`,payload,{
                  headers: {
                                        'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                                    }
                    
                  })
                  .then(res => {
                    var id = res.data.id

                    


                    console.log(res)
                   this.model_kind_des = ''
                      this.model_kind = ''
                    this.$q.notify({ //put dollor sign(q)
                      message: `Successfull.. New Evaluation Sheet has been saved successfully`,
                      timeout: 10000, // in milliseconds; 0 means no timeout
                      
                      color: 'orange',
                      textColor: 'white', // if default 'white' doesn't fit
                     icon: 'check', //or  avatar: 'statics/boy-avatar.png',
                    
                     position: 'top', // 'top', 'left', 'bottom-left' etc.
                      
                      })
                      this.load()


             
                   
                    
                  })
                  .catch(err => {
                    console.error(err); 
                    this.$q.notify({ //put dollor sign(q)
                      message: `There is an error.`,
                      timeout: 3000, // in milliseconds; 0 means no timeout
                      
                      color: 'red',
                      textColor: 'white', // if default 'white' doesn't fit
                     icon: 'error', //or  avatar: 'statics/boy-avatar.png',
                    
                     position: 'top', // 'top', 'left', 'bottom-left' etc.
                      
                      })
                  })
              },
              criteria_new(datas,id){
                var total = 0
                for (let index = 0; index < datas.length; index++) {
                  const element = datas[index];
                  total = total + parseInt(element.percentage)
                  if(index == datas.length - 1){
                    this.Maximuncriteria = total
                    console.log(this.Maximuncriteria)
                  }
                  
                }
                console.log(datas)
                var data = this.kind.filter(function(el){
                  return el.id == id
                })
                this.kindof_evaluation = data[0].kind_of_evaluation
                this.newcriteria = true;
                  this.kind_id = id
                 
              },
              create(){
                this.modal = true
              },
              get_criteria(kind){

               
                  return this.cri.filter(function(el) {

                    return el.kind_of_evaluation == kind
                  })
               
              },

              get_jobstatus(status){
                var a = status
                    return  this.who_used.filter(function(el){
                      return el.kind_of_evaluation == a
                    })
                    console.log('a')
                    console.log(a)

              },

              //here
                GET_WHICH_DEPARTMENT(){
                axios.get(`${this.global_hostname}/api/GET_DEPARTMENT_USE_THE_EVALUATION_SHEET/`,{
               
                   headers: {
                         'Content-Type': 'application/json',
                          'X-CSRFToken': this.token
                   }
                  
                })
                .then(res => {
                  console.log(res)
                  this.DEPARTMENT_USE_EVALUATION_SHEET = res.data

                })

                .catch(err => {
                  console.error(err); 
                })
                },

              //here
              get_which_department(kind_of_evaluation){
                 var a = kind_of_evaluation
                 var data = this.DEPARTMENT_USE_EVALUATION_SHEET.filter(
                   (element)=>{
                    return element.kind_of_evaluation == a
                   }
                 )

                 return data

              },
              sort() {

                
                var ki = []
                
                for (let index = 0; index < this.kind.length; index++) {
                  const element = this.kind[index];
                      var obj = {
                        'id' : element.id,
                        'title' : element.kind_of_evaluation,
                        'description' : element.description ,
                        'criteria' : this.get_criteria(element.kind_of_evaluation),
                        'jobstatus_used' : this.get_jobstatus(element.kind_of_evaluation),
                        //here
                        'department_use' : this.get_which_department(element.kind_of_evaluation)
                        
                      }
                      ki.push(obj)

                    
                }
                this.data = ki
                console.log('f=====================================')
                // kharene

                console.log(this.data)
                var  total = 0
                for (let index = 0; index < ki.length; index++) {
                  const element = ki[index];
                 total =   this.criteriatotal(element.criteria)
                 this.data[index].totalpercentage = total
                 if(index == ki.length - 1){
                      console.log(this.data)
                 }
                  
                }


               

              },
              criteriatotal(data){
                var res = 0
                for (let index = 0; index < data.length; index++) {
                  const element = data[index];
                  res = res + parseInt(element.percentage)
                  if(index == data.length - 1 ){
                    
                    return res
                  }
                  
                }
               
              },
              load(){
                axios.get(`${this.global_hostname}/api/get/Get_EvaluationSheet_Criteria/`)
                .then(res => {
                  this.cri = res.data

                      axios.get(`${this.global_hostname}/api/EvaluationSheet_Kind/`,{
                      headers: {
                                        'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                                    }
                      
                      })
                    .then(res2 => {
                      this.kind = res2.data
                      this.sort();
                    })
                    .catch(err2 => {
                      console.error(err2); 
                    })




                })
                .catch(err => {
                  console.error(err); 
                })
               

              },
              get_options_jobstatus(){
                this.options_jobstatus = []

                axios.get(`${this.global_hostname}/api/JOBSTATUS/`,{
              
                   headers: {
                         'Content-Type': 'application/json',
                          'X-CSRFToken': this.token
                   }
                  
                })
                .then(res => {
                  console.log(res)
                    var data = res.data
                    this.options_jobstatus_master = res.data
                    
                    console.log(`mater`)
                    console.log(this.options_jobstatus_master)

                      data.forEach(element => {
                          this.options_jobstatus.push(element.for_employee_status)
                          console.log(element)
                      });
                      console.log('opton job satus')
                      console.log(this.options_jobstatus)


                })
                .catch(err => {
                  console.error(err); 
                })
              },

              get_jobstatus_to_use(){
                              axios.get(`${this.global_hostname}/api/GET_EVALUATION_SHEET_USED_BY_JOBSTATUS/`,{
                          
                          headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': this.token
                          }
                        
                      })
                      .then(res => {
                          this.who_used = res.data
                          this.use_jobstatus =res.data
                        
                      })
                      .catch(err => {
                        console.error(err); 
                      })



              },

            },mounted () {


              var hostname = window.location.hostname;
              var port = window.location.port
        if(port != ''){

            hostname = hostname+':8000'
        }
        else{
            hostname = hostname
        }

            this.global_hostname = `${window.location.protocol}//${hostname}`;
        
            var csrftoken = Cookies.get('csrftoken');
             this.token = csrftoken


              this.load()
              this.get_options_jobstatus()
              this.get_jobstatus_to_use()
              this.GET_WHICH_DEPARTMENT()
              this.get_options_department()
            
             
            },beforeMount () {
              if(innerWidth < 1017){
                    this.drawerState = false
                }
                this.GET_WHICH_DEPARTMENT()
            },
            
        })

    </script>            
                
{% endblock %}
