{% extends "myapp/layout.html" %}

<style>


.del{
    background-color: white;
}
.del:hover{
    background-color: grey
}


</style>
{% block content %}

<q-breadcrumbs style="color: red; cursor: pointer">
    <q-breadcrumbs-el label="File Maintenance /" onclick="window.location.href='{% url 'settings_panel' %}' " icon="settings" />
    <q-breadcrumbs-el label="Evaluation Guide " icon="all_inbox" />
    <q-breadcrumbs-el label=" /"  />
</q-breadcrumbs>

<div class="row animated fadeInDown" style="padding: 10px;">
    <div style="width: 100% ">
         <legend style="font-size: 25px; color:#34495E;font-weight: 900">Performance Evaluation Guide</legend>

    </div>
    <span style="color: #34495E;">
        
        <small >This is combination of data from  . <span >
            <q-btn color="red" onclick="window.location.href='{% url 'settings_evaluation_sheet_panel' %}' "   style="font-size: 8px" icon="open_in_new" label="Kind of Evaluation" flat></q-btn>
            <q-btn color="red" onclick="window.location.href='{% url 'settings_department_panel' %}'" style="font-size: 8px" icon="open_in_new" label="Department" flat></q-btn>
            <q-btn color="red"  onclick="window.location.href='{% url 'settings_violation_panel' %}' "  style="font-size: 8px" icon="open_in_new" label="offences" flat></q-btn>
        
    
    </small>
    <div class="row animated fadeInDown">
         <span style="color: #34495E">
                <small>For evaluation of employee, this information is the basis to which criteria, when employee commited a violation. This could be help to the evaluators as a basis in each citeria depending what department belongs to, and to give appropiate score in each criteria.</small>
         </span>
    </div>
    <span style="color: #34495E;">
        <small style="color: red">Reminder*</small> 
        <small>Minor offense has 3% deduction of percetange in each criteria,while grave offense has 5% deduction.</small>
        <small >When employee commited 2x he/she will be undergo supensions depending what kind of offense. <span >
            <q-btn color="red" style="font-size: 8px" icon="open_in_new" label="See more in diciplanary actions" flat></q-btn>
        
    
    </small>
</div>


<div class="row animated fadeInDown" style="padding: 10px;">


    <q-table

   
    style="width: 100% ; background-color: white; border-radius: 10px;;; -webkit-box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12);
    -moz-box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12);
    box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12);
    

     "
     
    :data="data"
    :columns="columns"
    row-key="id"
    selection="single"
    :selected.sync="selected"
    :filter="terms"
    :loading="TableLoading"
    
    
    
    >
    <!-- uptable -->
    
    <template  v-slot:top-left>
    
                <div>
                    <q-tooltip >
                Add New
                    </q-tooltip>
                    <q-btn class="animated fadeInDown" dense color="red-8" @click="eventNewbasis" label="Create New"  icon="add"  ></q-btn>
                    
                </div>
    </template>
    


         <template v-slot:top-right>
      
         <div style="width: 100px; font-size: 15px; color: grey;">
                      <span>Filter</span>
                      <q-icon style="font-size: 25px;" name="filter_list"></q-icon>
                  </div>
    
    
      <div style="width: 300px;padding: 10px;">
          <q-select  outlined  v-model="modelTypeofEvaluation" dense debounce="300"  @input="FilterTable" :options="OptionEvaluationGuide"  filled label="Type Of Evaluation" ></q-select>
        
      </div>
      
      <div style="width: 200px;padding: 10px;">
          <q-select outlined   filled  :options="OptionDepartment" dense debounce="300"  v-model="modelfilterdepartment"  @input="filterDep" label="Department" ></q-select>
          <!-- :options="OptionDepartment" -->
      </div> 
      <div style="width: 200px;padding: 10px;">
        <q-select outlined  :options="OptionCriteria" dense debounce="300" v-model="modelfiltercriteria"  @input="filterCriteriaEvent"  filled  label="Criteria" ></q-select>
        <!-- :options="options_department" -->
    </div> 
    <div style="width: 200px;padding: 10px;">
            <q-select outlined   filled  :options="Minorgraveoption" dense debounce="300"  v-model="modelfiltertype"  @input="filterType" label="Type" ></q-select>
            <!-- :options="OptionDepartment" -->
    </div> 
    <q-input outlined  style="width: 200px;padding: 10px;" v-model="terms"  filled  dense debounce="300" @input="search"  placeholder="Search">
            <template v-slot:append>
              <q-icon name="search" ></q-icon>
            </template>
        </q-input>
      

        
      
      
      
     

   
           

    
     
      </template>
    
    
    
    </q-table>

  

    

    
</div>

<!-- 

<div class="row animated fadeInDown"  style="width: 100%;padding: 10px;  ">
        

<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6" v-for="sheet in evaluation_sheet" >
<div class="row animated fadeInDown" style="padding: 10px;" >
                  
                    
</div>
                <div class="row animated fadeInDown" style="padding: 10px;">
                    <div style="width: 100% ">
                        <legend style="font-size: 20px; color:#273746;font-weight: 900">Kind of Evaluation :  <p style="color:#273746">${ sheet.kind_of_evaluation }</p></legend>
                    </div>
                   
                    
                </div>
                
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 " style=" -webkit-box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12);
                    -moz-box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12);
                    box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12);  border-radius: 10px;
                    padding: 10px; height: 400px; overflow-x: scroll; background-color: #273746;" v-for="item in sheet.department">
                    <div class="row" style="width: 100%">
                        <legend style="font-size: 15px; color:white;font-weight: 900">Department Section : <p style="color:white">${ item.department }</p></legend>
                    </div>  
                 
                    
                  
                    </span>
                    <div class="row" style="width: 100%;margin-top: 10px;">
                        <legend style="font-size: 15px; color:white;font-weight: 900">Criteria </legend>
                    </div>
                    <div class="row" style="width: 100%;margin-top: 2px;" v-for="item_criteria in item.criteria">
                            <legend style="font-size: 20px;margin-left: 10px; color:white;font-weight: 900">${ item_criteria.criteria  } </legend>
                            
                            <span style="color: white;">
                                
                            <small>    
                                    <q-btn color="red" style="font-size: 8px" icon="add" label="Add more basis" flat @click="new_basis(sheet.kind_of_evaluation,item.department,item_criteria.criteria)"></q-btn>
                                
                            
                            </small>
                            </span> 
                            <br>
                            <div class="row" style="width: 100% ; color:white; ">
                                <small style="margin-left: 20px;">Performance Evaluation Basis for ${ item_criteria.criteria  }</small>
                            </div>

                            <div class="row" style="width: 100%" v-for="item_violation in item_criteria.violations">
                                    <legend class="del" style="font-size: 18px; color:white;font-weight: 900; width: 100%; margin-left: 20px"> - ${ item_violation.NatureofOffense } 
                                            <q-btn color="grey" @click="del(item_violation.id)"  icon="close" style="font-size: 16px; float: right;"  flat ></q-btn>
                                    </legend>
                                    
                                            
                                    
                                    
                            </div>
                            

                            
    
                        
                        
                        </div>
                    </div>
 
        



</div>

            

</div>
 -->






<q-dialog v-model="modal_basis"  >

    <q-card  style="width: 1020px; max-width: 80vw;" >
        <q-card-section>
            <div v-if="loading" class="row" style="width: 100%" >
                    <q-linear-progress indeterminate color="red" class="q-mt-sm" ></q-linear-progress>
            </div>
        </q-card-section>
       
      <q-card-section class="row items-center" style="padding: 20px;">

        <div class="row" style="width: 100% ;">
       
            
            <div class="col-xs-6 col-sm-4 col-md-4 col-lg-4" style="overflow-x: scroll ; height: 600px; " >
 
                    <div class="row animated fadeInDown" style="padding: 10px; width: 100%">
                            <div style="width: 100% ">
                                 <legend style="font-size:15px; color:#34495E;font-weight: 900">Department Section : <legend style="font-size: 15px; color:#273746;font-weight: 900"> ${ basis_department } </legend> </legend>
                            </div>
                          
                    </div>

                    <div class="row animated fadeInDown" style="padding: 10px; width: 100%">
                            <div style="width: 100% ">
                                 <legend style="font-size: 15px; color:#273746;font-weight: 900">Add evaluation basis for <legend style="font-size: 15px; color: #273746;font-weight: 900"> ${ basis_criteria } </legend> </legend>
                            </div>
                          
            
                        </div>
            

                        <div class="row animated fadeInRight" v-for="item in selected_offense" style="padding: 10px; width: 100% ;">
                                <div class="row animated fadeInDown"  style="width: 100%; ">         
                                             <legend style="font-size:20px; color:#273746;font-weight: 900; margin-left: 20px;"> ${ item.NatureofOffense} 
                                                <br>
                                                <small>${ item.graveofminor}</small>
                                            </legend>  
                                             <q-btn  flat icon="subdirectory_arrow_right" label="undo" style="font-size: 15px;" @click="undo(item.id)" color="orange" >  </q-btn>
                                </div>
                        </div>
                       
                       
                        
                       


                       

                        
               
            </div>
            <div class="col-xs-6 col-sm-8 col-md-8 col-lg-8">
                
                  
                
                    <div class="row animated fadeInDown" style="padding: 10px; width: 100%">
                            <div style="width: 100% ">
                                 <legend style="font-size: 20px; color:#34495E;font-weight: 900">Offense  </legend>
                            </div>
                            <div class="row animated fadeInDown">
                                    <span style="color: #34495E">
                                           <small>Offenses of employee rules and the conduct is committed off-duty and not on University property, the University may discipline the employee, up to and including discharge.</small>
                                    </span>
                               </div>

                             
                        
                    </div>

                    


                    <div class="row" style="width: 100%">

                  
                          
                            <div class="col-xs-12 col-sm-4 col-md-4 col-lg-3" v-for="item in violations_choices"   style="padding: 10px;">

                                    <q-list   >
                                        <q-item clickable class="animated fadeInLeft" style="width: 100% ; border-radius: 5px; -webkit-box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12);
                                        -moz-box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12);
                                        box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12); background-color: white; color:#5D6D7E; ">
                                     
                                        
                                        
                                            <q-item-section  >
                                              <q-item-label>${ item.NatureofOffense}</q-item-label>
                                              <q-item-label caption lines="2">${ item.graveofminor}</q-item-label>
                                            </q-item-section>
                                            <q-item-section side top @click="choose(item.id)">
                                                    <q-item-label caption>select</q-item-label>
                                                    <q-icon  style="font-size: 25px;"  name="subdirectory_arrow_left" color="orange" />
                                            </q-item-section>
                                           
                                          </q-item>
                                    </q-list>
                                    
                            </div>
                          
                       
                        </div>
            
                      <!-- place QPageScroller at end of page -->
                      <q-page-scroller position="bottom-right" :scroll-offset="150" :offset="[18, 18]">
                        <q-btn fab icon="keyboard_arrow_up" color="accent" />
                      </q-page-scroller>
                   
                
            </div>
            
        </div>

        


         
      </q-card-section>
    <q-card-section>
        <div class="row">
            <q-btn label= "Save" @click="save" color="red" ></q-btn>
            
        </div>
</q-card-section>
     
    </q-card>
  </q-dialog>


<!-- mymodal -->

   <q-dialog v-model="modal_show">
        <q-card style="width: 900px; max-width: 1020;">
         
           
                <q-card-section>
                    <div class="text-h6">Evaluation Guide</div>
                    <q-input v-model="displayType" type="text" readonly label="Type of Evalution" ></q-input>
                    <q-input v-model="displayDepartment" type="text" readonly label="Department" ></q-input>
                    <q-input v-model="displayCriteria" type="text" readonly label="Criteria" ></q-input>
                    <q-input v-model="displayOffense" type="text" readonly label="Violation" ></q-input>
                    <q-input v-model="displayDateCreated" type="text" readonly label="Date Created" ></q-input>

             
                    
                </q-card-section>
                
           
          <q-card-actions align="center">
              <q-btn   label="Close" color="grey" v-close-popup ></q-btn>
              <q-btn label= "Delete" @click="deletebasis(IDTodelete)" color="red" ></q-btn>
          </q-card-actions>
        </q-card>
      </q-dialog> 

      <q-dialog v-model="modal_new_basis" full-width>
            <q-card >
             
               
                    <q-card-section>
                       <div class="row">
                           
                           <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                    <div style="padding: 5px;" class="text-h6">Create New</div>
                                    <q-select style="padding: 5px;" v-model="newTypeofEvaluation" :options="OptionNewBasisTypeOfEvaluation" label="Select Type of Evaluation" outlined ></q-select>
                                    <q-select style="padding: 5px;" v-model="newDepertment" :value="newDepertment" :options="OptionNewDepartment" label="Select Department"  outlined ></q-select>
                                    <q-select  style="padding: 5px;" v-model="newCriteria" :options="OptionNewCriteria" label="Select Criteria"  outlined ></q-select>
                 
                                    <legend style="padding: 5px;" >Violation Basis</legend><br>

                                    <div class="row"  style="height: 200px; overflow-x: scroll;">
                                        
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" >
                                            <div class="row animated fadeInRight" v-for="item in selected_offense" style="padding: 10px; width: 100% ;">
                                                    <div class="row animated fadeInDown"  style="width: 100%; ">         
                                                                <legend style="font-size:20px; color:#273746;font-weight: 900; margin-left: 20px;"> ${ item.NatureofOffense} 
                                                                    <br>
                                                                    <small>${ item.graveofminor}</small>
                                                                </legend>  
                                                                <q-btn  flat icon="subdirectory_arrow_right" label="undo" style="font-size: 15px;" @click="undo(item.id)" color="orange" >  </q-btn>
                                                    </div>
                                            </div>
                       
                                        </div>
                                        
                                    </div>

                           </div>
                           
                           <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                <div class="row">
                                   
                                   <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="margin-top: 45px; padding: 3px;">
                                        <q-input  type="text"   v-model="searchOffense" outlined label="Search"  >
                                                <template v-slot:append>
                                                        <q-icon name="search" ></q-icon>
                                                      </template>
                                        </q-input>
                                   </div>
                                   
                                </div>
                                <div class="row" style="padding: 3px;">
                                    
                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                      
                                        <q-select @input="filterbasis" :value="modelfilterminorgrave" v-model="modelfilterminorgrave" :options="Minorgraveoption" label="Filter" outlined ></q-select>
                                    </div>
                                    
                                </div>
                                <div class="row" style="height: 350px; overflow-x: scroll;">
                                    <!-- kharene -->
                                        <div class="col-xs-12 col-sm-4 col-md-4 col-lg-3" v-for="item in violations_choices"   style="padding: 10px;">

                                                <q-list   >
                                                    <q-item clickable class="animated fadeInLeft" style="width: 100% ; border-radius: 5px; -webkit-box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12);
                                                    -moz-box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12);
                                                    box-shadow: 0px 0px 2px 1px rgba(0,0,0,0.12); background-color: white; color:#5D6D7E; ">
                                                 
                                                    
                                                    
                                                        <q-item-section  >
                                                          <q-item-label>${ item.NatureofOffense}</q-item-label>
                                                          <q-item-label caption lines="2">${ item.graveofminor}</q-item-label>
                                                        </q-item-section>
                                                        <q-item-section side top @click="choose(item.id)">
                                                                <q-item-label caption>select</q-item-label>
                                                                <q-icon  style="font-size: 25px;"  name="subdirectory_arrow_left" color="orange" />
                                                        </q-item-section>
                                                       
                                                      </q-item>
                                                </q-list>
                                                
                                        </div>

                                </div>
                               
                           </div>
                           
                      

                           
                       </div>
                        
                    </q-card-section>
                    
               
              <q-card-actions align="left">
                  
                  <q-btn color="red" icon="save" label="save" @click="save" ></q-btn>
                  <q-btn  label="Close" color="grey" v-close-popup ></q-btn>
                 
              </q-card-actions>
            </q-card>
          </q-dialog> 
          <!-- newbasis -->
      
  



      
    





{% endblock %}

{% block script %}

<script>
new Vue({
            el: '#app',
            delimiters: ['${','}'],
            data: function () {
              return {

                drawerState: false,
                pic_user : 'http://res.heraldm.com/phpwas/restmb_jhidxmake.php?idx=5&simg=201701181539234376570_20170118154018_02.jpg',

                modal_basis : false,
                tool : true,
                tooltip : {
                    'display' : 'none'
                },
                dash : {
            backgroundColor : '#273746',
           color : 'white'
           },
           
           Deliberation : {
           backgroundColor : '#273746',
           color : 'white',
       },

       employee : {
            backgroundColor : '#273746',
           color : 'white'
           },
           performance_evaluation : {
           backgroundColor : '#273746',
           color : 'white',
        
       },
       settings : {
            backgroundColor : '#273746',
           color : 'white'
           },
           Deliberation : {
           backgroundColor : '#273746',
           color : 'white',
       },
       report : {
           backgroundColor : '#273746',
           color : 'white',
       },
       concern : {
           backgroundColor : '#273746',
           color : 'white',
       },

       
       evaluation_sheet : [],
       violations : [],
                // evaluation_sheet : [

                //             {

                //                 kind_of_evaluation : 'Probationary and Regular',
                //                 department : [
                //                 {
                //                     "department": "Operation",
                //                     'criteria' : [
                //                         {
                //                             "criteria": "Quality of Work",
                //                             'violations' : [
                //                                 {
                //                                     "NatureofOffense": "5 Times late",
                //                                 },
                //                                 {
                //                                     "NatureofOffense": "5 Times late",
                //                                 }
                //                             ]

                //                         },
                //                         {
                //                             "criteria": "Effiency",
                //                             violations : [
                //                                 {
                //                                     "NatureofOffense": "5 Times late",
                //                                 },
                //                                 {
                //                                     "NatureofOffense": "5 Times late",
                //                                 }
                //                             ]

                //                         }
                //                 ]

                //                 }

                //             ],


                //             }
                // ],
                department_db : [],
                criteria_db : [],
                offenses_db : [],
                kind_sheet : [],
               
                basis_criteria : '',
                basis_department : '',
                basis_kind : '',
                violations_choices : [],
                selected_offense :  [],
                loading : false,
                columns: [
          
          {
          name: 'kind_of_evaluation',
          required: true,
          label: 'Type Of Evaluation',
          align: 'left',
          field: row => row.kind_of_evaluation,
          format: val => `${val}`,
          sortable: true
        },
        { name: 'Department', align: 'center', label: 'Department', field: 'department', sortable: true },
        { name: 'Criteria', align: 'center', label: 'Criteria', field: 'criteria', sortable: true },
        { name: 'offense', label: 'Name of Offence', field: 'offense', sortable: true },
        { name: 'graveofminor', label: 'Type', field: 'Type', sortable: true },
        { name: 'date_updated', label: 'Date Created', field: 'date_updated' },
      
      ],
      data: [
               
      ],
      selected : [],
      ViolationDepartmentPerCriteria_data : [],
      terms: '',
      TableLoading : true,
      OptionEvaluationGuide : [],
      OptionEvaluationGuide_raw : [],
      modelTypeofEvaluation : '',
      modelfilterdepartment : '',
      OptionDepartmentRaw : [],
      OptionDepartment : [],
      modelfiltercriteria : '',
      OptionCriteria : [],
      modal_show : false,
      displayType : '',
      displayDepartment : '',
      displayCriteria : '',
      displayOffense : '',
      displayDateCreated : '',
      modal_new_basis : false,

      newTypeofEvaluation : '',
      OptionNewBasisTypeOfEvaluation : [],
      newDepertment : '',
      OptionNewDepartment : [],
      newCriteria : '',
      OptionNewCriteria : [],
      OptionNewDepartment_Raw : [],
      IDTodelete : 0,
      Minorgraveoption : [],
      modelfilterminorgrave : '',
      CHOICESRAW : [],
      ch : [],
      searchOffense : '',
      MINORORGRAVEDATA : [],
      modelfiltertype : '',
      VIOLATIONDINCOPY : []

     

    //   state

                
              }


            },
            watch: {
                searchOffense : function(){
                    var data = this.CHOICESRAW
                    var natira =  data.filter(
                        (element)=>{
                            return element.NatureofOffense.toLowerCase().includes(this.searchOffense.toLowerCase())
                        }
                    )
                    this.violations_choices = natira
                },
               selected : function(){
                   if(this.selected.length > 0){
                        this.modal_show = true
                        this.displayType = this.selected[0].kind_of_evaluation
                        this.displayDepartment = this.selected[0].department
                        this.displayCriteria = this.selected[0].criteria
                        this.displayOffense = this.selected[0].offense
                        this.displayDateCreated = this.selected[0].date_updated
                        this.IDTodelete = this.selected[0].id

                        
                   }

                  
               },
               
               newTypeofEvaluation : function(){
                
                var temp = []
                        var filtered = this.OptionNewDepartment_Raw.filter(
                            (element)=>{
                                    return element.kind_of_evaluation == this.newTypeofEvaluation
                            }
                        )
                        for (let index = 0; index < filtered.length; index++) {
                            const element = filtered[index];
                            
                            temp.push(element.department)
                            if(index == filtered.length - 1){

                                this.OptionNewDepartment = temp
                            }
                            
                        }
               },

               newDepertment : function(){
              
            //   this.OptionCriterRaw
                var filter = this.OptionCriterRaw.filter(
                    (element)=>{
                        return element.kind_of_evaluation == this.newTypeofEvaluation
                    }
                )
                var temp = []
                for (let index = 0; index < filter.length; index++) {
                    const element = filter[index];
                    temp.push(element.criteria)
                    if(index == filter.length - 1){
                        this.OptionNewCriteria = temp
                    }
                }

               },
               modelfilterminorgrave : function(){
                     // violations_choices
                // kharene
                var a =this.CHOICESRAW
                if(this.modelfilterminorgrave != "No Filter"){
                  
                                // console.log(this.CHOICESRAW)
                            
                                var info = this.CHOICESRAW
                                var data = info.filter(
                                    (element)=>{
                                        return element.graveofminor.toLowerCase().includes(this.modelfilterminorgrave.toLowerCase())
                                        
                                    }
                                 )
               
                                    // console.log(this.CHOICESRAW)
                                this.violations_choices = data
                           
                    }else{
                        this.violations_choices = this.CHOICESRAW
                    }
            
              
               },

            },
            methods : {

                
                logout(){
              axios.post(`${this.global_hostname}/logout/`,{
                  
                   headers: {
                               'Content-Type': 'application/json',
                                  'X-CSRFToken': this.token
                   }
                  
              })
              .then(res => {
                  window.location.replace(`${this.global_hostname}/login/`)
                
              })
              .catch(err => {
                   
              })
            },
            filterType : function(){
                // this.ViolationDepartmentPerCriteria_data
                var info = this.modelfiltertype
                this.ViolationDepartmentPerCriteria_data = this.VIOLATIONDINCOPY
                this.data = this.ViolationDepartmentPerCriteria_data
                if(info.toLowerCase() != 'no filter'){
                   var data = this.VIOLATIONDINCOPY.filter(
                       (element)=>{
                        return element.Type.toLowerCase() == info.toLowerCase()
                       }
                   )
                  
                   this.ViolationDepartmentPerCriteria_data = data
                   this.data = this.ViolationDepartmentPerCriteria_data
                }


                // carulasan
                
               },

            filterbasis(){
              
            }, 
            deletebasis(IDTodelete){
                // ditot
                this.del(IDTodelete)
            },
            eventNewbasis(){
                this.modal_new_basis = true
            },
         
            FilterTable(){
               var type = this.modelTypeofEvaluation
               
               if(type == 'No Filter'){
                    this.data = this.ViolationDepartmentPerCriteria_data
                    this.modelTypeofEvaluation = ''
                    this.modelfilterdepartment = ''
                    this.modelfiltercriteria = ''
                   
               }else{
                        if(type !=''){
                                this.callfilterbytype(type)
                    }


                    this.filterall()


               }
              
            },
            filterall() {
                var cri = this.modelfiltercriteria
                var type = this.modelTypeofEvaluation
                var dep = this.modelfilterdepartment

                if(type != 'No Filter' && type != '' && dep != '' && dep != 'No Filter'){
                   
                   var data = this.ViolationDepartmentPerCriteria_data
                   var info_filter = data.filter(
                           (element)=>{
                           return element.department == dep && element.kind_of_evaluation 
                           }
                       )
                   this.data = info_filter




               }


               if(cri != 'No Filter' &&  cri != '' &&  dep != '' && dep != 'No Filter'){
                   
                   var data = this.ViolationDepartmentPerCriteria_data
                   var info_filter = data.filter(
                           (element)=>{
                           return element.department == dep  &&  element.criteria == cri
                           }
                       )
                   this.data = info_filter




               }




                if(cri != 'No Filter' &&  cri != '' && type != 'No Filter' && type != '' && dep != '' && dep != 'No Filter'){
                   
                    var data = this.ViolationDepartmentPerCriteria_data
                    var info_filter = data.filter(
                            (element)=>{
                            return element.department == dep && element.kind_of_evaluation == type &&  element.criteria == cri
                            }
                        )
                    this.data = info_filter




                }

                


            },
            filterCriteriaEvent(){
                var cri = this.modelfiltercriteria
                if(cri == 'No Filter'){
                //    hai
               
                this.data = this.ViolationDepartmentPerCriteria_data
                this.modelTypeofEvaluation = ''
                this.modelfilterdepartment = ''
                this.modelfiltercriteria = ''
               }else{
                    if(cri != ''){
                        //    hai
                    this.filterCriteria(cri)
                    }
               }
               this.filterall()
               
            },
            filterDep(){
                var dep = this.modelfilterdepartment
              
               
               if(dep == 'No Filter'){
                //    hai
               
                this.data = this.ViolationDepartmentPerCriteria_data
                this.modelTypeofEvaluation = ''
                this.modelfilterdepartment = ''
                this.modelfiltercriteria = ''
               }else{
                    if(dep != ''){
                        //    hai
                        this.filterdepartment(dep)
                    }
               }

               this.filterall()

            },
            callfilterbytype(info){
                var data = this.ViolationDepartmentPerCriteria_data
                var info_filter = data.filter(
                    (element)=>{
                    return element.kind_of_evaluation == info
                    }
                )
                    this.data = info_filter
               
            },
            filterdepartment(info){
                var data = this.ViolationDepartmentPerCriteria_data
                var info_filter = data.filter(
                    (element)=>{
                    return element.department == info
                    }
                )
                    this.data = info_filter
               
            },

            filterCriteria(info){
                var data = this.ViolationDepartmentPerCriteria_data
                var info_filter = data.filter(
                    (element)=>{
                    return element.criteria == info
                    }
                )
                    this.data = info_filter
               
            },



            search(){
                this.TableLoading = true
                setTimeout(() => {
                        this.TableLoading = false
                }, 1000);
            },
                del(id){
                    this.$q.dialog({
        title: 'Confirm',
        message: 'Would you Like to Delete This File?',
        cancel: true,
        persistent: true
      }).onOk(() => {
        // console.log('>>>> OK')

         
        var offense_id = id
                //    hai
                    axios.delete(`${this.global_hostname}/api/GET_Violation_Per_Department_Per_Criteria/${id}/`,{
                      
                         headers: {
                                     'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                         }
                        
                    })
                    .then(res => {
                       
                        this.$q.notify({ //put dollor sign(q)
                            message: `Successfully Deleted!`,
                            timeout: 3000, // in milliseconds; 0 means no timeout
                            
                            color: 'green',
                            textColor: 'white', // if default 'white' doesn't fit
                         icon: 'check', //or  avatar: 'statics/boy-avatar.png',
                         
                         position: 'top', // 'top', 'left', 'bottom-left' etc.
                            
                            })
                            this.modal_show = false
                            this.get_violations()
                    this.get_kind_of_sheet()
                    this.ViolationDepartmentPerCriteria()
                    this.GetDepertmentUseThisEvaluation()

                    this.TableLoading = true
                    setTimeout(() => {
                        this.FilterTable = false
                    }, 500);
                    })
                    .catch(err => {
                        console.error(err); 
                    })



                    
      }).onOk(() => {
        // console.log('>>>> second OK catcher')
      }).onCancel(() => {
        // console.log('>>>> Cancel')
      }).onDismiss(() => {
        // console.log('I am triggered on both OK and Cancel')
})
               
                },
                save(){
                    this.loading = true
                    // var basis_criteria =  this.basis_criteria
                    // var basis_department = this.basis_department
                    // var basis_kind = this.basis_kind


                    var basis_criteria =  this.newCriteria
                    var basis_department = this.newDepertment
                    var basis_kind = this.newTypeofEvaluation
                    var id_criteria = this.criteria_db.filter(function(element){return element.criteria == basis_criteria  })
                    var id_department = this.department_db.filter(function(element){return element.department ==  basis_department })
                    var id_kind = this.kind_sheet.filter(function(element){return element.kind_of_evaluation ==  basis_kind })
                   
                   

                    for (let index = 0; index < this.selected_offense.length; index++) {
                        const element = this.selected_offense[index];

                                        var payload = {
                                                "kind_of_evaluation": `${this.global_hostname}/api/EvaluationSheet_Kind/${id_kind[0].id}/`,
                                                "department": `${this.global_hostname}/api/DEPARTMENT/${id_department[0].id}/`,
                                                "criteria": `${this.global_hostname}/api/get/Get_EvaluationSheet_Criteria/${id_criteria[0].id}/`,
                                                "offense": `${this.global_hostname}/api/Get_VIOLATIONS/${element.id}/`,
                                    }
                                    axios.post(`${this.global_hostname}/api/POST_Violation_Per_Department_Per_Criteria/`,payload,{
                                    
                                        headers: {
                                                    'Content-Type': 'application/json',
                                                        'X-CSRFToken': this.token
                                        }
                                        
                                    })
                                    .then(res => {
                                        
                                        this.$q.notify({ //put dollor sign(q)
                                            message: `${element.NatureofOffense} at ${ basis_criteria } is Successfully Saved`,
                                            timeout: 10000, // in milliseconds; 0 means no timeout
                                        
                                            color: 'orange',
                                            textColor: 'white', // if default 'white' doesn't fit
                                        icon: 'check', //or  avatar: 'statics/boy-avatar.png',
                                        
                                        position: 'top', // 'top', 'left', 'bottom-left' etc.
                                        
                                        })
                                        
                                        this.ViolationDepartmentPerCriteria()
                                        this.modal_new_basis = false
                                       

                                    })
                                    .catch(err => {
                                        console.log(err); 
                                    })

                                    if(index == this.selected_offense.length - 1){
                                        this.selected_offense = []
                                        this.get_violations()
                                        this.get_kind_of_sheet() 
                                        setTimeout(() => {
                                            this.loading = false
                                        }, 1000);
                                    }
                                        
                    }

                   
                    
                },
                undo(id){
                    var data = this. selected_offense.filter(function(element){return element.id == id })

                    this.violations_choices.push(data[0])
                    var remove = this.selected_offense.filter(function ( element){ return element.id != id })
                    this.selected_offense = remove

                },
                choose(id){
                //     violations_choices : [],
                // selected_offense :  [],
                   
                    var data =  this.violations_choices.filter(function (element) { return element.id == id }) 
                   
                    this.selected_offense.push(data[0])
                    var remove = this.violations_choices.filter(function (element) { return element.id != id }) 
                    this.violations_choices = remove

                },
                new_basis(kind_of_evaluation,department,criteria){
                    this.modal_basis = true
                    this.basis_criteria = criteria
                    this.basis_department = department
                    this.basis_kind = kind_of_evaluation

                    
                  
                },
                sort_violation(kind,department,criteria){
                    var data = this.offenses_db
                    var offense = []
                    for (let index = 0; index < data.length; index++) {
                        const element = data[index];
                           if(element.kind_of_evaluation == kind && element.department == department && element.criteria == criteria){
                               var off =    element.offense
                            // var minor_or_grave = this.violations.filter(
                            //        function(info){
                            //             return info.NatureofOffense == off
                            //        }
                            //    )
                            var obj = {
                                    "NatureofOffense": element.offense,
                                    "id" : element.id
                                   
                                                           
                                 }

                                 offense.push(obj)
                           } 

                       
                                 if(index == data.length - 1){
                                        return  offense
                                     }

                        
                    }

                    
                                                           

                },

                sort_criteria(kind,department){
                   
                        var data = this.criteria_db
                        var criteria = []

                    for (let index = 0; index < data.length; index++) {
                        const element = data[index];
                            if(element.kind_of_evaluation == kind ){

                                var obj =   {
                                            "criteria": element.criteria,
                                            'violations' : this.sort_violation(kind,department,element.criteria) 
                                                       

                                     }

                                     criteria.push(obj)


                            }
                           

                                     if(index == data.length - 1){
                                        return criteria
                                     }

                    }
                                                   
                },

                sort_department(kind_of_evaluation){
                    var data = this.department_db
                    var department = []
                    for (let index = 0; index < data.length; index++) {
                        const element = data[index];

                            var obj = {
                                        "department": element.department,
                                        criteria : this.sort_criteria(kind_of_evaluation,element.department,)

                             }
                                department.push(obj)
                             if(index == data.length - 1){

                                return department
                             }
                    }

                    

                },
                sorter(){
                    //kind
                   
                         var data  = this.kind_sheet
                         var guide = []
                         for (let index = 0; index < data.length; index++) {
                             const element = data[index];

                             var obj =   {

                                            kind_of_evaluation : element.kind_of_evaluation,
                                            department : this.sort_department(element.kind_of_evaluation)


                                }
                                guide.push(obj)

                                if(index == data.length - 1){

                                  
                                    this.evaluation_sheet = guide

                                }

                               
                         }

                },
                get_the_offenses(){
                    axios.get(`${this.global_hostname}/api/GET_Violation_Per_Department_Per_Criteria/`,{
                       
                         headers: {
                                     'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                         }
                        
                    })
                    .then(res => {
                        
                        this.offenses_db = res.data
                       
                        this.sorter()

                    })
                    .catch(err => {
                        console.log(err); 
                    })
                },
                get_criteria(){
                    axios.get(`${this.global_hostname}/api/get/Get_EvaluationSheet_Criteria/`,{
                  
                         headers: {
                                     'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                         }
                        
                    })
                    .then(res => {

                        
                        this.criteria_db = res.data
                        this.OptionCriterRaw = res.data
                        var temp = []
                        for (let index = 0; index < res.data.length; index++) {
                            const element = res.data[index];
                            temp.push(element.criteria)
                            if(index == res.data.length - 1){
                                temp.push('No Filter')
                                this.OptionCriteria = temp
                            }   
                            // hai
                        }
                       
                        this.get_the_offenses()
               


                    })
                    .catch(err => {
                        console.error(err); 
                    })
                },
                get_department(){
                    axios.get(`${this.global_hostname}/api/DEPARTMENT/`,{
                       
                         headers: {
                                     'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                         }
                        
                    })
                    .then(res => {
                      
                        this.department_db = res.data
                        // hai
                        this.OptionDepartmentRaw = res.data
                        var temp = []
                        for (let index = 0; index < res.data.length; index++) {
                            const element = res.data[index];
                            temp.push(element.department)
                            if(index == res.data.length -1 ){
                                temp.push('No Filter')
                                this.OptionDepartment = temp
                            }
                        }
                       
                        this.get_criteria()
               


                    })
                    .catch(err => {
                        console.error(err); 
                    })
                },
                get_kind_of_sheet(){
                    axios.get(`${this.global_hostname}/api/EvaluationSheet_Kind/`,{
                         headers: {
                                     'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                         }
                        
                    })
                    .then(res => {
                        //kindoption
                        this.kind_sheet = res.data
                        var kin = []
                        for (let index = 0; index < res.data.length; index++) {
                            const element = res.data[index];
                            kin.push(element.kind_of_evaluation)
                            if(index == res.data.length -1){
                                this.OptionNewBasisTypeOfEvaluation = kin
                            }
                        }
                        
                        var temp = []
                        this.OptionEvaluationGuide_raw = res.data
                        for (let index = 0; index < res.data.length; index++) {
                            const element = res.data[index];
                            
                            temp.push(element.kind_of_evaluation)
                            if(index == res.data.length - 1){
                                temp.push('No Filter')
                                this.OptionEvaluationGuide = temp
                            }
                        }
                        // hai

                      

                        this.get_department()
               
                   
                          


                    }).catch(err => {
                        console.error(err); 
                    })
                },
                get_violations(){

                    axios.get(`${this.global_hostname}/api/Get_VIOLATIONS/`,{
                        
                         headers: {
                                     'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                         }
                        
                    })
                    .then(res => {
                      
                        this.violations = res.data
                     
                        this.violations_choices = res.data
                        this.CHOICESRAW = res.data
                        this.ch = res.data
                    })
                    .catch(err => {
                        console.log(err); 
                    })
                },
                // hai
                getViolation(){
                    axios.get(`${this.global_hostname}/api/Get_VIOLATIONS/`,{
                    
                         headers: {
                                     'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                         }
                        
                    })
                    .then(res => {
                        this.MINORORGRAVEDATA = res.data

                        this.getMinorGrave()
                    this.get_violations()
                    this.get_kind_of_sheet()
                    this.ViolationDepartmentPerCriteria()
                    this.GetDepertmentUseThisEvaluation()
                    })
                    .catch(err => {
                        console.error(err); 
                    })
                },
                Type(nameoffense){
                    var data = this.MINORORGRAVEDATA.filter(
                        (element)=>{
                            return element.NatureofOffense == nameoffense
                        }
                    )
                    return data[0].graveofminor

                   
                },
                ViolationDepartmentPerCriteria(){
                    axios.get(`${this.global_hostname}/api/GET_Violation_Per_Department_Per_Criteria/`,{
                       
                       headers: {
                                   'Content-Type': 'application/json',
                                      'X-CSRFToken': this.token
                       }
                      
                  })
                  .then(res => {
                    //  tamiya
                     var temp = []
                     for (let index = 0; index < res.data.length; index++) {
                         const element = res.data[index];
                         var obj = {
                            "id": element.id,
                            "kind_of_evaluation": element.kind_of_evaluation,
                            "department": element.department,
                            "criteria": element.criteria,
                            "offense": element.offense,
                            "Type": this.Type(element.offense),
                            "date_updated": new Date(element.date_updated).toString().substring(0,15)

                         }
                         temp.push(obj)
                         if(index == res.data.length - 1){
                            this.ViolationDepartmentPerCriteria_data = temp
                            this.VIOLATIONDINCOPY = temp
                            setTimeout(() => {
                                this.TableLoading = false
                            }, 3000);
                            this.data = this.ViolationDepartmentPerCriteria_data
                         }

                         
                     }
                     

                     
                      

                  })
                  .catch(err => {
                      console.log(err); 
                  })



                },

                GetDepertmentUseThisEvaluation(){
                    axios.get(`${this.global_hostname}/api/GET_DEPARTMENT_USE_THE_EVALUATION_SHEET/`,{
                      
                         headers: {
                                     'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                         }
                        
                    })
                    .then(res => {
                        console.log(res)
                        var temp = []
                        this.OptionNewDepartment_Raw = res.data
                        
                    })
                    .catch(err => {
                        console.error(err); 
                    })
                },
                getMinorGrave(){
                    axios.get(`${this.global_hostname}/api/MINOR_OR_GRAVE/`,{
                        
                         headers: {
                                     'Content-Type': 'application/json',
                                        'X-CSRFToken': this.token
                         }
                        
                    })
                    .then(res => {
                       
                        for (let index = 0; index < res.data.length; index++) {
                            const element = res.data[index];
                            this.Minorgraveoption.push(element.typeofviolation)
                            if(index == res.data.length - 1){
                                this.Minorgraveoption.push('No Filter')
                            }
                        }
                    })
                    .catch(err => {
                        console.error(err); 
                    })
                },
                
            },
            mounted() {
                 var hostname = window.location.hostname;
                 var port = window.location.port
        if(port != ''){

            hostname = hostname+':8000'
                    }
                    else{
                        hostname = hostname
                    }
        
                    this.global_hostname = `${window.location.protocol}//${hostname}`;
                 var csrftoken = Cookies.get('csrftoken');
                this.token = csrftoken
                this.getViolation()
                // tamiya
                    
               


              this.tooltip.display = 'block'

            },
            beforeMount () {
                if(innerWidth < 1017){
                    this.drawerState = false
                }
            },
})


</script>
{% endblock %}
